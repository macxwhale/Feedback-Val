import{c as F,a8 as K,a9 as ie,aa as U,ab as de,ac as Be,ad as Se,ae as Ue,s as k,a6 as Z,a2 as ee,r as S,u as X,a3 as A,j as e,C as P,d as T,p as O,af as Ce,g as D,I as q,B as w,ag as $e,ah as Ge,ai as Ve,aj as se,ak as G,al as Xe,am as R,an as ze,e as $,ao as Je,ap as ke,aq as Me,ar as _e,as as Pe,at as De,au as Te,av as Oe,aw as Ee,ax as Fe,ay as Ze,az as es,aA as ss,aB as ts,aC as as,aD as rs,aE as ns,aF as Ae,aG as ae,aH as j,M as Y,N as I,a7 as is,aI as cs,aJ as ls,aK as qe,aL as os,m as Ye,Q as ce,O as Ie,U as z,a1 as Ke,a5 as le,P as We,n as ds,T as Le,aM as us,aN as ms,R as ue,aO as hs,aP as xs,aQ as fs,aR as gs,aS as te,aT as ps,aU as js,z as ys,V as me,W as he,Y as xe,_ as fe,$ as L,q as ws,t as bs,v as ge,w as pe}from"./index-Brcr8yi2.js";import{S as Ns}from"./switch-BujArt4q.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=F("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=F("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=F("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=F("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=F("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=F("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=F("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=F("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=F("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=F("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=F("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);function J(s,t){var d,u,m,l;const a=ie(),r=(t==null?void 0:t.weekStartsOn)??((u=(d=t==null?void 0:t.locale)==null?void 0:d.options)==null?void 0:u.weekStartsOn)??a.weekStartsOn??((l=(m=a.locale)==null?void 0:m.options)==null?void 0:l.weekStartsOn)??0,n=K(s),c=n.getDay(),o=(c<r?7:0)+c-r;return n.setDate(n.getDate()-o),n.setHours(0,0,0,0),n}function re(s){return J(s,{weekStartsOn:1})}function Re(s){const t=K(s),a=t.getFullYear(),r=U(s,0);r.setFullYear(a+1,0,4),r.setHours(0,0,0,0);const n=re(r),c=U(s,0);c.setFullYear(a,0,4),c.setHours(0,0,0,0);const o=re(c);return t.getTime()>=n.getTime()?a+1:t.getTime()>=o.getTime()?a:a-1}function ye(s){const t=K(s);return t.setHours(0,0,0,0),t}function Es(s,t){const a=ye(s),r=ye(t),n=+a-de(a),c=+r-de(r);return Math.round((n-c)/Be)}function Fs(s){const t=Re(s),a=U(s,0);return a.setFullYear(t,0,4),a.setHours(0,0,0,0),re(a)}function As(s){return s instanceof Date||typeof s=="object"&&Object.prototype.toString.call(s)==="[object Date]"}function qs(s){if(!As(s)&&typeof s!="number")return!1;const t=K(s);return!isNaN(Number(t))}function Ys(s){const t=K(s),a=U(s,0);return a.setFullYear(t.getFullYear(),0,1),a.setHours(0,0,0,0),a}function Is(s){const t=K(s);return Es(t,Ys(t))+1}function Ks(s){const t=K(s),a=+re(t)-+Fs(t);return Math.round(a/Se)+1}function He(s,t){var l,h,i,f;const a=K(s),r=a.getFullYear(),n=ie(),c=(t==null?void 0:t.firstWeekContainsDate)??((h=(l=t==null?void 0:t.locale)==null?void 0:l.options)==null?void 0:h.firstWeekContainsDate)??n.firstWeekContainsDate??((f=(i=n.locale)==null?void 0:i.options)==null?void 0:f.firstWeekContainsDate)??1,o=U(s,0);o.setFullYear(r+1,0,c),o.setHours(0,0,0,0);const d=J(o,t),u=U(s,0);u.setFullYear(r,0,c),u.setHours(0,0,0,0);const m=J(u,t);return a.getTime()>=d.getTime()?r+1:a.getTime()>=m.getTime()?r:r-1}function Ws(s,t){var d,u,m,l;const a=ie(),r=(t==null?void 0:t.firstWeekContainsDate)??((u=(d=t==null?void 0:t.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)??a.firstWeekContainsDate??((l=(m=a.locale)==null?void 0:m.options)==null?void 0:l.firstWeekContainsDate)??1,n=He(s,t),c=U(s,0);return c.setFullYear(n,0,r),c.setHours(0,0,0,0),J(c,t)}function Ls(s,t){const a=K(s),r=+J(a,t)-+Ws(a,t);return Math.round(r/Se)+1}function p(s,t){const a=s<0?"-":"",r=Math.abs(s).toString().padStart(t,"0");return a+r}const H={y(s,t){const a=s.getFullYear(),r=a>0?a:1-a;return p(t==="yy"?r%100:r,t.length)},M(s,t){const a=s.getMonth();return t==="M"?String(a+1):p(a+1,2)},d(s,t){return p(s.getDate(),t.length)},a(s,t){const a=s.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(s,t){return p(s.getHours()%12||12,t.length)},H(s,t){return p(s.getHours(),t.length)},m(s,t){return p(s.getMinutes(),t.length)},s(s,t){return p(s.getSeconds(),t.length)},S(s,t){const a=t.length,r=s.getMilliseconds(),n=Math.trunc(r*Math.pow(10,a-3));return p(n,t.length)}},V={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},we={G:function(s,t,a){const r=s.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return a.era(r,{width:"abbreviated"});case"GGGGG":return a.era(r,{width:"narrow"});case"GGGG":default:return a.era(r,{width:"wide"})}},y:function(s,t,a){if(t==="yo"){const r=s.getFullYear(),n=r>0?r:1-r;return a.ordinalNumber(n,{unit:"year"})}return H.y(s,t)},Y:function(s,t,a,r){const n=He(s,r),c=n>0?n:1-n;if(t==="YY"){const o=c%100;return p(o,2)}return t==="Yo"?a.ordinalNumber(c,{unit:"year"}):p(c,t.length)},R:function(s,t){const a=Re(s);return p(a,t.length)},u:function(s,t){const a=s.getFullYear();return p(a,t.length)},Q:function(s,t,a){const r=Math.ceil((s.getMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return p(r,2);case"Qo":return a.ordinalNumber(r,{unit:"quarter"});case"QQQ":return a.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(r,{width:"wide",context:"formatting"})}},q:function(s,t,a){const r=Math.ceil((s.getMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return p(r,2);case"qo":return a.ordinalNumber(r,{unit:"quarter"});case"qqq":return a.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(r,{width:"wide",context:"standalone"})}},M:function(s,t,a){const r=s.getMonth();switch(t){case"M":case"MM":return H.M(s,t);case"Mo":return a.ordinalNumber(r+1,{unit:"month"});case"MMM":return a.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(r,{width:"wide",context:"formatting"})}},L:function(s,t,a){const r=s.getMonth();switch(t){case"L":return String(r+1);case"LL":return p(r+1,2);case"Lo":return a.ordinalNumber(r+1,{unit:"month"});case"LLL":return a.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(r,{width:"wide",context:"standalone"})}},w:function(s,t,a,r){const n=Ls(s,r);return t==="wo"?a.ordinalNumber(n,{unit:"week"}):p(n,t.length)},I:function(s,t,a){const r=Ks(s);return t==="Io"?a.ordinalNumber(r,{unit:"week"}):p(r,t.length)},d:function(s,t,a){return t==="do"?a.ordinalNumber(s.getDate(),{unit:"date"}):H.d(s,t)},D:function(s,t,a){const r=Is(s);return t==="Do"?a.ordinalNumber(r,{unit:"dayOfYear"}):p(r,t.length)},E:function(s,t,a){const r=s.getDay();switch(t){case"E":case"EE":case"EEE":return a.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(r,{width:"short",context:"formatting"});case"EEEE":default:return a.day(r,{width:"wide",context:"formatting"})}},e:function(s,t,a,r){const n=s.getDay(),c=(n-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(c);case"ee":return p(c,2);case"eo":return a.ordinalNumber(c,{unit:"day"});case"eee":return a.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(n,{width:"short",context:"formatting"});case"eeee":default:return a.day(n,{width:"wide",context:"formatting"})}},c:function(s,t,a,r){const n=s.getDay(),c=(n-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(c);case"cc":return p(c,t.length);case"co":return a.ordinalNumber(c,{unit:"day"});case"ccc":return a.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(n,{width:"narrow",context:"standalone"});case"cccccc":return a.day(n,{width:"short",context:"standalone"});case"cccc":default:return a.day(n,{width:"wide",context:"standalone"})}},i:function(s,t,a){const r=s.getDay(),n=r===0?7:r;switch(t){case"i":return String(n);case"ii":return p(n,t.length);case"io":return a.ordinalNumber(n,{unit:"day"});case"iii":return a.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(r,{width:"short",context:"formatting"});case"iiii":default:return a.day(r,{width:"wide",context:"formatting"})}},a:function(s,t,a){const n=s.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(s,t,a){const r=s.getHours();let n;switch(r===12?n=V.noon:r===0?n=V.midnight:n=r/12>=1?"pm":"am",t){case"b":case"bb":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(s,t,a){const r=s.getHours();let n;switch(r>=17?n=V.evening:r>=12?n=V.afternoon:r>=4?n=V.morning:n=V.night,t){case"B":case"BB":case"BBB":return a.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(s,t,a){if(t==="ho"){let r=s.getHours()%12;return r===0&&(r=12),a.ordinalNumber(r,{unit:"hour"})}return H.h(s,t)},H:function(s,t,a){return t==="Ho"?a.ordinalNumber(s.getHours(),{unit:"hour"}):H.H(s,t)},K:function(s,t,a){const r=s.getHours()%12;return t==="Ko"?a.ordinalNumber(r,{unit:"hour"}):p(r,t.length)},k:function(s,t,a){let r=s.getHours();return r===0&&(r=24),t==="ko"?a.ordinalNumber(r,{unit:"hour"}):p(r,t.length)},m:function(s,t,a){return t==="mo"?a.ordinalNumber(s.getMinutes(),{unit:"minute"}):H.m(s,t)},s:function(s,t,a){return t==="so"?a.ordinalNumber(s.getSeconds(),{unit:"second"}):H.s(s,t)},S:function(s,t){return H.S(s,t)},X:function(s,t,a){const r=s.getTimezoneOffset();if(r===0)return"Z";switch(t){case"X":return Ne(r);case"XXXX":case"XX":return B(r);case"XXXXX":case"XXX":default:return B(r,":")}},x:function(s,t,a){const r=s.getTimezoneOffset();switch(t){case"x":return Ne(r);case"xxxx":case"xx":return B(r);case"xxxxx":case"xxx":default:return B(r,":")}},O:function(s,t,a){const r=s.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+be(r,":");case"OOOO":default:return"GMT"+B(r,":")}},z:function(s,t,a){const r=s.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+be(r,":");case"zzzz":default:return"GMT"+B(r,":")}},t:function(s,t,a){const r=Math.trunc(s.getTime()/1e3);return p(r,t.length)},T:function(s,t,a){const r=s.getTime();return p(r,t.length)}};function be(s,t=""){const a=s>0?"-":"+",r=Math.abs(s),n=Math.trunc(r/60),c=r%60;return c===0?a+String(n):a+String(n)+t+p(c,2)}function Ne(s,t){return s%60===0?(s>0?"-":"+")+p(Math.abs(s)/60,2):B(s,t)}function B(s,t=""){const a=s>0?"-":"+",r=Math.abs(s),n=p(Math.trunc(r/60),2),c=p(r%60,2);return a+n+t+c}const ve=(s,t)=>{switch(s){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Qe=(s,t)=>{switch(s){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Rs=(s,t)=>{const a=s.match(/(P+)(p+)?/)||[],r=a[1],n=a[2];if(!n)return ve(s,t);let c;switch(r){case"P":c=t.dateTime({width:"short"});break;case"PP":c=t.dateTime({width:"medium"});break;case"PPP":c=t.dateTime({width:"long"});break;case"PPPP":default:c=t.dateTime({width:"full"});break}return c.replace("{{date}}",ve(r,t)).replace("{{time}}",Qe(n,t))},Hs={p:Qe,P:Rs},Qs=/^D+$/,Bs=/^Y+$/,Us=["D","DD","YY","YYYY"];function $s(s){return Qs.test(s)}function Gs(s){return Bs.test(s)}function Vs(s,t,a){const r=Xs(s,t,a);if(console.warn(r),Us.includes(s))throw new RangeError(r)}function Xs(s,t,a){const r=s[0]==="Y"?"years":"days of the month";return`Use \`${s.toLowerCase()}\` instead of \`${s}\` (in \`${t}\`) for formatting ${r} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const zs=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Js=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Zs=/^'([^]*?)'?$/,et=/''/g,st=/[a-zA-Z]/;function tt(s,t,a){var l,h,i,f;const r=ie(),n=r.locale??Ue,c=r.firstWeekContainsDate??((h=(l=r.locale)==null?void 0:l.options)==null?void 0:h.firstWeekContainsDate)??1,o=r.weekStartsOn??((f=(i=r.locale)==null?void 0:i.options)==null?void 0:f.weekStartsOn)??0,d=K(s);if(!qs(d))throw new RangeError("Invalid time value");let u=t.match(Js).map(x=>{const g=x[0];if(g==="p"||g==="P"){const v=Hs[g];return v(x,n.formatLong)}return x}).join("").match(zs).map(x=>{if(x==="''")return{isToken:!1,value:"'"};const g=x[0];if(g==="'")return{isToken:!1,value:at(x)};if(we[g])return{isToken:!0,value:x};if(g.match(st))throw new RangeError("Format string contains an unescaped latin alphabet character `"+g+"`");return{isToken:!1,value:x}});n.localize.preprocessor&&(u=n.localize.preprocessor(d,u));const m={firstWeekContainsDate:c,weekStartsOn:o,locale:n};return u.map(x=>{if(!x.isToken)return x.value;const g=x.value;(Gs(g)||$s(g))&&Vs(g,t,String(s));const v=we[g[0]];return v(d,g,n.localize,m)}).join("")}function at(s){const t=s.match(Zs);return t?t[1].replace(et,"'"):s}const rt=async s=>{const{data:t,error:a}=await k.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",s).order("created_at",{ascending:!1});if(a)throw a;return t},nt=async(s,t)=>{const{data:a,error:r}=await k.rpc("create_api_key",{p_organization_id:s,p_key_name:t});if(r)throw r;return a},it=async(s,t)=>{const{data:a,error:r}=await k.from("api_keys").update({status:t}).eq("id",s).select().single();if(r)throw r;return a},ct=({apiKey:s})=>{const[t,a]=S.useState(!1),r=()=>{navigator.clipboard.writeText(s),a(!0),j({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>a(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:s}),e.jsx(w,{variant:"ghost",size:"icon",onClick:r,children:t?e.jsx(Ae,{className:"h-4 w-4 text-green-500"}):e.jsx(ae,{className:"h-4 w-4"})})]})},lt=()=>{const{organization:s}=Z(),t=ee(),[a,r]=S.useState(""),[n,c]=S.useState(null),o=["apiKeys",s==null?void 0:s.id],{data:d,isLoading:u}=X({queryKey:o,queryFn:()=>rt(s.id),enabled:!!s}),m=A({mutationFn:i=>nt(s.id,i),onSuccess:i=>{j({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),c(i),r(""),t.invalidateQueries({queryKey:o})},onError:i=>{j({title:"Error",description:i.message,variant:"destructive"})}}),l=A({mutationFn:({keyId:i,status:f})=>it(i,f),onSuccess:()=>{j({title:"Status Updated"}),t.invalidateQueries({queryKey:o})},onError:i=>{j({title:"Error",description:i.message,variant:"destructive"})}}),h=i=>{i.preventDefault(),a.trim()&&s&&m.mutate(a.trim())};return e.jsxs(P,{className:"w-full",children:[e.jsxs(T,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Ms,{})," API Keys"]}),e.jsx(Ce,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(D,{children:[e.jsxs("form",{onSubmit:h,className:"flex items-center gap-2 mb-6",children:[e.jsx(q,{placeholder:"New key name (e.g., 'SMS Integration')",value:a,onChange:i=>r(i.target.value),disabled:m.isPending}),e.jsxs(w,{type:"submit",disabled:!a.trim()||m.isPending,children:[m.isPending?e.jsx($e,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Cs,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(Ge,{children:[e.jsx(Ve,{children:e.jsxs(se,{children:[e.jsx(G,{children:"Name"}),e.jsx(G,{children:"Key Prefix"}),e.jsx(G,{children:"Status"}),e.jsx(G,{children:"Last Used"}),e.jsx(G,{children:"Created"}),e.jsx(G,{className:"text-right",children:"Actions"})]})}),e.jsx(Xe,{children:u?Array.from({length:3}).map((i,f)=>e.jsx(se,{children:e.jsx(R,{colSpan:6,children:e.jsx(ze,{className:"h-8 w-full"})})},f)):d&&d.length>0?d.map(i=>e.jsxs(se,{children:[e.jsx(R,{className:"font-medium",children:i.key_name}),e.jsx(R,{children:e.jsxs("code",{children:[i.key_prefix,"..."]})}),e.jsx(R,{children:e.jsx($,{variant:i.status==="active"?"default":"secondary",children:i.status})}),e.jsx(R,{children:i.last_used_at?`${Je(new Date(i.last_used_at))} ago`:"Never"}),e.jsx(R,{children:tt(new Date(i.created_at),"MMM d, yyyy")}),e.jsx(R,{className:"text-right",children:e.jsxs(ke,{children:[e.jsx(Me,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"icon",disabled:l.isPending,children:i.status==="active"?e.jsx(_s,{className:"h-4 w-4"}):e.jsx(Ps,{className:"h-4 w-4"})})}),e.jsxs(_e,{children:[e.jsxs(Pe,{children:[e.jsx(De,{children:"Are you sure?"}),e.jsxs(Te,{children:["This will ",i.status==="active"?"deactivate":"activate"," the API key.",i.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(Oe,{children:[e.jsx(Ee,{children:"Cancel"}),e.jsx(Fe,{onClick:()=>l.mutate({keyId:i.id,status:i.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},i.id)):e.jsx(se,{children:e.jsx(R,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(Ze,{open:!!n,onOpenChange:i=>!i&&c(null),children:e.jsxs(es,{children:[e.jsxs(ss,{children:[e.jsx(ts,{children:"API Key Created Successfully"}),e.jsx(as,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(ct,{apiKey:n||""}),e.jsx(rs,{children:e.jsx(ns,{asChild:!0,children:e.jsx(w,{children:"Close"})})})]})})]})]})},ot=({organization:s,currentSettings:t,onSettingsUpdate:a})=>{var u,m;const r=ee(),[n,c]=S.useState({username:((u=t==null?void 0:t.sms_settings)==null?void 0:u.username)||"",apiKey:((m=t==null?void 0:t.sms_settings)==null?void 0:m.apiKey)||"",senderId:(t==null?void 0:t.sms_sender_id)||""}),o=A({mutationFn:async l=>{const{data:h,error:i}=await k.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:!0,senderId:l.senderId,username:l.username,apiKey:l.apiKey}});if(i)throw i;return h},onSuccess:()=>{j({title:"Success",description:"SMS settings updated successfully"}),r.invalidateQueries({queryKey:["organization-sms-settings"]}),a()},onError:l=>{j({title:"Error",description:l.message||"Failed to update SMS settings",variant:"destructive"})}}),d=l=>{if(l.preventDefault(),!n.username.trim()||!n.apiKey.trim()||!n.senderId.trim()){j({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"});return}o.mutate(n)};return e.jsxs(P,{children:[e.jsx(T,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"SMS Provider Settings"]})}),e.jsx(D,{children:e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"username",children:"Username *"}),e.jsx(q,{id:"username",type:"text",value:n.username,onChange:l=>c(h=>({...h,username:l.target.value})),placeholder:"Enter your SMS provider username",required:!0})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"apiKey",children:"API Key *"}),e.jsx(q,{id:"apiKey",type:"password",value:n.apiKey,onChange:l=>c(h=>({...h,apiKey:l.target.value})),placeholder:"Enter your SMS provider API key",required:!0})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"senderId",children:"Sender ID *"}),e.jsx(q,{id:"senderId",type:"text",value:n.senderId,onChange:l=>c(h=>({...h,senderId:l.target.value})),placeholder:"Enter your sender ID (e.g., 12345)",required:!0}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This is your SMS sender identifier that recipients will see"})]}),e.jsxs(w,{type:"submit",disabled:o.isPending,className:"w-full",children:[e.jsx(is,{className:"w-4 h-4 mr-2"}),o.isPending?"Saving...":"Save Settings"]})]})})]})},dt=({enabled:s,onToggle:t,isLoading:a})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"SMS Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to provide feedback via SMS"})]}),e.jsx(Ns,{checked:s,onCheckedChange:t,disabled:a})]}),ut=({webhookSecret:s,isVisible:t,isFlaskWrapper:a=!1})=>{const[r,n]=S.useState(!1),d=`${window.location.origin}${a?"/functions/v1/handle-flask-sms-callback":"/functions/v1/handle-sms-webhook"}`,u=m=>{navigator.clipboard.writeText(m),j({title:"Copied to clipboard",description:"Webhook URL has been copied to your clipboard"})};return t?e.jsxs(P,{children:[e.jsx(T,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5"}),a?"Flask Webhook Configuration":"SMS Webhook Configuration"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{value:d,readOnly:!0,className:"font-mono text-sm"}),e.jsx(w,{onClick:()=>u(d),variant:"outline",size:"icon",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?"Configure your Flask wrapper to send callbacks to this URL":"Configure this URL in your Africa's Talking SMS callback settings"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{children:"Webhook Secret"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{type:r?"text":"password",value:s,readOnly:!0,className:"font-mono text-sm"}),e.jsx(w,{onClick:()=>n(!r),variant:"outline",size:"icon",type:"button",children:r?e.jsx(ls,{className:"w-4 h-4"}):e.jsx(qe,{className:"w-4 h-4"})}),e.jsx(w,{onClick:()=>u(s),variant:"outline",size:"icon",children:e.jsx(ae,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use this secret to verify webhook authenticity"})]}),a&&e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(os,{className:"w-5 h-5 text-blue-500 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-sm",children:"Flask Integration Notes:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Your Flask wrapper should forward SMS callbacks to the webhook URL above"}),e.jsx("li",{children:"• Include the webhook secret in your callback validation"}),e.jsxs("li",{children:["• Ensure the callback format matches: ","{linkId, text, to, id, date, from}"]}),e.jsx("li",{children:"• The 'to' field should contain your organization's sender ID"})]})]})]})})]})]}):null},mt=({selectedProvider:s,onProviderSelect:t})=>{const a={id:"sms-provider",name:"SMS Provider (Flask Wrapper)",description:"SMS services via Flask wrapper integration",icon:Y,status:"available"};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"SMS Integration"}),e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${s===a.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>t(s===a.id?null:a.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a.icon,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"default",children:"Available"}),s===a.id&&e.jsx(Ae,{className:"w-4 h-4 text-blue-500"})]})]})})]})},ne=(s,t)=>{if(!s||typeof s!="object")return"";const a=s[t];return typeof a=="string"?a:""},ht=s=>{if(!s||typeof s!="object")return!1;const t=ne(s,"username"),a=ne(s,"apiKey");return t.length>0&&a.length>0},xt=()=>e.jsxs(T,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"SMS Integrations"]}),e.jsx(Ce,{children:"Enable SMS feedback collection from your customers"})]}),ft=({title:s="SMS Integrations"})=>e.jsxs(P,{children:[e.jsx(T,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),s]})}),e.jsx(D,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}),gt=({title:s="SMS Integrations",message:t,onRetry:a})=>e.jsxs(P,{children:[e.jsx(T,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5 text-red-500"}),s]})}),e.jsx(D,{children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-sm text-red-600 mb-2",children:"Organization not found or failed to load"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:t}),a&&e.jsx("button",{onClick:a,className:"text-sm text-blue-600 hover:underline",children:"Try again"})]})})]}),pt=()=>e.jsxs(P,{children:[e.jsx(T,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(D,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"You need admin access to manage SMS integrations."})})]}),jt=({phoneNumber:s,name:t,onPhoneNumberChange:a,onNameChange:r,onSubmit:n,isLoading:c})=>e.jsx("form",{onSubmit:n,className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"phone-number",children:"Phone Number *"}),e.jsx(q,{id:"phone-number",value:s,onChange:o=>a(o.target.value),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"name",children:"Name (Optional)"}),e.jsx(q,{id:"name",value:t,onChange:o=>r(o.target.value),placeholder:"John Doe"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(w,{type:"submit",disabled:c,className:"w-full",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Add Number"]})})]})}),yt=({bulkNumbers:s,onBulkNumbersChange:t,onBulkAdd:a,onCancel:r,isLoading:n})=>e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"bulk-numbers",children:"Bulk Add Phone Numbers"}),e.jsx(Ie,{id:"bulk-numbers",value:s,onChange:c=>t(c.target.value),placeholder:"Enter phone numbers, one per line. Format: +1234567890 or +1234567890,John Doe",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Format: One phone number per line. Optionally add name after comma."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{onClick:a,disabled:n,children:"Add All Numbers"}),e.jsx(w,{variant:"outline",onClick:r,children:"Cancel"})]})]}),wt=({phoneNumbers:s,onDelete:t,isDeleting:a})=>{const r=n=>n.startsWith("+")?n:`+${n}`;return s.length===0?e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No phone numbers added yet."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers to start sending SMS campaigns."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Registered Phone Numbers"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:s.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:r(n.phone_number)}),n.name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:n.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx($,{variant:n.status==="active"?"default":"secondary",children:n.status}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Added ",new Date(n.created_at).toLocaleDateString()]})]})]}),e.jsx(w,{variant:"ghost",size:"sm",onClick:()=>t(n.id),disabled:a,children:e.jsx(Ke,{className:"w-4 h-4"})})]},n.id))})]})},bt=()=>{const{organization:s}=Z(),t=ee(),[a,r]=S.useState(""),[n,c]=S.useState(""),[o,d]=S.useState(""),[u,m]=S.useState(!1),{data:l,isLoading:h}=X({queryKey:["sms-phone-numbers",s==null?void 0:s.id],queryFn:async()=>{const{data:y,error:N}=await k.from("sms_phone_numbers").select("*").eq("organization_id",s.id).order("created_at",{ascending:!1});if(N)throw N;return y},enabled:!!(s!=null&&s.id)}),i=A({mutationFn:async({phoneNumber:y,name:N})=>{const{data:M,error:C}=await k.from("sms_phone_numbers").insert({organization_id:s.id,phone_number:y.trim(),name:(N==null?void 0:N.trim())||null}).select().single();if(C)throw C;return M},onSuccess:()=>{j({title:"Phone number added successfully"}),r(""),c(""),t.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:y=>{j({title:"Error adding phone number",description:y.message,variant:"destructive"})}}),f=A({mutationFn:async y=>{const{data:N,error:M}=await k.from("sms_phone_numbers").insert(y.map(({phoneNumber:C,name:_})=>({organization_id:s.id,phone_number:C.trim(),name:(_==null?void 0:_.trim())||null})));if(M)throw M;return N},onSuccess:()=>{j({title:"Phone numbers added successfully"}),d(""),m(!1),t.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:y=>{j({title:"Error adding phone numbers",description:y.message,variant:"destructive"})}}),x=A({mutationFn:async y=>{const{error:N}=await k.from("sms_phone_numbers").delete().eq("id",y);if(N)throw N},onSuccess:()=>{j({title:"Phone number removed successfully"}),t.invalidateQueries({queryKey:["sms-phone-numbers",s==null?void 0:s.id]})},onError:y=>{j({title:"Error removing phone number",description:y.message,variant:"destructive"})}}),g=y=>{y.preventDefault(),a.trim()&&i.mutate({phoneNumber:a,name:n})},v=()=>{const N=o.split(`
`).filter(M=>M.trim()).map(M=>{const C=M.split(",").map(_=>_.trim());return{phoneNumber:C[0],name:C[1]||void 0}}).filter(M=>M.phoneNumber);if(N.length===0){j({title:"No valid phone numbers found",description:"Please enter at least one phone number",variant:"destructive"});return}f.mutate(N)};return h?e.jsxs(P,{children:[e.jsx(T,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Phone Numbers"]})}),e.jsx(D,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}):e.jsxs(P,{children:[e.jsx(T,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"Phone Numbers (",(l==null?void 0:l.length)||0,")"]})}),e.jsxs(D,{className:"space-y-6",children:[e.jsx(jt,{phoneNumber:a,name:n,onPhoneNumberChange:r,onNameChange:c,onSubmit:g,isLoading:i.isPending}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(w,{variant:"outline",onClick:()=>m(!u),children:[e.jsx(Os,{className:"w-4 h-4 mr-2"}),"Bulk Add"]})}),u&&e.jsx(yt,{bulkNumbers:o,onBulkNumbersChange:d,onBulkAdd:v,onCancel:()=>m(!1),isLoading:f.isPending}),e.jsx(wt,{phoneNumbers:l||[],onDelete:y=>x.mutate(y),isDeleting:x.isPending})]})]})},Nt=()=>{const{user:s}=le(),{organization:t}=Z(),a=ee(),{data:r=[],isLoading:n,error:c}=X({queryKey:["sms-campaigns",t==null?void 0:t.id],queryFn:async()=>{if(!(t!=null&&t.id))return[];const{data:i,error:f}=await k.from("sms_campaigns").select("*").eq("organization_id",t.id).order("created_at",{ascending:!1});if(f)throw f;return i||[]},enabled:!!(t!=null&&t.id)}),{data:o=[],isLoading:d,error:u}=X({queryKey:["sms-phone-numbers",t==null?void 0:t.id],queryFn:async()=>{if(!(t!=null&&t.id))return[];const{data:i,error:f}=await k.from("sms_phone_numbers").select("*").eq("organization_id",t.id).eq("status","active").order("created_at",{ascending:!1});if(f)throw f;return i||[]},enabled:!!(t!=null&&t.id)}),m=A({mutationFn:async({name:i,template:f})=>{if(!(t!=null&&t.id)||!(s!=null&&s.id))throw new Error("Missing organization or user");const{data:x,error:g}=await k.from("sms_campaigns").insert({organization_id:t.id,name:i,message_template:f,created_by_user_id:s.id,status:"draft"}).select().single();if(g)throw g;return x},onSuccess:()=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),j({title:"Success",description:"Campaign created successfully"})},onError:i=>{console.error("Error creating campaign:",i),j({title:"Error",description:"Failed to create campaign",variant:"destructive"})}}),l=A({mutationFn:async({campaignId:i,isResend:f=!1,isRetry:x=!1})=>{const{data:g,error:v}=await k.functions.invoke("send-sms-flask",{body:{campaignId:i,isResend:f,isRetry:x}});if(v)throw v;return g},onSuccess:i=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),a.invalidateQueries({queryKey:["sms-sends"]}),j({title:"Success",description:`Campaign sent successfully! ${i.sentCount}/${i.sentCount+i.failedCount} messages delivered.`})},onError:i=>{console.error("Error sending campaign:",i),j({title:"Error",description:"Failed to send campaign",variant:"destructive"})}}),h=A({mutationFn:async({campaignId:i,action:f})=>{let x;switch(f){case"pause":x="paused";break;case"resume":x="sending";break;case"cancel":x="cancelled";break;default:throw new Error("Invalid action")}const{error:g}=await k.from("sms_campaigns").update({status:x}).eq("id",i);if(g)throw g},onSuccess:(i,{action:f})=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),j({title:"Success",description:`Campaign ${f}d successfully`})},onError:i=>{console.error("Error controlling campaign:",i),j({title:"Error",description:"Failed to update campaign status",variant:"destructive"})}});return{campaigns:r,campaignsLoading:n,campaignsError:c,phoneNumbers:o,phoneNumbersLoading:d,phoneNumbersError:u,createCampaignMutation:m,sendCampaignMutation:l,campaignControlMutation:h,organization:t}},vt=({onSubmit:s,onCancel:t,isLoading:a,phoneNumbersCount:r,organizationName:n})=>{const[c,o]=S.useState(""),[d,u]=S.useState(""),m=`Hi! We'd love your feedback on our service. Please text back 'START' to begin a quick survey. Your input helps us improve. Thank you! - ${n||"Your Company"}`,l=h=>{h.preventDefault(),!(!c.trim()||!d.trim())&&(s(c,d),o(""),u(""))};return e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium",children:"Create New Campaign"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(I,{htmlFor:"campaign-name",children:"Campaign Name *"}),e.jsx(q,{id:"campaign-name",value:c,onChange:h=>o(h.target.value),placeholder:"Feedback Request Campaign",required:!0})]}),e.jsxs("div",{children:[e.jsx(I,{htmlFor:"message-template",children:"Message Template *"}),e.jsx(Ie,{id:"message-template",value:d,onChange:h=>u(h.target.value),placeholder:m,rows:4,required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Recipients: ",r," active phone numbers"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"submit",disabled:a,children:"Create Campaign"}),e.jsx(w,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})},St=({campaign:s})=>{const t=s.sent_count>0?s.delivered_count/s.sent_count*100:0,a=s.sent_count>0?s.failed_count/s.sent_count*100:0,r=s.total_recipients>0?s.sent_count/s.total_recipients*100:0,n=()=>{if(!s.started_at)return null;const c=new Date(s.started_at),d=(s.completed_at?new Date(s.completed_at):new Date).getTime()-c.getTime(),u=Math.round(d/(1e3*60));return u<60?`${u}m`:`${Math.round(u/60)}h ${u%60}m`};return e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-blue-50 rounded-lg",children:[e.jsx(z,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-blue-900",children:s.sent_count}),e.jsx("div",{className:"text-xs text-blue-600",children:"Sent"}),e.jsx(We,{value:r,className:"h-1 mt-1"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 rounded-lg",children:[e.jsx(ds,{className:"w-4 h-4 text-green-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-green-900",children:[t.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-green-600",children:"Delivered"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[s.delivered_count,"/",s.sent_count]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 rounded-lg",children:[e.jsx(Le,{className:"w-4 h-4 text-red-600"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-red-900",children:[a.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-red-600",children:"Failed"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:s.failed_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-purple-50 rounded-lg",children:[e.jsx(us,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-purple-900",children:n()||"N/A"}),e.jsx("div",{className:"text-xs text-purple-600",children:"Duration"}),e.jsx($,{variant:"outline",className:"text-xs mt-1",children:s.status})]})]})]})},Ct=({campaign:s,onSend:t,onResend:a,onRetry:r,onDuplicate:n,onSchedule:c,onDelete:o,onCancel:d,onPause:u,onResume:m,isLoading:l})=>{const[h,i]=S.useState(!1),f=y=>{switch(y){case"completed":return"default";case"sending":return"secondary";case"paused":return"outline";case"failed":return"destructive";case"draft":return"outline";default:return"secondary"}},x=y=>{switch(y){case"completed":return"text-green-600";case"sending":return"text-blue-600";case"paused":return"text-yellow-600";case"failed":return"text-red-600";case"draft":return"text-gray-600";default:return"text-gray-600"}},g=s.total_recipients>0?s.sent_count/s.total_recipients*100:0,v=s.status==="sending"&&s.started_at&&new Date().getTime()-new Date(s.started_at).getTime()>10*60*1e3;return e.jsx(P,{className:"transition-all duration-200 hover:shadow-md",children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h5",{className:"font-semibold text-lg",children:s.name}),e.jsx($,{variant:f(s.status),className:x(s.status),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),v&&e.jsxs($,{variant:"destructive",className:"text-orange-700 bg-orange-100",children:[e.jsx(Le,{className:"w-3 h-3 mr-1"}),"Stuck"]})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Created ",new Date(s.created_at).toLocaleDateString()," • ",s.total_recipients," recipients"]}),(s.status==="sending"||s.status==="paused")&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[s.sent_count,"/",s.total_recipients]})]}),e.jsx(We,{value:g,className:"h-2"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="draft"&&e.jsxs(w,{size:"sm",onClick:()=>t(s.id),disabled:l,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Send Now"]}),s.status==="sending"&&e.jsxs(e.Fragment,{children:[e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>u(s.id),disabled:l,children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),"Pause"]}),e.jsxs(w,{size:"sm",variant:"destructive",onClick:()=>d(s.id),disabled:l,children:[e.jsx(Ts,{className:"w-4 h-4 mr-2"}),"Cancel"]})]}),s.status==="paused"&&e.jsxs(w,{size:"sm",onClick:()=>m(s.id),disabled:l,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Resume"]}),s.status==="failed"&&e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>r(s.id),disabled:l,children:[e.jsx(Ds,{className:"w-4 h-4 mr-2"}),"Retry"]}),s.status==="completed"&&s.failed_count>0&&e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>a(s.id),disabled:l,children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Resend Failed"]}),v&&e.jsxs(w,{size:"sm",variant:"outline",onClick:()=>r(s.id),disabled:l,className:"border-orange-500 text-orange-700 hover:bg-orange-50",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Force Retry"]}),e.jsxs(hs,{children:[e.jsx(xs,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"sm",children:e.jsx(fs,{className:"w-4 h-4"})})}),e.jsxs(gs,{align:"end",children:[e.jsxs(te,{onClick:()=>i(!h),children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),h?"Hide":"Show"," Analytics"]}),e.jsxs(te,{onClick:()=>n(s.id),children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Duplicate Campaign"]}),s.status==="draft"&&e.jsxs(te,{onClick:()=>c(s.id),children:[e.jsx(ps,{className:"w-4 h-4 mr-2"}),"Schedule Campaign"]}),e.jsx(js,{}),e.jsxs(ke,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs(te,{onSelect:y=>y.preventDefault(),className:"text-red-600",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2"}),"Delete Campaign"]})}),e.jsxs(_e,{children:[e.jsxs(Pe,{children:[e.jsx(De,{children:"Delete Campaign"}),e.jsxs(Te,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone.']})]}),e.jsxs(Oe,{children:[e.jsx(Ee,{children:"Cancel"}),e.jsx(Fe,{onClick:()=>o(s.id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Message Preview:"}),e.jsx("p",{className:"text-sm text-blue-800 leading-relaxed",children:s.message_template.length>120?`${s.message_template.substring(0,120)}...`:s.message_template})]})}),h&&e.jsx(St,{campaign:s})]})})},kt=({searchTerm:s,onSearchChange:t,statusFilter:a,onStatusFilterChange:r,sortBy:n,onSortByChange:c,sortOrder:o,onSortOrderChange:d,totalCampaigns:u,filteredCount:m})=>{const l=()=>{t(""),r("all"),c("created_at"),d("desc")},h=s||a!=="all";return e.jsxs("div",{className:"w-full space-y-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters"}),h&&e.jsxs($,{variant:"secondary",className:"text-xs",children:[m," of ",u]})]}),h&&e.jsx(w,{variant:"ghost",size:"sm",onClick:l,children:"Clear All"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(ys,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(q,{placeholder:"Search campaigns...",value:s,onChange:i=>t(i.target.value),className:"pl-10 w-full"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(me,{value:a,onValueChange:r,children:[e.jsx(he,{className:"w-full sm:w-[150px]",children:e.jsx(xe,{placeholder:"Status"})}),e.jsxs(fe,{children:[e.jsx(L,{value:"all",children:"All Status"}),e.jsx(L,{value:"draft",children:"Draft"}),e.jsx(L,{value:"sending",children:"Sending"}),e.jsx(L,{value:"completed",children:"Completed"}),e.jsx(L,{value:"failed",children:"Failed"})]})]}),e.jsxs(me,{value:n,onValueChange:c,children:[e.jsx(he,{className:"w-full sm:w-[150px]",children:e.jsx(xe,{placeholder:"Sort by"})}),e.jsxs(fe,{children:[e.jsx(L,{value:"created_at",children:"Created Date"}),e.jsx(L,{value:"name",children:"Name"}),e.jsx(L,{value:"total_recipients",children:"Recipients"}),e.jsx(L,{value:"delivered_count",children:"Delivery Rate"})]})]}),e.jsx(w,{variant:"outline",size:"sm",onClick:()=>d(o==="asc"?"desc":"asc"),className:"w-full sm:w-auto",children:o==="asc"?e.jsx(Ss,{className:"w-4 h-4"}):e.jsx(vs,{className:"w-4 h-4"})})]})]})]})},Mt=({campaigns:s,onSend:t,onResend:a,onRetry:r,onCancel:n,onPause:c,onResume:o,onDuplicate:d,onSchedule:u,onDelete:m,onCreateNew:l,isLoading:h})=>{const[i,f]=S.useState(""),[x,g]=S.useState("all"),[v,y]=S.useState("created_at"),[N,M]=S.useState("desc"),C=S.useMemo(()=>{let _=s.filter(b=>{const W=b.name.toLowerCase().includes(i.toLowerCase())||b.message_template.toLowerCase().includes(i.toLowerCase()),E=x==="all"||b.status===x;return W&&E});return _.sort((b,W)=>{let E=b[v],Q=W[v];if(v==="created_at"&&(E=new Date(E).getTime(),Q=new Date(Q).getTime()),typeof E=="number"&&typeof Q=="number")return N==="asc"?E-Q:Q-E;if(typeof E=="string"&&typeof Q=="string"){const oe=E.localeCompare(Q);return N==="asc"?oe:-oe}return 0}),_},[s,i,x,v,N]);return s.length===0?e.jsxs("div",{className:"w-full text-center p-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(Y,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No campaigns yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Create your first SMS campaign to start reaching your audience with targeted messages."}),e.jsxs(w,{onClick:l,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Create Your First Campaign"]})]}):e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Campaign Management"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.length," campaign",s.length!==1?"s":""," total",C.length!==s.length&&` • ${C.length} shown`]})]}),e.jsxs(w,{onClick:l,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"New Campaign"]})]}),e.jsx(kt,{searchTerm:i,onSearchChange:f,statusFilter:x,onStatusFilterChange:g,sortBy:v,onSortByChange:y,sortOrder:N,onSortOrderChange:M,totalCampaigns:s.length,filteredCount:C.length}),e.jsx("div",{className:"w-full space-y-4",children:C.length===0?e.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No campaigns match your current filters."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search or filter criteria."})]}):C.map(_=>e.jsx(Ct,{campaign:_,onSend:t,onResend:a,onRetry:r,onCancel:n,onPause:c,onResume:o,onDuplicate:d,onSchedule:u,onDelete:m,isLoading:h},_.id))})]})},_t=()=>e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No active phone numbers found."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers before creating campaigns."})]}),Pt=()=>{const[s,t]=S.useState(!1),{campaigns:a,campaignsLoading:r,campaignsError:n,phoneNumbers:c,phoneNumbersLoading:o,phoneNumbersError:d,createCampaignMutation:u,sendCampaignMutation:m,campaignControlMutation:l,organization:h}=Nt(),i=(b,W)=>{u.mutate({name:b,template:W},{onSuccess:()=>{t(!1)}})},f=b=>{m.mutate({campaignId:b})},x=b=>{m.mutate({campaignId:b,isResend:!0})},g=b=>{m.mutate({campaignId:b,isRetry:!0})},v=b=>{l.mutate({campaignId:b,action:"cancel"})},y=b=>{l.mutate({campaignId:b,action:"pause"})},N=b=>{l.mutate({campaignId:b,action:"resume"})},M=b=>{const W=a.find(E=>E.id===b);W&&(u.mutate({name:`${W.name} (Copy)`,template:W.message_template}),j({title:"Campaign duplicated successfully"}))},C=b=>{j({title:"Scheduling feature coming soon",description:"Campaign scheduling will be available in the next update."})},_=b=>{j({title:"Delete feature coming soon",description:"Campaign deletion will be available in the next update."})};return r||o?e.jsx("div",{className:"w-full",children:e.jsxs(P,{className:"w-full",children:[e.jsx(T,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(D,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]})}):n||d?e.jsx("div",{className:"w-full",children:e.jsxs(P,{className:"w-full",children:[e.jsx(T,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(D,{children:e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 rounded-lg",children:[e.jsx(Ye,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Failed to load campaigns or phone numbers"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:(n==null?void 0:n.message)||(d==null?void 0:d.message)||"An unexpected error occurred"})]})]})})]})}):e.jsx("div",{className:"w-full",children:e.jsxs(P,{className:"w-full",children:[e.jsx(T,{children:e.jsx(O,{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"SMS Campaigns"]})})}),e.jsx(D,{className:"space-y-6 p-6",children:c.length===0?e.jsx(_t,{}):e.jsxs("div",{className:"w-full space-y-6",children:[s&&e.jsx("div",{className:"w-full",children:e.jsx(vt,{onSubmit:i,onCancel:()=>t(!1),isLoading:u.isPending,phoneNumbersCount:c.length,organizationName:h==null?void 0:h.name})}),e.jsx("div",{className:"w-full",children:e.jsx(Mt,{campaigns:a,onSend:f,onResend:x,onRetry:g,onCancel:v,onPause:y,onResume:N,onDuplicate:M,onSchedule:C,onDelete:_,onCreateNew:()=>t(!0),isLoading:m.isPending||l.isPending})})]})})]})})},Dt=()=>e.jsx("div",{className:"w-full mt-6",children:e.jsxs(ws,{defaultValue:"phone-numbers",className:"w-full",children:[e.jsxs(bs,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(ge,{value:"phone-numbers",className:"flex-1",children:"Phone Numbers"}),e.jsx(ge,{value:"campaigns",className:"flex-1",children:"Campaigns"})]}),e.jsx(pe,{value:"phone-numbers",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(bt,{})})}),e.jsx(pe,{value:"campaigns",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Pt,{})})})]})}),Tt=()=>{const{organization:s}=Z(),t=ee(),{data:a,isLoading:r,error:n}=X({queryKey:["organization-sms-settings",s==null?void 0:s.id],queryFn:async()=>{console.log("Fetching SMS settings for organization:",s==null?void 0:s.id);const{data:o,error:d}=await k.from("organizations").select("sms_enabled, sms_sender_id, sms_settings, webhook_secret").eq("id",s.id).single();if(d)throw console.error("Error fetching organization SMS settings:",d),d;return console.log("Organization SMS settings fetched:",o),o},enabled:!!(s!=null&&s.id),retry:3,retryDelay:1e3}),c=A({mutationFn:async o=>{if(!(s!=null&&s.id))throw new Error("Organization not found");console.log("Updating SMS status:",{enabled:o,orgId:s.id});const{data:d,error:u}=await k.functions.invoke("update-sms-settings",{body:{orgId:s.id,enabled:o,senderId:(a==null?void 0:a.sms_sender_id)||"",username:ne(a==null?void 0:a.sms_settings,"username"),apiKey:ne(a==null?void 0:a.sms_settings,"apiKey")}});if(u)throw console.error("SMS status update error:",u),new Error(u.message||"Failed to update SMS settings");return console.log("SMS status updated successfully:",d),d},onSuccess:()=>{j({title:"SMS status updated successfully"}),t.invalidateQueries({queryKey:["organization-sms-settings",s==null?void 0:s.id]})},onError:o=>{console.error("SMS toggle error:",o),j({title:"Error updating SMS status",description:o.message||"An unexpected error occurred",variant:"destructive"})}});return{orgData:a,isLoading:r,error:n,updateSmsStatus:c,organization:s}},Ot=()=>{const{isAdmin:s,isOrgAdmin:t}=le(),[a,r]=S.useState(null),{orgData:n,isLoading:c,error:o,updateSmsStatus:d,organization:u}=Tt(),m=s||t,l=i=>{if(!m){j({title:"Access denied",description:"You need admin access to manage SMS settings",variant:"destructive"});return}if(!(u!=null&&u.id)){j({title:"Error",description:"Organization not found",variant:"destructive"});return}d.mutate(i)};if(!m)return e.jsx(pt,{});if(c)return e.jsx(ft,{});if(o){const i=typeof o=="string"?o:"Failed to load SMS settings";return e.jsx(gt,{message:i})}const h=(n==null?void 0:n.sms_enabled)&&ht(n==null?void 0:n.sms_settings);return e.jsx("div",{className:"w-full",children:e.jsxs(P,{className:"w-full",children:[e.jsx(xt,{}),e.jsxs(D,{className:"space-y-6 p-6",children:[e.jsx(dt,{enabled:(n==null?void 0:n.sms_enabled)||!1,onToggle:l,isLoading:d.isPending}),(n==null?void 0:n.sms_enabled)&&e.jsx(ut,{webhookSecret:(n==null?void 0:n.webhook_secret)||"",isVisible:!0,isFlaskWrapper:!0}),e.jsx(mt,{selectedProvider:a,onProviderSelect:r}),a==="sms-provider"&&e.jsx(ot,{organization:u,currentSettings:n,onSettingsUpdate:()=>{}}),h&&e.jsx("div",{className:"w-full",children:e.jsx(Dt,{})})]})]})})},At=()=>{const{isAdmin:s,isOrgAdmin:t}=le();return Z(),s||t?e.jsxs("div",{className:"w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."})]}),e.jsx("div",{className:"w-full",children:e.jsx(Ot,{})}),e.jsx("div",{className:"w-full",children:e.jsx(lt,{})})]}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage integrations."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]})};export{At as IntegrationsTab,At as default};
