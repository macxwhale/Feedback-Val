import{b0 as p,ae as y,ac as q,j as e,C as v,k as A,q as R,b1 as b,l as w,B as C,b2 as P,T as g,i as j,b3 as o,r as B,ao as F}from"./index-DtITnSs2.js";const T=({organizationId:i}={})=>{const{hasPermission:a,userRole:s,isLoading:n,isAdmin:r}=p(i),{isOrgAdmin:l,isAdmin:c}=y();return{hasPermission:t=>r||c||s&&["owner","admin"].includes(s)||l&&i?!0:a(t),hasRole:t=>r||c||s&&["owner","admin"].includes(s)||l&&i?!0:s===t,userRole:s,isLoading:n,isSystemAdmin:r||c,isOrgAdmin:l||s&&["owner","admin"].includes(s)}},N=({type:i,requiredRole:a,requiredPermission:s,userRole:n,onRequestAccess:r,isSubmitting:l=!1})=>{const{organization:c}=q(),d=()=>{if(!a||!n)return null;const t=o(a),m=o(n),x=t.icon,h=m.icon;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-4 h-4 text-amber-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["You need ",t.label," level access or higher."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Required role:"}),e.jsxs(j,{variant:t.variant,className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-3 h-3"}),t.label]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Your role:"}),e.jsxs(j,{variant:m.variant,className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),m.label]})]})]})]})},u=()=>{if(!s||!n)return null;const t=o(n).icon;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-4 h-4 text-amber-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["You don't have the required permission: ",s]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Your role:"}),e.jsxs(j,{variant:o(n).variant,className:"flex items-center gap-1",children:[e.jsx(t,{className:"w-3 h-3"}),o(n).label]})]})]})};return e.jsxs(v,{className:"border-red-200",children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center text-red-600",children:[e.jsx(b,{className:"w-5 h-5 mr-2"}),i==="role"?"Access Restricted":"Permission Required"]})}),e.jsxs(w,{className:"space-y-4",children:[i==="role"?d():u(),c&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Organization:"})," ",c.name]})}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs(C,{onClick:r,size:"sm",className:"w-full",disabled:l,children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),l?"Requesting...":i==="role"?"Request Role Upgrade":"Request Access"]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Contact your organization administrator for assistance."})]})]})]})},k=()=>{const[i,a]=B.useState(!1);return{submitAccessRequest:async n=>{a(!0);try{console.log("Access request submitted:",n),await new Promise(r=>setTimeout(r,1e3)),console.log("Access request submitted successfully")}catch(r){throw console.error("Failed to submit access request:",r),r}finally{a(!1)}},isSubmitting:i}},L=({children:i,permission:a,role:s,organizationId:n,fallback:r,showRequiredRole:l=!1,onRequestAccess:c})=>{const{hasPermission:d,hasRole:u,userRole:t,isLoading:m}=T({organizationId:n}),{submitAccessRequest:x,isSubmitting:h}=k();if(m)return e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Checking permissions..."})]})});if(a&&!d(a)){if(r)return e.jsx(e.Fragment,{children:r});if(!l)return null;const f=async()=>{c?c():await x({requestType:"permission",requestedPermission:a,reason:`Need ${a} permission to access this feature`})};return e.jsx(N,{type:"permission",requiredPermission:a,userRole:t,onRequestAccess:f,isSubmitting:h})}if(s&&!u(s)){if(r)return e.jsx(e.Fragment,{children:r});if(!l)return null;const f=async()=>{c?c():await x({requestType:"role_upgrade",requestedRole:s,reason:`Need ${s} level access for this feature`})};return e.jsx(N,{type:"role",requiredRole:s,userRole:t,onRequestAccess:f,isSubmitting:h})}return e.jsx(e.Fragment,{children:i})};export{L as P,T as u};
