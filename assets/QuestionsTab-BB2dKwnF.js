import{c as $,s as S,r as M,j as e,a1 as g,a5 as G,I as m,C as q,l as f,B as b,a2 as Y,a6 as U,a7 as J,J as X,u as V,K as E,k as L,o as z,G as W}from"./index-ConGIHum.js";import{S as I,a as F,b as H,c as R,d as K}from"./select-DA3BuGjN.js";import{T as Z}from"./trash-2-DRPYGOj3.js";import{u as D}from"./useOrganization-BqyvaAuQ.js";import{P as C}from"./PermissionGuard-CAFU3L_h.js";import"./index-CDjH1dzu.js";import"./eye-DnoyIp1m.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=$("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=$("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),k="https://rigurrwjiaucodxuuzeh.supabase.co/functions/v1/questions-crud",T=async()=>{const{data:{session:t},error:s}=await S.auth.getSession();if(s||!(t!=null&&t.access_token))throw new Error("Authentication required");return{Authorization:`Bearer ${t.access_token}`,"Content-Type":"application/json"}},A=async t=>{if(!t.ok){let s;try{s=await t.json()}catch{s={error:`HTTP ${t.status}: ${t.statusText}`}}console.error("API Error Response:",{status:t.status,statusText:t.statusText,error:s});const a=s.error||s.message||`HTTP ${t.status}: ${t.statusText}`;throw new Error(a)}try{return await t.json()}catch(s){throw console.error("Error parsing response JSON:",s),new Error("Invalid response format from server")}},_={async getQuestions(){try{const t=await T(),s=await fetch(k,{method:"GET",headers:t}),a=await A(s);return console.log("Successfully fetched questions:",(a==null?void 0:a.length)||0),a}catch(t){throw console.error("Error fetching questions:",t),t}},async createQuestion(t){try{console.log("Creating question:",t);const s=await T(),a=await fetch(k,{method:"POST",headers:s,body:JSON.stringify(t)}),c=await A(a);return console.log("Successfully created question:",c==null?void 0:c.id),c}catch(s){throw console.error("Error creating question:",s),s}},async updateQuestion(t,s){try{console.log("Updating question:",t,s);const a=await T(),c=await fetch(k,{method:"PUT",headers:a,body:JSON.stringify({id:t,...s})}),r=await A(c);return console.log("Successfully updated question:",r==null?void 0:r.id),r}catch(a){throw console.error("Error updating question:",a),a}},async deleteQuestion(t){try{console.log("Deleting question:",t);const{data:s,error:a}=await S.rpc("safe_delete_question",{question_uuid:t});if(a)throw console.error("Error deleting question:",a),a;const c={deleted:s,archived:!s};return console.log("Question deletion result:",c),c}catch(s){throw console.error("Error deleting question:",s),s}},async getQuestionTypes(){try{const{data:t,error:s}=await S.from("question_types").select("*").order("name");if(s)throw console.error("Error fetching question types:",s),s;return console.log("Successfully fetched question types:",(t==null?void 0:t.length)||0),t||[]}catch(t){return console.error("Error fetching question types:",t),[]}},async getQuestionCategories(){try{const{data:t,error:s}=await S.from("question_categories").select("*").order("name");if(s)throw console.error("Error fetching question categories:",s),s;return console.log("Successfully fetched question categories:",(t==null?void 0:t.length)||0),t||[]}catch(t){return console.error("Error fetching question categories:",t),[]}}},se=({questionType:t,supportsOptions:s,supportsScale:a,options:c=[],scaleConfig:r,helpText:x="",placeholderText:l="",onOptionsChange:j,onScaleChange:h,onHelpTextChange:o,onPlaceholderChange:d})=>{const[y,v]=M.useState(c.length>0?c:w());function w(){return t==="emoji"?[{text:"😊",value:"happy"},{text:"😐",value:"neutral"},{text:"😞",value:"sad"}]:[{text:""},{text:""}]}const O=()=>{const i=t==="emoji"?{text:"😊",value:""}:{text:""},u=[...y,i];v(u),j(u)},Q=i=>{const u=y.filter((p,N)=>N!==i);v(u),j(u)},n=(i,u,p)=>{const N=y.map((P,B)=>B===i?{...P,[u]:p}:P);v(N),j(N)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"help-text",children:"Help Text (optional)"}),e.jsx(G,{id:"help-text",value:x,onChange:i=>o(i.target.value),placeholder:"Additional guidance for users...",className:"mt-1"})]}),t==="text"&&e.jsxs("div",{children:[e.jsx(g,{htmlFor:"placeholder",children:"Placeholder Text"}),e.jsx(m,{id:"placeholder",value:l,onChange:i=>d(i.target.value),placeholder:"Enter placeholder text...",className:"mt-1"})]}),s&&e.jsx(q,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{children:t==="emoji"?"Emoji Options":"Answer Options"}),t==="emoji"&&e.jsx("p",{className:"text-sm text-gray-600",children:"Enter emoji characters (😊, 😐, 😞, etc.) for users to select from"}),y.map((i,u)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{value:i.text,onChange:p=>n(u,"text",p.target.value),placeholder:t==="emoji"?"😊":`Option ${u+1}`,className:t==="emoji"?"w-16 text-center text-2xl":"flex-1"}),t!=="emoji"&&e.jsx(m,{value:i.value||"",onChange:p=>n(u,"value",p.target.value),placeholder:"Value",className:"w-20"}),t==="emoji"&&e.jsx(m,{value:i.value||"",onChange:p=>n(u,"value",p.target.value),placeholder:"Description",className:"flex-1"}),y.length>(t==="emoji"?1:2)&&e.jsx(b,{type:"button",variant:"outline",size:"sm",onClick:()=>Q(u),children:e.jsx(Y,{className:"w-4 h-4"})})]},u)),e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:O,className:"w-full",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),"Add ",t==="emoji"?"Emoji":"Option"]})]})})}),a&&e.jsx(q,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{children:"Scale Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"min-value",children:"Min Value"}),e.jsx(m,{id:"min-value",type:"number",value:(r==null?void 0:r.minValue)||1,onChange:i=>h({...r,minValue:parseInt(i.target.value)||1,maxValue:(r==null?void 0:r.maxValue)||5})})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"max-value",children:"Max Value"}),e.jsx(m,{id:"max-value",type:"number",value:(r==null?void 0:r.maxValue)||5,onChange:i=>h({...r,minValue:(r==null?void 0:r.minValue)||1,maxValue:parseInt(i.target.value)||5})})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"min-label",children:"Min Label"}),e.jsx(m,{id:"min-label",value:(r==null?void 0:r.minLabel)||"",onChange:i=>h({...r,minValue:(r==null?void 0:r.minValue)||1,maxValue:(r==null?void 0:r.maxValue)||5,minLabel:i.target.value}),placeholder:"e.g., Poor"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"max-label",children:"Max Label"}),e.jsx(m,{id:"max-label",value:(r==null?void 0:r.maxLabel)||"",onChange:i=>h({...r,minValue:(r==null?void 0:r.minValue)||1,maxValue:(r==null?void 0:r.maxValue)||5,maxLabel:i.target.value}),placeholder:"e.g., Excellent"})]})]})]})})}),e.jsxs("div",{className:"text-sm text-gray-600 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("strong",{children:["Selected Type: ",t]}),e.jsxs("div",{className:"mt-1",children:[s&&e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:"Supports Options"}),a&&e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs mr-2",children:"Supports Scale"}),t==="text"&&e.jsx("span",{className:"inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:"Text Input"}),t==="emoji"&&e.jsx("span",{className:"inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs",children:"Emoji Selection"})]})]})]})},re=t=>({"single-choice":{supportsOptions:!0,supportsScale:!1},"multi-choice":{supportsOptions:!0,supportsScale:!1},star:{supportsOptions:!1,supportsScale:!0},likert:{supportsOptions:!1,supportsScale:!0},nps:{supportsOptions:!1,supportsScale:!0},slider:{supportsOptions:!1,supportsScale:!0},emoji:{supportsOptions:!0,supportsScale:!1},ranking:{supportsOptions:!0,supportsScale:!1},matrix:{supportsOptions:!0,supportsScale:!0},text:{supportsOptions:!1,supportsScale:!1}})[t]||{supportsOptions:!1,supportsScale:!1},ae=({formData:t,setFormData:s,questionTypes:a,categories:c,editingId:r,onSubmit:x,onCancel:l,isSubmitting:j})=>{const h=re(t.question_type);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(m,{placeholder:"Question text",value:t.question_text,onChange:o=>s(d=>({...d,question_text:o.target.value}))}),e.jsxs(I,{value:t.question_type,onValueChange:o=>s(d=>({...d,question_type:o,options:[],scaleConfig:{minValue:1,maxValue:5}})),children:[e.jsx(F,{children:e.jsx(H,{})}),e.jsx(R,{children:a.map(o=>e.jsx(K,{value:o.name,children:o.display_name},o.id))})]}),e.jsxs(I,{value:t.category,onValueChange:o=>s(d=>({...d,category:o})),children:[e.jsx(F,{children:e.jsx(H,{})}),e.jsx(R,{children:c.map(o=>e.jsx(K,{value:o.name,children:o.name},o.id))})]})]}),e.jsx(se,{questionType:t.question_type,supportsOptions:h.supportsOptions,supportsScale:h.supportsScale,options:t.options,scaleConfig:t.scaleConfig,helpText:t.help_text,placeholderText:t.placeholder_text,onOptionsChange:o=>s(d=>({...d,options:o})),onScaleChange:o=>s(d=>({...d,scaleConfig:o})),onHelpTextChange:o=>s(d=>({...d,help_text:o})),onPlaceholderChange:o=>s(d=>({...d,placeholder_text:o}))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:x,disabled:!t.question_text.trim()||j,children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),r?"Update":"Add"," Question"]}),r&&e.jsx(b,{variant:"outline",onClick:l,children:"Cancel"})]})]})},ne=({questions:t,onEdit:s,onDelete:a,isDeleting:c})=>{const{toast:r}=J(),x=async l=>{l.response_count>0&&r({title:"Question will be archived",description:"This question has responses and will be archived instead of deleted.",variant:"default"}),a(l.id)};return t.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No questions found. Create your first question above."}):e.jsx("div",{className:"space-y-2",children:t.map(l=>e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg ${l.is_active?"":"bg-gray-50 opacity-75"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:l.question_text}),!l.is_active&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800",children:[e.jsx(ee,{className:"w-3 h-3"}),"Archived"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Type: ",l.question_type," | Category: ",l.category," | Order: ",l.order_index,l.help_text&&e.jsxs("span",{children:[" | Help: ",l.help_text]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:"outline",onClick:()=>s(l),disabled:!l.is_active,children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>x(l),disabled:c||!l.is_active,children:e.jsx(Z,{className:"w-4 h-4"})})]})]},l.id))})},ie=()=>{const{toast:t}=J(),s=X(),[a,c]=M.useState(null),[r,x]=M.useState({question_text:"",question_type:"star",category:"QualityService",order_index:1,help_text:"",placeholder_text:"",is_required:!1,options:[],scaleConfig:{minValue:1,maxValue:5}}),{data:l=[],isLoading:j}=V({queryKey:["questions"],queryFn:()=>_.getQuestions()}),{data:h=[]}=V({queryKey:["question-types"],queryFn:()=>_.getQuestionTypes()}),{data:o=[]}=V({queryKey:["question-categories"],queryFn:()=>_.getQuestionCategories()}),d=E({mutationFn:_.createQuestion,onSuccess:()=>{s.invalidateQueries({queryKey:["questions"]}),t({title:"Question created successfully"}),w()},onError:n=>{t({title:"Error",description:n.message,variant:"destructive"})}}),y=E({mutationFn:({id:n,...i})=>_.updateQuestion(n,i),onSuccess:()=>{s.invalidateQueries({queryKey:["questions"]}),t({title:"Question updated successfully"}),w()},onError:n=>{t({title:"Error",description:n.message,variant:"destructive"})}}),v=E({mutationFn:n=>_.deleteQuestion(n),onSuccess:()=>{s.invalidateQueries({queryKey:["questions"]}),t({title:"Question deleted successfully"})},onError:n=>{t({title:"Error",description:n.message,variant:"destructive"})}}),w=()=>{c(null),x({question_text:"",question_type:"star",category:"QualityService",order_index:1,help_text:"",placeholder_text:"",is_required:!1,options:[],scaleConfig:{minValue:1,maxValue:5}})},O=()=>{if(!r.question_text.trim()){t({title:"Validation Error",description:"Question text is required",variant:"destructive"});return}const n=l.length>0?Math.max(...l.map(p=>p.order_index)):0,i=a?r.order_index:n+1,u={...r,order_index:i};a?y.mutate({id:a,...u}):d.mutate(u)},Q=n=>{var i,u;c(n.id),x({question_text:n.question_text,question_type:n.question_type,category:n.category,order_index:n.order_index,help_text:n.help_text||"",placeholder_text:n.placeholder_text||"",is_required:n.is_required||!1,options:((i=n.question_options)==null?void 0:i.map(p=>({text:p.option_text,value:p.option_value})))||[],scaleConfig:(u=n.question_scale_config)!=null&&u[0]?{minValue:n.question_scale_config[0].min_value,maxValue:n.question_scale_config[0].max_value,minLabel:n.question_scale_config[0].min_label||"",maxLabel:n.question_scale_config[0].max_label||"",stepSize:n.question_scale_config[0].step_size}:{minValue:1,maxValue:5}})};return j?e.jsxs(q,{children:[e.jsx(L,{children:e.jsx(z,{children:"Questions Management"})}),e.jsx(f,{children:e.jsx("div",{className:"text-center py-8",children:"Loading questions..."})})]}):e.jsxs(q,{children:[e.jsx(L,{children:e.jsx(z,{children:"Questions Management"})}),e.jsxs(f,{className:"space-y-6",children:[e.jsx(ae,{formData:r,setFormData:x,questionTypes:h,categories:o,editingId:a,onSubmit:O,onCancel:w,isSubmitting:d.isPending||y.isPending}),e.jsx(ne,{questions:l,onEdit:Q,onDelete:n=>v.mutate(n),isDeleting:v.isPending})]})]})},he=()=>{const{isAdmin:t,isOrgAdmin:s}=W(),{organization:a}=D();return t||s?e.jsx(C,{permission:"view_analytics",organizationId:a==null?void 0:a.id,showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need admin-level access or higher to manage questions."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsx(ie,{})}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage questions."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]})};export{he as QuestionsTab,he as default};
