import{c as M,a9 as W,aa as me,ab as V,ac as be,ad as Ve,ae as Ye,af as ze,s as k,Q as re,r as b,u as se,j as e,C as D,k as F,p as q,a7 as Ie,l as O,I,B as p,ag as Je,a6 as Ze,i as ie,ah as Ke,ai as We,M as K,a4 as A,aj as et,E as tt,n as Le,a8 as he,U as ae,N as xe,m as ve,G as st,T as at,v as nt,w as rt,x as Ne,y as Se}from"./index-BAbdfhgo.js";import{u as T,t as j}from"./use-toast-BMPTLceK.js";import{u as ce}from"./useOrganization-CbbOlw8Y.js";import{T as it,a as ct,b as le,c as J,d as lt,e as B,A as ot,f as dt,g as ut,h as mt,i as ht,j as xt,k as ft,l as gt,m as pt,D as fe,o as ge,p as pe,q as je,r as jt,s as yt,t as wt}from"./dialog-YG_Eza9q.js";import{a as bt,S as vt}from"./switch-C0EBkMNo.js";import{T as ye}from"./textarea-BAl2yIjY.js";import{T as Re}from"./trash-2-BzczobCF.js";import{C as Nt}from"./calendar-BOPw7hCM.js";import{C as St}from"./clock-Cr05j1zJ.js";import{S as Ce,a as ke,b as Me,c as _e,d as H}from"./select-DOY49T4Y.js";import"./index-C4DJTPaC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=M("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=M("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=M("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=M("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=M("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=M("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=M("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=M("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=M("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=M("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=M("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=M("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=M("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=M("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=M("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=M("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]);function ne(t,s){var o,u,f,m;const a=me(),n=(s==null?void 0:s.weekStartsOn)??((u=(o=s==null?void 0:s.locale)==null?void 0:o.options)==null?void 0:u.weekStartsOn)??a.weekStartsOn??((m=(f=a.locale)==null?void 0:f.options)==null?void 0:m.weekStartsOn)??0,r=W(t),i=r.getDay(),c=(i<n?7:0)+i-n;return r.setDate(r.getDate()-c),r.setHours(0,0,0,0),r}function de(t){return ne(t,{weekStartsOn:1})}function Qe(t){const s=W(t),a=s.getFullYear(),n=V(t,0);n.setFullYear(a+1,0,4),n.setHours(0,0,0,0);const r=de(n),i=V(t,0);i.setFullYear(a,0,4),i.setHours(0,0,0,0);const c=de(i);return s.getTime()>=r.getTime()?a+1:s.getTime()>=c.getTime()?a:a-1}function Oe(t){const s=W(t);return s.setHours(0,0,0,0),s}function Yt(t,s){const a=Oe(t),n=Oe(s),r=+a-be(a),i=+n-be(n);return Math.round((r-i)/Ve)}function It(t){const s=Qe(t),a=V(t,0);return a.setFullYear(s,0,4),a.setHours(0,0,0,0),de(a)}function Kt(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Wt(t){if(!Kt(t)&&typeof t!="number")return!1;const s=W(t);return!isNaN(Number(s))}function Lt(t){const s=W(t),a=V(t,0);return a.setFullYear(s.getFullYear(),0,1),a.setHours(0,0,0,0),a}function Rt(t){const s=W(t);return Yt(s,Lt(s))+1}function Qt(t){const s=W(t),a=+de(s)-+It(s);return Math.round(a/Ye)+1}function He(t,s){var m,d,l,N;const a=W(t),n=a.getFullYear(),r=me(),i=(s==null?void 0:s.firstWeekContainsDate)??((d=(m=s==null?void 0:s.locale)==null?void 0:m.options)==null?void 0:d.firstWeekContainsDate)??r.firstWeekContainsDate??((N=(l=r.locale)==null?void 0:l.options)==null?void 0:N.firstWeekContainsDate)??1,c=V(t,0);c.setFullYear(n+1,0,i),c.setHours(0,0,0,0);const o=ne(c,s),u=V(t,0);u.setFullYear(n,0,i),u.setHours(0,0,0,0);const f=ne(u,s);return a.getTime()>=o.getTime()?n+1:a.getTime()>=f.getTime()?n:n-1}function Ht(t,s){var o,u,f,m;const a=me(),n=(s==null?void 0:s.firstWeekContainsDate)??((u=(o=s==null?void 0:s.locale)==null?void 0:o.options)==null?void 0:u.firstWeekContainsDate)??a.firstWeekContainsDate??((m=(f=a.locale)==null?void 0:f.options)==null?void 0:m.firstWeekContainsDate)??1,r=He(t,s),i=V(t,0);return i.setFullYear(r,0,n),i.setHours(0,0,0,0),ne(i,s)}function Bt(t,s){const a=W(t),n=+ne(a,s)-+Ht(a,s);return Math.round(n/Ye)+1}function y(t,s){const a=t<0?"-":"",n=Math.abs(t).toString().padStart(s,"0");return a+n}const U={y(t,s){const a=t.getFullYear(),n=a>0?a:1-a;return y(s==="yy"?n%100:n,s.length)},M(t,s){const a=t.getMonth();return s==="M"?String(a+1):y(a+1,2)},d(t,s){return y(t.getDate(),s.length)},a(t,s){const a=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(t,s){return y(t.getHours()%12||12,s.length)},H(t,s){return y(t.getHours(),s.length)},m(t,s){return y(t.getMinutes(),s.length)},s(t,s){return y(t.getSeconds(),s.length)},S(t,s){const a=s.length,n=t.getMilliseconds(),r=Math.trunc(n*Math.pow(10,a-3));return y(r,s.length)}},Z={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Te={G:function(t,s,a){const n=t.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return a.era(n,{width:"abbreviated"});case"GGGGG":return a.era(n,{width:"narrow"});case"GGGG":default:return a.era(n,{width:"wide"})}},y:function(t,s,a){if(s==="yo"){const n=t.getFullYear(),r=n>0?n:1-n;return a.ordinalNumber(r,{unit:"year"})}return U.y(t,s)},Y:function(t,s,a,n){const r=He(t,n),i=r>0?r:1-r;if(s==="YY"){const c=i%100;return y(c,2)}return s==="Yo"?a.ordinalNumber(i,{unit:"year"}):y(i,s.length)},R:function(t,s){const a=Qe(t);return y(a,s.length)},u:function(t,s){const a=t.getFullYear();return y(a,s.length)},Q:function(t,s,a){const n=Math.ceil((t.getMonth()+1)/3);switch(s){case"Q":return String(n);case"QQ":return y(n,2);case"Qo":return a.ordinalNumber(n,{unit:"quarter"});case"QQQ":return a.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,s,a){const n=Math.ceil((t.getMonth()+1)/3);switch(s){case"q":return String(n);case"qq":return y(n,2);case"qo":return a.ordinalNumber(n,{unit:"quarter"});case"qqq":return a.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,s,a){const n=t.getMonth();switch(s){case"M":case"MM":return U.M(t,s);case"Mo":return a.ordinalNumber(n+1,{unit:"month"});case"MMM":return a.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(n,{width:"wide",context:"formatting"})}},L:function(t,s,a){const n=t.getMonth();switch(s){case"L":return String(n+1);case"LL":return y(n+1,2);case"Lo":return a.ordinalNumber(n+1,{unit:"month"});case"LLL":return a.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(n,{width:"wide",context:"standalone"})}},w:function(t,s,a,n){const r=Bt(t,n);return s==="wo"?a.ordinalNumber(r,{unit:"week"}):y(r,s.length)},I:function(t,s,a){const n=Qt(t);return s==="Io"?a.ordinalNumber(n,{unit:"week"}):y(n,s.length)},d:function(t,s,a){return s==="do"?a.ordinalNumber(t.getDate(),{unit:"date"}):U.d(t,s)},D:function(t,s,a){const n=Rt(t);return s==="Do"?a.ordinalNumber(n,{unit:"dayOfYear"}):y(n,s.length)},E:function(t,s,a){const n=t.getDay();switch(s){case"E":case"EE":case"EEE":return a.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(n,{width:"short",context:"formatting"});case"EEEE":default:return a.day(n,{width:"wide",context:"formatting"})}},e:function(t,s,a,n){const r=t.getDay(),i=(r-n.weekStartsOn+8)%7||7;switch(s){case"e":return String(i);case"ee":return y(i,2);case"eo":return a.ordinalNumber(i,{unit:"day"});case"eee":return a.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(r,{width:"short",context:"formatting"});case"eeee":default:return a.day(r,{width:"wide",context:"formatting"})}},c:function(t,s,a,n){const r=t.getDay(),i=(r-n.weekStartsOn+8)%7||7;switch(s){case"c":return String(i);case"cc":return y(i,s.length);case"co":return a.ordinalNumber(i,{unit:"day"});case"ccc":return a.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(r,{width:"narrow",context:"standalone"});case"cccccc":return a.day(r,{width:"short",context:"standalone"});case"cccc":default:return a.day(r,{width:"wide",context:"standalone"})}},i:function(t,s,a){const n=t.getDay(),r=n===0?7:n;switch(s){case"i":return String(r);case"ii":return y(r,s.length);case"io":return a.ordinalNumber(r,{unit:"day"});case"iii":return a.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(n,{width:"short",context:"formatting"});case"iiii":default:return a.day(n,{width:"wide",context:"formatting"})}},a:function(t,s,a){const r=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(t,s,a){const n=t.getHours();let r;switch(n===12?r=Z.noon:n===0?r=Z.midnight:r=n/12>=1?"pm":"am",s){case"b":case"bb":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(t,s,a){const n=t.getHours();let r;switch(n>=17?r=Z.evening:n>=12?r=Z.afternoon:n>=4?r=Z.morning:r=Z.night,s){case"B":case"BB":case"BBB":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(t,s,a){if(s==="ho"){let n=t.getHours()%12;return n===0&&(n=12),a.ordinalNumber(n,{unit:"hour"})}return U.h(t,s)},H:function(t,s,a){return s==="Ho"?a.ordinalNumber(t.getHours(),{unit:"hour"}):U.H(t,s)},K:function(t,s,a){const n=t.getHours()%12;return s==="Ko"?a.ordinalNumber(n,{unit:"hour"}):y(n,s.length)},k:function(t,s,a){let n=t.getHours();return n===0&&(n=24),s==="ko"?a.ordinalNumber(n,{unit:"hour"}):y(n,s.length)},m:function(t,s,a){return s==="mo"?a.ordinalNumber(t.getMinutes(),{unit:"minute"}):U.m(t,s)},s:function(t,s,a){return s==="so"?a.ordinalNumber(t.getSeconds(),{unit:"second"}):U.s(t,s)},S:function(t,s){return U.S(t,s)},X:function(t,s,a){const n=t.getTimezoneOffset();if(n===0)return"Z";switch(s){case"X":return qe(n);case"XXXX":case"XX":return X(n);case"XXXXX":case"XXX":default:return X(n,":")}},x:function(t,s,a){const n=t.getTimezoneOffset();switch(s){case"x":return qe(n);case"xxxx":case"xx":return X(n);case"xxxxx":case"xxx":default:return X(n,":")}},O:function(t,s,a){const n=t.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+Fe(n,":");case"OOOO":default:return"GMT"+X(n,":")}},z:function(t,s,a){const n=t.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+Fe(n,":");case"zzzz":default:return"GMT"+X(n,":")}},t:function(t,s,a){const n=Math.trunc(t.getTime()/1e3);return y(n,s.length)},T:function(t,s,a){const n=t.getTime();return y(n,s.length)}};function Fe(t,s=""){const a=t>0?"-":"+",n=Math.abs(t),r=Math.trunc(n/60),i=n%60;return i===0?a+String(r):a+String(r)+s+y(i,2)}function qe(t,s){return t%60===0?(t>0?"-":"+")+y(Math.abs(t)/60,2):X(t,s)}function X(t,s=""){const a=t>0?"-":"+",n=Math.abs(t),r=y(Math.trunc(n/60),2),i=y(n%60,2);return a+r+s+i}const Ae=(t,s)=>{switch(t){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},Be=(t,s)=>{switch(t){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},Ut=(t,s)=>{const a=t.match(/(P+)(p+)?/)||[],n=a[1],r=a[2];if(!r)return Ae(t,s);let i;switch(n){case"P":i=s.dateTime({width:"short"});break;case"PP":i=s.dateTime({width:"medium"});break;case"PPP":i=s.dateTime({width:"long"});break;case"PPPP":default:i=s.dateTime({width:"full"});break}return i.replace("{{date}}",Ae(n,s)).replace("{{time}}",Be(r,s))},Gt={p:Be,P:Ut},$t=/^D+$/,Xt=/^Y+$/,Vt=["D","DD","YY","YYYY"];function zt(t){return $t.test(t)}function Jt(t){return Xt.test(t)}function Zt(t,s,a){const n=es(t,s,a);if(console.warn(n),Vt.includes(t))throw new RangeError(n)}function es(t,s,a){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${s}\`) for formatting ${n} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const ts=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ss=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,as=/^'([^]*?)'?$/,ns=/''/g,rs=/[a-zA-Z]/;function is(t,s,a){var m,d,l,N;const n=me(),r=n.locale??ze,i=n.firstWeekContainsDate??((d=(m=n.locale)==null?void 0:m.options)==null?void 0:d.firstWeekContainsDate)??1,c=n.weekStartsOn??((N=(l=n.locale)==null?void 0:l.options)==null?void 0:N.weekStartsOn)??0,o=W(t);if(!Wt(o))throw new RangeError("Invalid time value");let u=s.match(ss).map(h=>{const x=h[0];if(x==="p"||x==="P"){const S=Gt[x];return S(h,r.formatLong)}return h}).join("").match(ts).map(h=>{if(h==="''")return{isToken:!1,value:"'"};const x=h[0];if(x==="'")return{isToken:!1,value:cs(h)};if(Te[x])return{isToken:!0,value:h};if(x.match(rs))throw new RangeError("Format string contains an unescaped latin alphabet character `"+x+"`");return{isToken:!1,value:h}});r.localize.preprocessor&&(u=r.localize.preprocessor(o,u));const f={firstWeekContainsDate:i,weekStartsOn:c,locale:r};return u.map(h=>{if(!h.isToken)return h.value;const x=h.value;(Jt(x)||zt(x))&&Zt(x,s,String(t));const S=Te[x[0]];return S(o,x,r.localize,f)}).join("")}function cs(t){const s=t.match(as);return s?s[1].replace(ns,"'"):t}const ls=async t=>{const{data:s,error:a}=await k.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",t).order("created_at",{ascending:!1});if(a)throw a;return s},os=async(t,s)=>{const{data:a,error:n}=await k.rpc("create_api_key",{p_organization_id:t,p_key_name:s});if(n)throw n;return a},ds=async(t,s)=>{const{data:a,error:n}=await k.from("api_keys").update({status:s}).eq("id",t).select().single();if(n)throw n;return a},us=({apiKey:t})=>{const[s,a]=b.useState(!1),n=()=>{navigator.clipboard.writeText(t),a(!0),j({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>a(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:t}),e.jsx(p,{variant:"ghost",size:"icon",onClick:n,children:s?e.jsx(We,{className:"h-4 w-4 text-green-500"}):e.jsx(oe,{className:"h-4 w-4"})})]})},ms=()=>{const{organization:t}=ce(),s=re(),[a,n]=b.useState(""),[r,i]=b.useState(null),c=["apiKeys",t==null?void 0:t.id],{data:o,isLoading:u}=se({queryKey:c,queryFn:()=>ls(t.id),enabled:!!t}),f=T({mutationFn:l=>os(t.id,l),onSuccess:l=>{j({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),i(l),n(""),s.invalidateQueries({queryKey:c})},onError:l=>{j({title:"Error",description:l.message,variant:"destructive"})}}),m=T({mutationFn:({keyId:l,status:N})=>ds(l,N),onSuccess:()=>{j({title:"Status Updated"}),s.invalidateQueries({queryKey:c})},onError:l=>{j({title:"Error",description:l.message,variant:"destructive"})}}),d=l=>{l.preventDefault(),a.trim()&&t&&f.mutate(a.trim())};return e.jsxs(D,{className:"w-full",children:[e.jsxs(F,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Et,{})," API Keys"]}),e.jsx(Ie,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(O,{children:[e.jsxs("form",{onSubmit:d,className:"flex items-center gap-2 mb-6",children:[e.jsx(I,{placeholder:"New key name (e.g., 'SMS Integration')",value:a,onChange:l=>n(l.target.value),disabled:f.isPending}),e.jsxs(p,{type:"submit",disabled:!a.trim()||f.isPending,children:[f.isPending?e.jsx(Je,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Mt,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(it,{children:[e.jsx(ct,{children:e.jsxs(le,{children:[e.jsx(J,{children:"Name"}),e.jsx(J,{children:"Key Prefix"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Last Used"}),e.jsx(J,{children:"Created"}),e.jsx(J,{className:"text-right",children:"Actions"})]})}),e.jsx(lt,{children:u?Array.from({length:3}).map((l,N)=>e.jsx(le,{children:e.jsx(B,{colSpan:6,children:e.jsx(Ze,{className:"h-8 w-full"})})},N)):o&&o.length>0?o.map(l=>e.jsxs(le,{children:[e.jsx(B,{className:"font-medium",children:l.key_name}),e.jsx(B,{children:e.jsxs("code",{children:[l.key_prefix,"..."]})}),e.jsx(B,{children:e.jsx(ie,{variant:l.status==="active"?"default":"secondary",children:l.status})}),e.jsx(B,{children:l.last_used_at?`${Ke(new Date(l.last_used_at))} ago`:"Never"}),e.jsx(B,{children:is(new Date(l.created_at),"MMM d, yyyy")}),e.jsx(B,{className:"text-right",children:e.jsxs(ot,{children:[e.jsx(dt,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",disabled:m.isPending,children:l.status==="active"?e.jsx(Tt,{className:"h-4 w-4"}):e.jsx(Ft,{className:"h-4 w-4"})})}),e.jsxs(ut,{children:[e.jsxs(mt,{children:[e.jsx(ht,{children:"Are you sure?"}),e.jsxs(xt,{children:["This will ",l.status==="active"?"deactivate":"activate"," the API key.",l.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(ft,{children:[e.jsx(gt,{children:"Cancel"}),e.jsx(pt,{onClick:()=>m.mutate({keyId:l.id,status:l.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},l.id)):e.jsx(le,{children:e.jsx(B,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(fe,{open:!!r,onOpenChange:l=>!l&&i(null),children:e.jsxs(ge,{children:[e.jsxs(pe,{children:[e.jsx(je,{children:"API Key Created Successfully"}),e.jsx(jt,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(us,{apiKey:r||""}),e.jsx(yt,{children:e.jsx(wt,{asChild:!0,children:e.jsx(p,{children:"Close"})})})]})})]})]})},hs=({organization:t,currentSettings:s,onSettingsUpdate:a})=>{var u,f;const n=re(),[r,i]=b.useState({username:((u=s==null?void 0:s.sms_settings)==null?void 0:u.username)||"",apiKey:((f=s==null?void 0:s.sms_settings)==null?void 0:f.apiKey)||"",senderId:(s==null?void 0:s.sms_sender_id)||""}),c=T({mutationFn:async m=>{const{data:d,error:l}=await k.functions.invoke("update-sms-settings",{body:{orgId:t.id,enabled:!0,senderId:m.senderId,username:m.username,apiKey:m.apiKey}});if(l)throw l;return d},onSuccess:()=>{j({title:"Success",description:"SMS settings updated successfully"}),n.invalidateQueries({queryKey:["organization-sms-settings"]}),a()},onError:m=>{j({title:"Error",description:m.message||"Failed to update SMS settings",variant:"destructive"})}}),o=m=>{if(m.preventDefault(),!r.username.trim()||!r.apiKey.trim()||!r.senderId.trim()){j({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"});return}c.mutate(r)};return e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Provider Settings"]})}),e.jsx(O,{children:e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"username",children:"Username *"}),e.jsx(I,{id:"username",type:"text",value:r.username,onChange:m=>i(d=>({...d,username:m.target.value})),placeholder:"Enter your SMS provider username",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"apiKey",children:"API Key *"}),e.jsx(I,{id:"apiKey",type:"password",value:r.apiKey,onChange:m=>i(d=>({...d,apiKey:m.target.value})),placeholder:"Enter your SMS provider API key",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"senderId",children:"Sender ID *"}),e.jsx(I,{id:"senderId",type:"text",value:r.senderId,onChange:m=>i(d=>({...d,senderId:m.target.value})),placeholder:"Enter your sender ID (e.g., 12345)",required:!0}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This is your SMS sender identifier that recipients will see"})]}),e.jsxs(p,{type:"submit",disabled:c.isPending,className:"w-full",children:[e.jsx(bt,{className:"w-4 h-4 mr-2"}),c.isPending?"Saving...":"Save Settings"]})]})})]})},xs=({enabled:t,onToggle:s,isLoading:a})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"SMS Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to provide feedback via SMS"})]}),e.jsx(vt,{checked:t,onCheckedChange:s,disabled:a})]}),fs=({webhookSecret:t,isVisible:s,isFlaskWrapper:a=!1})=>{const[n,r]=b.useState(!1),o=`${window.location.origin}${a?"/functions/v1/handle-flask-sms-callback":"/functions/v1/handle-sms-webhook"}`,u=f=>{navigator.clipboard.writeText(f),j({title:"Copied to clipboard",description:"Webhook URL has been copied to your clipboard"})};return s?e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(At,{className:"w-5 h-5"}),a?"Flask Webhook Configuration":"SMS Webhook Configuration"]})}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{value:o,readOnly:!0,className:"font-mono text-sm"}),e.jsx(p,{onClick:()=>u(o),variant:"outline",size:"icon",children:e.jsx(oe,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?"Configure your Flask wrapper to send callbacks to this URL":"Configure this URL in your Africa's Talking SMS callback settings"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Webhook Secret"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:n?"text":"password",value:t,readOnly:!0,className:"font-mono text-sm"}),e.jsx(p,{onClick:()=>r(!n),variant:"outline",size:"icon",type:"button",children:n?e.jsx(et,{className:"w-4 h-4"}):e.jsx(tt,{className:"w-4 h-4"})}),e.jsx(p,{onClick:()=>u(t),variant:"outline",size:"icon",children:e.jsx(oe,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use this secret to verify webhook authenticity"})]}),a&&e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_t,{className:"w-5 h-5 text-blue-500 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-sm",children:"Flask Integration Notes:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Your Flask wrapper should forward SMS callbacks to the webhook URL above"}),e.jsx("li",{children:"• Include the webhook secret in your callback validation"}),e.jsxs("li",{children:["• Ensure the callback format matches: ","{linkId, text, to, id, date, from}"]}),e.jsx("li",{children:"• The 'to' field should contain your organization's sender ID"})]})]})]})})]})]}):null},gs=({selectedProvider:t,onProviderSelect:s})=>{const a={id:"sms-provider",name:"SMS Provider (Flask Wrapper)",description:"SMS services via Flask wrapper integration",icon:K,status:"available"};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"SMS Integration"}),e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${t===a.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>s(t===a.id?null:a.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a.icon,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{variant:"default",children:"Available"}),t===a.id&&e.jsx(We,{className:"w-4 h-4 text-blue-500"})]})]})})]})},ue=(t,s)=>{if(!t||typeof t!="object")return"";const a=t[s];return typeof a=="string"?a:""},ps=t=>{if(!t||typeof t!="object")return!1;const s=ue(t,"username"),a=ue(t,"apiKey");return s.length>0&&a.length>0},js=()=>e.jsxs(F,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Integrations"]}),e.jsx(Ie,{children:"Enable SMS feedback collection from your customers"})]}),ys=({title:t="SMS Integrations"})=>e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),t]})}),e.jsx(O,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}),ws=({title:t="SMS Integrations",message:s,onRetry:a})=>e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5 text-red-500"}),t]})}),e.jsx(O,{children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-sm text-red-600 mb-2",children:"Organization not found or failed to load"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:s}),a&&e.jsx("button",{onClick:a,className:"text-sm text-blue-600 hover:underline",children:"Try again"})]})})]}),bs=()=>e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(O,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"You need admin access to manage SMS integrations."})})]}),vs=({phoneNumber:t,name:s,onPhoneNumberChange:a,onNameChange:n,onSubmit:r,isLoading:i})=>e.jsx("form",{onSubmit:r,className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"phone-number",children:"Phone Number *"}),e.jsx(I,{id:"phone-number",value:t,onChange:c=>a(c.target.value),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"name",children:"Name (Optional)"}),e.jsx(I,{id:"name",value:s,onChange:c=>n(c.target.value),placeholder:"John Doe"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(p,{type:"submit",disabled:i,className:"w-full",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Add Number"]})})]})}),Ns=({bulkNumbers:t,onBulkNumbersChange:s,onBulkAdd:a,onCancel:n,isLoading:r})=>e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"bulk-numbers",children:"Bulk Add Phone Numbers"}),e.jsx(ye,{id:"bulk-numbers",value:t,onChange:i=>s(i.target.value),placeholder:"Enter phone numbers, one per line. Format: +1234567890 or +1234567890,John Doe",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Format: One phone number per line. Optionally add name after comma."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{onClick:a,disabled:r,children:"Add All Numbers"}),e.jsx(p,{variant:"outline",onClick:n,children:"Cancel"})]})]}),Ss=({phoneNumbers:t,onDelete:s,isDeleting:a})=>{const n=r=>r.startsWith("+")?r:`+${r}`;return t.length===0?e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No phone numbers added yet."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers to start sending SMS campaigns."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Registered Phone Numbers"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:n(r.phone_number)}),r.name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ie,{variant:r.status==="active"?"default":"secondary",children:r.status}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Added ",new Date(r.created_at).toLocaleDateString()]})]})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>s(r.id),disabled:a,children:e.jsx(Re,{className:"w-4 h-4"})})]},r.id))})]})},Cs=()=>{const{organization:t}=ce(),s=re(),[a,n]=b.useState(""),[r,i]=b.useState(""),[c,o]=b.useState(""),[u,f]=b.useState(!1),{data:m,isLoading:d}=se({queryKey:["sms-phone-numbers",t==null?void 0:t.id],queryFn:async()=>{const{data:g,error:w}=await k.from("sms_phone_numbers").select("*").eq("organization_id",t.id).order("created_at",{ascending:!1});if(w)throw w;return g},enabled:!!(t!=null&&t.id)}),l=T({mutationFn:async({phoneNumber:g,name:w})=>{const{data:C,error:P}=await k.from("sms_phone_numbers").insert({organization_id:t.id,phone_number:g.trim(),name:(w==null?void 0:w.trim())||null}).select().single();if(P)throw P;return C},onSuccess:()=>{j({title:"Phone number added successfully"}),n(""),i(""),s.invalidateQueries({queryKey:["sms-phone-numbers",t==null?void 0:t.id]})},onError:g=>{j({title:"Error adding phone number",description:g.message,variant:"destructive"})}}),N=T({mutationFn:async g=>{const{data:w,error:C}=await k.from("sms_phone_numbers").insert(g.map(({phoneNumber:P,name:_})=>({organization_id:t.id,phone_number:P.trim(),name:(_==null?void 0:_.trim())||null})));if(C)throw C;return w},onSuccess:()=>{j({title:"Phone numbers added successfully"}),o(""),f(!1),s.invalidateQueries({queryKey:["sms-phone-numbers",t==null?void 0:t.id]})},onError:g=>{j({title:"Error adding phone numbers",description:g.message,variant:"destructive"})}}),h=T({mutationFn:async g=>{const{error:w}=await k.from("sms_phone_numbers").delete().eq("id",g);if(w)throw w},onSuccess:()=>{j({title:"Phone number removed successfully"}),s.invalidateQueries({queryKey:["sms-phone-numbers",t==null?void 0:t.id]})},onError:g=>{j({title:"Error removing phone number",description:g.message,variant:"destructive"})}}),x=g=>{g.preventDefault(),a.trim()&&l.mutate({phoneNumber:a,name:r})},S=()=>{const w=c.split(`
`).filter(C=>C.trim()).map(C=>{const P=C.split(",").map(_=>_.trim());return{phoneNumber:P[0],name:P[1]||void 0}}).filter(C=>C.phoneNumber);if(w.length===0){j({title:"No valid phone numbers found",description:"Please enter at least one phone number",variant:"destructive"});return}N.mutate(w)};return d?e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Phone Numbers"]})}),e.jsx(O,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}):e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Phone Numbers (",(m==null?void 0:m.length)||0,")"]})}),e.jsxs(O,{className:"space-y-6",children:[e.jsx(vs,{phoneNumber:a,name:r,onPhoneNumberChange:n,onNameChange:i,onSubmit:x,isLoading:l.isPending}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(p,{variant:"outline",onClick:()=>f(!u),children:[e.jsx(qt,{className:"w-4 h-4 mr-2"}),"Bulk Add"]})}),u&&e.jsx(Ns,{bulkNumbers:c,onBulkNumbersChange:o,onBulkAdd:S,onCancel:()=>f(!1),isLoading:N.isPending}),e.jsx(Ss,{phoneNumbers:m||[],onDelete:g=>h.mutate(g),isDeleting:h.isPending})]})]})},ks=()=>{const{user:t}=xe(),{organization:s}=ce(),a=re(),{data:n=[],isLoading:r,error:i}=se({queryKey:["sms-campaigns",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return[];const{data:h,error:x}=await k.from("sms_campaigns").select("*").eq("organization_id",s.id).order("created_at",{ascending:!1});if(x)throw x;return h||[]},enabled:!!(s!=null&&s.id)}),{data:c=[],isLoading:o,error:u}=se({queryKey:["sms-phone-numbers",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return[];const{data:h,error:x}=await k.from("sms_phone_numbers").select("*").eq("organization_id",s.id).eq("status","active").order("created_at",{ascending:!1});if(x)throw x;return h||[]},enabled:!!(s!=null&&s.id)}),f=T({mutationFn:async({name:h,template:x})=>{if(!(s!=null&&s.id)||!(t!=null&&t.id))throw new Error("Missing organization or user");const{data:S,error:g}=await k.from("sms_campaigns").insert({organization_id:s.id,name:h,message_template:x,created_by_user_id:t.id,status:"draft"}).select().single();if(g)throw g;return S},onSuccess:()=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),j({title:"Success",description:"Campaign created successfully"})},onError:h=>{console.error("Error creating campaign:",h),j({title:"Error",description:"Failed to create campaign",variant:"destructive"})}}),m=T({mutationFn:async({campaignId:h,name:x,template:S})=>{const{data:g,error:w}=await k.from("sms_campaigns").update({name:x,message_template:S,updated_at:new Date().toISOString()}).eq("id",h).select().single();if(w)throw w;return g},onSuccess:()=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),j({title:"Success",description:"Campaign updated successfully"})},onError:h=>{console.error("Error updating campaign:",h),j({title:"Error",description:"Failed to update campaign",variant:"destructive"})}}),d=T({mutationFn:async h=>{const{error:x}=await k.from("sms_campaigns").delete().eq("id",h);if(x)throw x},onSuccess:()=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),j({title:"Success",description:"Campaign deleted successfully"})},onError:h=>{console.error("Error deleting campaign:",h),j({title:"Error",description:"Failed to delete campaign",variant:"destructive"})}}),l=T({mutationFn:async({campaignId:h,isResend:x=!1,isRetry:S=!1})=>{const{data:g,error:w}=await k.functions.invoke("send-sms-flask",{body:{campaignId:h,isResend:x,isRetry:S}});if(w)throw w;return g},onSuccess:h=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),a.invalidateQueries({queryKey:["sms-sends"]}),j({title:"Success",description:`Campaign sent successfully! ${h.sentCount}/${h.sentCount+h.failedCount} messages delivered.`})},onError:h=>{console.error("Error sending campaign:",h),j({title:"Error",description:"Failed to send campaign",variant:"destructive"})}}),N=T({mutationFn:async({campaignId:h,action:x})=>{let S;switch(x){case"pause":S="paused";break;case"resume":S="sending";break;case"cancel":S="cancelled";break;default:throw new Error("Invalid action")}const{error:g}=await k.from("sms_campaigns").update({status:S}).eq("id",h);if(g)throw g},onSuccess:(h,{action:x})=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),j({title:"Success",description:`Campaign ${x}d successfully`})},onError:h=>{console.error("Error controlling campaign:",h),j({title:"Error",description:"Failed to update campaign status",variant:"destructive"})}});return{campaigns:n,campaignsLoading:r,campaignsError:i,phoneNumbers:c,phoneNumbersLoading:o,phoneNumbersError:u,createCampaignMutation:f,updateCampaignMutation:m,deleteCampaignMutation:d,sendCampaignMutation:l,campaignControlMutation:N,organization:s}},Ms=({onSubmit:t,onCancel:s,isLoading:a,phoneNumbersCount:n,organizationName:r})=>{const[i,c]=b.useState(""),[o,u]=b.useState(""),f=`Hi! We'd love your feedback on our service. Please text back 'START' to begin a quick survey. Your input helps us improve. Thank you! - ${r||"Your Company"}`,m=d=>{d.preventDefault(),!(!i.trim()||!o.trim())&&(t(i,o),c(""),u(""))};return e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium",children:"Create New Campaign"}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"campaign-name",children:"Campaign Name *"}),e.jsx(I,{id:"campaign-name",value:i,onChange:d=>c(d.target.value),placeholder:"Feedback Request Campaign",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"message-template",children:"Message Template *"}),e.jsx(ye,{id:"message-template",value:o,onChange:d=>u(d.target.value),placeholder:f,rows:4,required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Recipients: ",n," active phone numbers"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"submit",disabled:a,children:"Create Campaign"}),e.jsx(p,{type:"button",variant:"outline",onClick:s,children:"Cancel"})]})]})]})},_s=({campaign:t,onSend:s,onResend:a,onRetry:n,onCancel:r,onPause:i,onResume:c,onDuplicate:o,onSchedule:u,onEdit:f,onDelete:m,isLoading:d})=>{const[l,N]=b.useState(!1),h=L=>{switch(L){case"draft":return"bg-gray-100 text-gray-800";case"sending":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"paused":return"bg-yellow-100 text-yellow-800";case"cancelled":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-800"}},x=L=>{switch(L){case"completed":return e.jsx(ve,{className:"w-4 h-4"});case"failed":return e.jsx(Pe,{className:"w-4 h-4"});case"sending":return e.jsx(St,{className:"w-4 h-4"});default:return null}},S=t.status==="draft",g=t.status==="completed",w=t.status==="failed",C=t.status==="sending",P=t.status==="paused",_=t.status==="sending"||t.status==="paused",ee=t.status==="draft"||t.status==="failed",z=t.status==="draft"||t.status==="cancelled"||t.status==="failed";return e.jsx(D,{className:"w-full hover:shadow-md transition-shadow",children:e.jsxs(O,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.name}),e.jsxs(ie,{className:`${h(t.status)} flex items-center gap-1`,children:[x(t.status),t.status.charAt(0).toUpperCase()+t.status.slice(1)]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-3",children:["Created ",Ke(new Date(t.created_at),{addSuffix:!0})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.total_recipients||0," recipients"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.sent_count||0," sent"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:[t.delivered_count||0," delivered"]})]}),t.failed_count>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{children:[t.failed_count," failed"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[ee&&e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>f(t),disabled:d,children:[e.jsx(Ot,{className:"w-4 h-4 mr-1"}),"Edit"]}),S&&e.jsxs(p,{onClick:()=>s(t.id),disabled:d,size:"sm",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"Send"]}),g&&e.jsxs(p,{variant:"outline",onClick:()=>a(t.id),disabled:d,size:"sm",children:[e.jsx(De,{className:"w-4 h-4 mr-1"}),"Resend"]}),w&&e.jsxs(p,{variant:"outline",onClick:()=>n(t.id),disabled:d,size:"sm",children:[e.jsx(De,{className:"w-4 h-4 mr-1"}),"Retry"]}),C&&e.jsxs(p,{variant:"outline",onClick:()=>i(t.id),disabled:d,size:"sm",children:[e.jsx(Dt,{className:"w-4 h-4 mr-1"}),"Pause"]}),P&&e.jsxs(p,{variant:"outline",onClick:()=>c(t.id),disabled:d,size:"sm",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"Resume"]}),_&&e.jsx(p,{variant:"outline",onClick:()=>r(t.id),disabled:d,size:"sm",children:"Cancel"}),e.jsxs(p,{variant:"outline",onClick:()=>o(t.id),disabled:d,size:"sm",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Duplicate"]}),e.jsxs(p,{variant:"outline",onClick:()=>u(t.id),disabled:d,size:"sm",children:[e.jsx(Nt,{className:"w-4 h-4 mr-1"}),"Schedule"]}),z&&e.jsxs(p,{variant:"outline",onClick:()=>m(t),disabled:d,size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(Re,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("button",{onClick:()=>N(!l),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:[l?"Hide":"Show"," message preview"]}),l&&e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:t.message_template})})]}),(t.started_at||t.completed_at)&&e.jsxs("div",{className:"mt-4 text-xs text-gray-500 space-y-1",children:[t.started_at&&e.jsxs("div",{children:["Started: ",new Date(t.started_at).toLocaleString()]}),t.completed_at&&e.jsxs("div",{children:["Completed: ",new Date(t.completed_at).toLocaleString()]})]})]})})},Ps=({searchTerm:t,onSearchChange:s,statusFilter:a,onStatusFilterChange:n,sortBy:r,onSortByChange:i,sortOrder:c,onSortOrderChange:o,totalCampaigns:u,filteredCount:f})=>{const m=()=>{s(""),n("all"),i("created_at"),o("desc")},d=t||a!=="all";return e.jsxs("div",{className:"w-full space-y-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters"}),d&&e.jsxs(ie,{variant:"secondary",className:"text-xs",children:[f," of ",u]})]}),d&&e.jsx(p,{variant:"ghost",size:"sm",onClick:m,children:"Clear All"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(st,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(I,{placeholder:"Search campaigns...",value:t,onChange:l=>s(l.target.value),className:"pl-10 w-full"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(Ce,{value:a,onValueChange:n,children:[e.jsx(ke,{className:"w-full sm:w-[150px]",children:e.jsx(Me,{placeholder:"Status"})}),e.jsxs(_e,{children:[e.jsx(H,{value:"all",children:"All Status"}),e.jsx(H,{value:"draft",children:"Draft"}),e.jsx(H,{value:"sending",children:"Sending"}),e.jsx(H,{value:"completed",children:"Completed"}),e.jsx(H,{value:"failed",children:"Failed"})]})]}),e.jsxs(Ce,{value:r,onValueChange:i,children:[e.jsx(ke,{className:"w-full sm:w-[150px]",children:e.jsx(Me,{placeholder:"Sort by"})}),e.jsxs(_e,{children:[e.jsx(H,{value:"created_at",children:"Created Date"}),e.jsx(H,{value:"name",children:"Name"}),e.jsx(H,{value:"total_recipients",children:"Recipients"}),e.jsx(H,{value:"delivered_count",children:"Delivery Rate"})]})]}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>o(c==="asc"?"desc":"asc"),className:"w-full sm:w-auto",children:c==="asc"?e.jsx(kt,{className:"w-4 h-4"}):e.jsx(Ct,{className:"w-4 h-4"})})]})]})]})},Es=({campaign:t,isOpen:s,onClose:a,onSave:n,isLoading:r})=>{const[i,c]=b.useState(""),[o,u]=b.useState("");b.useEffect(()=>{t&&(c(t.name),u(t.message_template))},[t]);const f=()=>{t&&i.trim()&&o.trim()&&n(t.id,i.trim(),o.trim())},m=()=>{c(""),u(""),a()};return t?e.jsx(fe,{open:s,onOpenChange:m,children:e.jsxs(ge,{className:"max-w-md",children:[e.jsx(pe,{children:e.jsx(je,{children:"Edit Campaign"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"campaign-name",children:"Campaign Name"}),e.jsx(I,{id:"campaign-name",value:i,onChange:d=>c(d.target.value),placeholder:"Enter campaign name",disabled:r})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"message-template",children:"Message Template"}),e.jsx(ye,{id:"message-template",value:o,onChange:d=>u(d.target.value),placeholder:"Enter your message template",rows:4,disabled:r})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:m,disabled:r,children:"Cancel"}),e.jsx(p,{onClick:f,disabled:r||!i.trim()||!o.trim(),children:r?"Saving...":"Save Changes"})]})]})]})}):null},Ds=({campaign:t,isOpen:s,onClose:a,onDelete:n,isLoading:r})=>{const i=()=>{t&&n(t.id)};if(!t)return null;const c=t.status==="draft"||t.status==="cancelled"||t.status==="failed";return e.jsx(fe,{open:s,onOpenChange:a,children:e.jsxs(ge,{className:"max-w-md",children:[e.jsx(pe,{children:e.jsxs(je,{className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-5 h-5 text-red-600"}),"Delete Campaign"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:['Are you sure you want to delete the campaign "',t.name,'"?']}),!c&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"This campaign cannot be deleted because it has been sent or is currently active. Only draft, cancelled, or failed campaigns can be deleted."})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:a,disabled:r,children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:i,disabled:r||!c,children:r?"Deleting...":"Delete Campaign"})]})]})]})})},Os=({campaigns:t,onSend:s,onResend:a,onRetry:n,onCancel:r,onPause:i,onResume:c,onDuplicate:o,onSchedule:u,onEdit:f,onDelete:m,onCreateNew:d,isLoading:l,isEditLoading:N=!1,isDeleteLoading:h=!1})=>{const[x,S]=b.useState(""),[g,w]=b.useState("all"),[C,P]=b.useState("created_at"),[_,ee]=b.useState("desc"),[z,L]=b.useState(null),[v,Y]=b.useState(null),R=b.useMemo(()=>{let E=t.filter(G=>{const te=G.name.toLowerCase().includes(x.toLowerCase())||G.message_template.toLowerCase().includes(x.toLowerCase()),Q=g==="all"||G.status===g;return te&&Q});return E.sort((G,te)=>{let Q=G[C],$=te[C];if(C==="created_at"&&(Q=new Date(Q).getTime(),$=new Date($).getTime()),typeof Q=="number"&&typeof $=="number")return _==="asc"?Q-$:$-Q;if(typeof Q=="string"&&typeof $=="string"){const we=Q.localeCompare($);return _==="asc"?we:-we}return 0}),E},[t,x,g,C,_]),Ue=E=>{L(E)},Ge=(E,G,te)=>{f(E,G,te),L(null)},$e=E=>{Y(E)},Xe=E=>{m(E),Y(null)};return t.length===0?e.jsxs("div",{className:"w-full text-center p-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No campaigns yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Create your first SMS campaign to start reaching your audience with targeted messages."}),e.jsxs(p,{onClick:d,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Create Your First Campaign"]})]}):e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Campaign Management"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.length," campaign",t.length!==1?"s":""," total",R.length!==t.length&&` • ${R.length} shown`]})]}),e.jsxs(p,{onClick:d,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"New Campaign"]})]}),e.jsx(Ps,{searchTerm:x,onSearchChange:S,statusFilter:g,onStatusFilterChange:w,sortBy:C,onSortByChange:P,sortOrder:_,onSortOrderChange:ee,totalCampaigns:t.length,filteredCount:R.length}),e.jsx("div",{className:"w-full space-y-4",children:R.length===0?e.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No campaigns match your current filters."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search or filter criteria."})]}):R.map(E=>e.jsx(_s,{campaign:E,onSend:s,onResend:a,onRetry:n,onCancel:r,onPause:i,onResume:c,onDuplicate:o,onSchedule:u,onEdit:Ue,onDelete:$e,isLoading:l},E.id))}),e.jsx(Es,{campaign:z,isOpen:!!z,onClose:()=>L(null),onSave:Ge,isLoading:N}),e.jsx(Ds,{campaign:v,isOpen:!!v,onClose:()=>Y(null),onDelete:Xe,isLoading:h})]})},Ts=()=>e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No active phone numbers found."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers before creating campaigns."})]}),Fs=()=>{const[t,s]=b.useState(!1),{campaigns:a,campaignsLoading:n,campaignsError:r,phoneNumbers:i,phoneNumbersLoading:c,phoneNumbersError:o,createCampaignMutation:u,updateCampaignMutation:f,deleteCampaignMutation:m,sendCampaignMutation:d,campaignControlMutation:l,organization:N}=ks(),h=(v,Y)=>{u.mutate({name:v,template:Y},{onSuccess:()=>{s(!1)}})},x=(v,Y,R)=>{f.mutate({campaignId:v,name:Y,template:R})},S=v=>{m.mutate(v)},g=v=>{d.mutate({campaignId:v})},w=v=>{d.mutate({campaignId:v,isResend:!0})},C=v=>{d.mutate({campaignId:v,isRetry:!0})},P=v=>{l.mutate({campaignId:v,action:"cancel"})},_=v=>{l.mutate({campaignId:v,action:"pause"})},ee=v=>{l.mutate({campaignId:v,action:"resume"})},z=v=>{const Y=a.find(R=>R.id===v);Y&&(u.mutate({name:`${Y.name} (Copy)`,template:Y.message_template}),j({title:"Campaign duplicated successfully"}))},L=v=>{j({title:"Scheduling feature coming soon",description:"Campaign scheduling will be available in the next update."})};return n||c?e.jsx("div",{className:"w-full",children:e.jsxs(D,{className:"w-full",children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(O,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]})}):r||o?e.jsx("div",{className:"w-full",children:e.jsxs(D,{className:"w-full",children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(O,{children:e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 rounded-lg",children:[e.jsx(Le,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Failed to load campaigns or phone numbers"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:(r==null?void 0:r.message)||(o==null?void 0:o.message)||"An unexpected error occurred"})]})]})})]})}):e.jsx("div",{className:"w-full",children:e.jsxs(D,{className:"w-full",children:[e.jsx(F,{children:e.jsx(q,{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Campaigns"]})})}),e.jsx(O,{className:"space-y-6 p-6",children:i.length===0?e.jsx(Ts,{}):e.jsxs("div",{className:"w-full space-y-6",children:[t&&e.jsx("div",{className:"w-full",children:e.jsx(Ms,{onSubmit:h,onCancel:()=>s(!1),isLoading:u.isPending,phoneNumbersCount:i.length,organizationName:N==null?void 0:N.name})}),e.jsx("div",{className:"w-full",children:e.jsx(Os,{campaigns:a,onSend:g,onResend:w,onRetry:C,onCancel:P,onPause:_,onResume:ee,onDuplicate:z,onSchedule:L,onEdit:x,onDelete:S,onCreateNew:()=>s(!0),isLoading:d.isPending||l.isPending,isEditLoading:f.isPending,isDeleteLoading:m.isPending})})]})})]})})},qs=()=>e.jsx("div",{className:"w-full mt-6",children:e.jsxs(nt,{defaultValue:"phone-numbers",className:"w-full",children:[e.jsxs(rt,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(Ne,{value:"phone-numbers",className:"flex-1",children:"Phone Numbers"}),e.jsx(Ne,{value:"campaigns",className:"flex-1",children:"Campaigns"})]}),e.jsx(Se,{value:"phone-numbers",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Cs,{})})}),e.jsx(Se,{value:"campaigns",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Fs,{})})})]})}),As=()=>{const{organization:t}=ce(),s=re(),{data:a,isLoading:n,error:r}=se({queryKey:["organization-sms-settings",t==null?void 0:t.id],queryFn:async()=>{console.log("Fetching SMS settings for organization:",t==null?void 0:t.id);const{data:c,error:o}=await k.from("organizations").select("sms_enabled, sms_sender_id, sms_settings, webhook_secret").eq("id",t.id).single();if(o)throw console.error("Error fetching organization SMS settings:",o),o;return console.log("Organization SMS settings fetched:",c),c},enabled:!!(t!=null&&t.id),retry:3,retryDelay:1e3}),i=T({mutationFn:async c=>{if(!(t!=null&&t.id))throw new Error("Organization not found");console.log("Updating SMS status:",{enabled:c,orgId:t.id});const{data:o,error:u}=await k.functions.invoke("update-sms-settings",{body:{orgId:t.id,enabled:c,senderId:(a==null?void 0:a.sms_sender_id)||"",username:ue(a==null?void 0:a.sms_settings,"username"),apiKey:ue(a==null?void 0:a.sms_settings,"apiKey")}});if(u)throw console.error("SMS status update error:",u),new Error(u.message||"Failed to update SMS settings");return console.log("SMS status updated successfully:",o),o},onSuccess:()=>{j({title:"SMS status updated successfully"}),s.invalidateQueries({queryKey:["organization-sms-settings",t==null?void 0:t.id]})},onError:c=>{console.error("SMS toggle error:",c),j({title:"Error updating SMS status",description:c.message||"An unexpected error occurred",variant:"destructive"})}});return{orgData:a,isLoading:n,error:r,updateSmsStatus:i,organization:t}},Ys=()=>{const{isAdmin:t,isOrgAdmin:s}=xe(),[a,n]=b.useState(null),{orgData:r,isLoading:i,error:c,updateSmsStatus:o,organization:u}=As(),f=t||s,m=l=>{if(!f){j({title:"Access denied",description:"You need admin access to manage SMS settings",variant:"destructive"});return}if(!(u!=null&&u.id)){j({title:"Error",description:"Organization not found",variant:"destructive"});return}o.mutate(l)};if(!f)return e.jsx(bs,{});if(i)return e.jsx(ys,{});if(c){const l=typeof c=="string"?c:"Failed to load SMS settings";return e.jsx(ws,{message:l})}const d=(r==null?void 0:r.sms_enabled)&&ps(r==null?void 0:r.sms_settings);return e.jsx("div",{className:"w-full",children:e.jsxs(D,{className:"w-full",children:[e.jsx(js,{}),e.jsxs(O,{className:"space-y-6 p-6",children:[e.jsx(xs,{enabled:(r==null?void 0:r.sms_enabled)||!1,onToggle:m,isLoading:o.isPending}),(r==null?void 0:r.sms_enabled)&&e.jsx(fs,{webhookSecret:(r==null?void 0:r.webhook_secret)||"",isVisible:!0,isFlaskWrapper:!0}),e.jsx(gs,{selectedProvider:a,onProviderSelect:n}),a==="sms-provider"&&e.jsx(hs,{organization:u,currentSettings:r,onSettingsUpdate:()=>{}}),d&&e.jsx("div",{className:"w-full",children:e.jsx(qs,{})})]})]})})},Xs=()=>{const{isAdmin:t,isOrgAdmin:s}=xe();return ce(),t||s?e.jsxs("div",{className:"w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."})]}),e.jsx("div",{className:"w-full",children:e.jsx(Ys,{})}),e.jsx("div",{className:"w-full",children:e.jsx(ms,{})})]}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage integrations."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]})};export{Xs as IntegrationsTab,Xs as default};
