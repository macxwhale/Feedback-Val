import{i as o,s as j,a7 as M,h as K,r as y,g as P,u as w,j as e,C as v,d as b,e as k,k as N,a as A,a8 as S,B as x,a9 as I,F as T,G as z,H as h,I as l,J as q,K as n,S as R,f as E,l as F,aa as H,ab as B,ac as L,ad as O,ae as Q,af as G,ag as U,ah as V,ai as Y,aj as J,ak as W,al as $,am as X,an as Z,ao as ee,ap as ae,aq as se,ar as te,as as c,at as ie}from"./index-0RzEmktz.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=o("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=o("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=o("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=o("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=o("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),de=async s=>{const{data:i,error:t}=await j.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",s).order("created_at",{ascending:!1});if(t)throw t;return i},he=async(s,i)=>{const{data:t,error:r}=await j.rpc("create_api_key",{p_organization_id:s,p_key_name:i});if(r)throw r;return t},xe=async(s,i)=>{const{data:t,error:r}=await j.from("api_keys").update({status:i}).eq("id",s).select().single();if(r)throw r;return t},ue=({apiKey:s})=>{const[i,t]=y.useState(!1),r=()=>{navigator.clipboard.writeText(s),t(!0),c({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>t(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:s}),e.jsx(x,{variant:"ghost",size:"icon",onClick:r,children:i?e.jsx(te,{className:"h-4 w-4 text-green-500"}):e.jsx(ne,{className:"h-4 w-4"})})]})},pe=()=>{const{organization:s}=M(),i=K(),[t,r]=y.useState(""),[m,C]=y.useState(null),u=["apiKeys",s==null?void 0:s.id],{data:p,isLoading:_}=P({queryKey:u,queryFn:()=>de(s.id),enabled:!!s}),d=w({mutationFn:a=>he(s.id,a),onSuccess:a=>{c({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),C(a),r(""),i.invalidateQueries({queryKey:u})},onError:a=>{c({title:"Error",description:a.message,variant:"destructive"})}}),f=w({mutationFn:({keyId:a,status:g})=>xe(a,g),onSuccess:()=>{c({title:"Status Updated"}),i.invalidateQueries({queryKey:u})},onError:a=>{c({title:"Error",description:a.message,variant:"destructive"})}}),D=a=>{a.preventDefault(),t.trim()&&s&&d.mutate(t.trim())};return e.jsxs(v,{className:"col-span-1 lg:col-span-2",children:[e.jsxs(b,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(le,{})," API Keys"]}),e.jsx(N,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(A,{children:[e.jsxs("form",{onSubmit:D,className:"flex items-center gap-2 mb-6",children:[e.jsx(S,{placeholder:"New key name (e.g., 'SMS Integration')",value:t,onChange:a=>r(a.target.value),disabled:d.isPending}),e.jsxs(x,{type:"submit",disabled:!t.trim()||d.isPending,children:[d.isPending?e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(re,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(T,{children:[e.jsx(z,{children:e.jsxs(h,{children:[e.jsx(l,{children:"Name"}),e.jsx(l,{children:"Key Prefix"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Last Used"}),e.jsx(l,{children:"Created"}),e.jsx(l,{className:"text-right",children:"Actions"})]})}),e.jsx(q,{children:_?Array.from({length:3}).map((a,g)=>e.jsx(h,{children:e.jsx(n,{colSpan:6,children:e.jsx(R,{className:"h-8 w-full"})})},g)):p&&p.length>0?p.map(a=>e.jsxs(h,{children:[e.jsx(n,{className:"font-medium",children:a.key_name}),e.jsx(n,{children:e.jsxs("code",{children:[a.key_prefix,"..."]})}),e.jsx(n,{children:e.jsx(E,{variant:a.status==="active"?"default":"secondary",children:a.status})}),e.jsx(n,{children:a.last_used_at?`${F(new Date(a.last_used_at))} ago`:"Never"}),e.jsx(n,{children:H(new Date(a.created_at),"MMM d, yyyy")}),e.jsx(n,{className:"text-right",children:e.jsxs(B,{children:[e.jsx(L,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",disabled:f.isPending,children:a.status==="active"?e.jsx(ce,{className:"h-4 w-4"}):e.jsx(oe,{className:"h-4 w-4"})})}),e.jsxs(O,{children:[e.jsxs(Q,{children:[e.jsx(G,{children:"Are you sure?"}),e.jsxs(U,{children:["This will ",a.status==="active"?"deactivate":"activate"," the API key.",a.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(V,{children:[e.jsx(Y,{children:"Cancel"}),e.jsx(J,{onClick:()=>f.mutate({keyId:a.id,status:a.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},a.id)):e.jsx(h,{children:e.jsx(n,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(W,{open:!!m,onOpenChange:a=>!a&&C(null),children:e.jsxs($,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"API Key Created Successfully"}),e.jsx(ee,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(ue,{apiKey:m||""}),e.jsx(ae,{children:e.jsx(se,{asChild:!0,children:e.jsx(x,{children:"Close"})})})]})})]})]})},ge=()=>e.jsxs(v,{children:[e.jsxs(b,{children:[e.jsx(k,{children:"CRM Integration"}),e.jsx(N,{children:"Connect to your favorite CRM."})]}),e.jsx(A,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"CRM integrations are coming soon."})})]}),je=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ie,{}),e.jsx(pe,{}),e.jsx(ge,{})]})]});export{je as IntegrationsTab,je as default};
