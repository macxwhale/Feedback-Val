import{i as K,r as M,j as e,au as y,av as $,a8 as h,C as V,a as O,B as b,aw as f,ax as H,ay as L,az as F,aA as P,aB as z,aC as A,aD as B,aE as U,h as X,g as E,u as k,d as I,e as T,aF as g}from"./index-BJV0mBfN.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=K("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=K("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),W=({questionType:s,supportsOptions:o,supportsScale:c,options:x=[],scaleConfig:t,helpText:p="",placeholderText:n="",onOptionsChange:j,onScaleChange:m,onHelpTextChange:i,onPlaceholderChange:u})=>{const[v,_]=M.useState(x.length>0?x:N());function N(){return s==="emoji"?[{text:"ðŸ˜Š",value:"happy"},{text:"ðŸ˜",value:"neutral"},{text:"ðŸ˜ž",value:"sad"}]:[{text:""},{text:""}]}const Q=()=>{const l=s==="emoji"?{text:"ðŸ˜Š",value:""}:{text:""},r=[...v,l];_(r),j(r)},w=l=>{const r=v.filter((d,S)=>S!==l);_(r),j(r)},a=(l,r,d)=>{const S=v.map((q,R)=>R===l?{...q,[r]:d}:q);_(S),j(S)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"help-text",children:"Help Text (optional)"}),e.jsx($,{id:"help-text",value:p,onChange:l=>i(l.target.value),placeholder:"Additional guidance for users...",className:"mt-1"})]}),s==="text"&&e.jsxs("div",{children:[e.jsx(y,{htmlFor:"placeholder",children:"Placeholder Text"}),e.jsx(h,{id:"placeholder",value:n,onChange:l=>u(l.target.value),placeholder:"Enter placeholder text...",className:"mt-1"})]}),o&&e.jsx(V,{children:e.jsx(O,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{children:s==="emoji"?"Emoji Options":"Answer Options"}),s==="emoji"&&e.jsx("p",{className:"text-sm text-gray-600",children:"Enter emoji characters (ðŸ˜Š, ðŸ˜, ðŸ˜ž, etc.) for users to select from"}),v.map((l,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{value:l.text,onChange:d=>a(r,"text",d.target.value),placeholder:s==="emoji"?"ðŸ˜Š":`Option ${r+1}`,className:s==="emoji"?"w-16 text-center text-2xl":"flex-1"}),s!=="emoji"&&e.jsx(h,{value:l.value||"",onChange:d=>a(r,"value",d.target.value),placeholder:"Value",className:"w-20"}),s==="emoji"&&e.jsx(h,{value:l.value||"",onChange:d=>a(r,"value",d.target.value),placeholder:"Description",className:"flex-1"}),v.length>(s==="emoji"?1:2)&&e.jsx(b,{type:"button",variant:"outline",size:"sm",onClick:()=>w(r),children:e.jsx(f,{className:"w-4 h-4"})})]},r)),e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:Q,className:"w-full",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"Add ",s==="emoji"?"Emoji":"Option"]})]})})}),c&&e.jsx(V,{children:e.jsx(O,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{children:"Scale Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"min-value",children:"Min Value"}),e.jsx(h,{id:"min-value",type:"number",value:(t==null?void 0:t.minValue)||1,onChange:l=>m({...t,minValue:parseInt(l.target.value)||1,maxValue:(t==null?void 0:t.maxValue)||5})})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"max-value",children:"Max Value"}),e.jsx(h,{id:"max-value",type:"number",value:(t==null?void 0:t.maxValue)||5,onChange:l=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:parseInt(l.target.value)||5})})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"min-label",children:"Min Label"}),e.jsx(h,{id:"min-label",value:(t==null?void 0:t.minLabel)||"",onChange:l=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:(t==null?void 0:t.maxValue)||5,minLabel:l.target.value}),placeholder:"e.g., Poor"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"max-label",children:"Max Label"}),e.jsx(h,{id:"max-label",value:(t==null?void 0:t.maxLabel)||"",onChange:l=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:(t==null?void 0:t.maxValue)||5,maxLabel:l.target.value}),placeholder:"e.g., Excellent"})]})]})]})})}),e.jsxs("div",{className:"text-sm text-gray-600 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("strong",{children:["Selected Type: ",s]}),e.jsxs("div",{className:"mt-1",children:[o&&e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:"Supports Options"}),c&&e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs mr-2",children:"Supports Scale"}),s==="text"&&e.jsx("span",{className:"inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:"Text Input"}),s==="emoji"&&e.jsx("span",{className:"inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs",children:"Emoji Selection"})]})]})]})},Y=s=>({"single-choice":{supportsOptions:!0,supportsScale:!1},"multi-choice":{supportsOptions:!0,supportsScale:!1},star:{supportsOptions:!1,supportsScale:!0},likert:{supportsOptions:!1,supportsScale:!0},nps:{supportsOptions:!1,supportsScale:!0},slider:{supportsOptions:!1,supportsScale:!0},emoji:{supportsOptions:!0,supportsScale:!1},ranking:{supportsOptions:!0,supportsScale:!1},matrix:{supportsOptions:!0,supportsScale:!0},text:{supportsOptions:!1,supportsScale:!1}})[s]||{supportsOptions:!1,supportsScale:!1},Z=({formData:s,setFormData:o,questionTypes:c,categories:x,editingId:t,onSubmit:p,onCancel:n,isSubmitting:j})=>{const m=Y(s.question_type);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(h,{placeholder:"Question text",value:s.question_text,onChange:i=>o(u=>({...u,question_text:i.target.value}))}),e.jsxs(L,{value:s.question_type,onValueChange:i=>o(u=>({...u,question_type:i,options:[],scaleConfig:{minValue:1,maxValue:5}})),children:[e.jsx(F,{children:e.jsx(P,{})}),e.jsx(z,{children:c.map(i=>e.jsx(A,{value:i.name,children:i.display_name},i.id))})]}),e.jsxs(L,{value:s.category,onValueChange:i=>o(u=>({...u,category:i})),children:[e.jsx(F,{children:e.jsx(P,{})}),e.jsx(z,{children:x.map(i=>e.jsx(A,{value:i.name,children:i.name},i.id))})]})]}),e.jsx(W,{questionType:s.question_type,supportsOptions:m.supportsOptions,supportsScale:m.supportsScale,options:s.options,scaleConfig:s.scaleConfig,helpText:s.help_text,placeholderText:s.placeholder_text,onOptionsChange:i=>o(u=>({...u,options:i})),onScaleChange:i=>o(u=>({...u,scaleConfig:i})),onHelpTextChange:i=>o(u=>({...u,help_text:i})),onPlaceholderChange:i=>o(u=>({...u,placeholder_text:i}))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:p,disabled:!s.question_text.trim()||j,children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),t?"Update":"Add"," Question"]}),t&&e.jsx(b,{variant:"outline",onClick:n,children:"Cancel"})]})]})},D=({questions:s,onEdit:o,onDelete:c,isDeleting:x})=>{const{toast:t}=B(),p=async n=>{n.response_count>0&&t({title:"Question will be archived",description:"This question has responses and will be archived instead of deleted.",variant:"default"}),c(n.id)};return s.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No questions found. Create your first question above."}):e.jsx("div",{className:"space-y-2",children:s.map(n=>e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg ${n.is_active?"":"bg-gray-50 opacity-75"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:n.question_text}),!n.is_active&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800",children:[e.jsx(G,{className:"w-3 h-3"}),"Archived"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Type: ",n.question_type," | Category: ",n.category," | Order: ",n.order_index,n.help_text&&e.jsxs("span",{children:[" | Help: ",n.help_text]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:"outline",onClick:()=>o(n),disabled:!n.is_active,children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>p(n),disabled:x||!n.is_active,children:e.jsx(U,{className:"w-4 h-4"})})]})]},n.id))})},C=()=>{const{toast:s}=B(),o=X(),[c,x]=M.useState(null),[t,p]=M.useState({question_text:"",question_type:"star",category:"QualityService",order_index:1,help_text:"",placeholder_text:"",is_required:!1,options:[],scaleConfig:{minValue:1,maxValue:5}}),{data:n=[],isLoading:j}=E({queryKey:["questions"],queryFn:()=>g.getQuestions()}),{data:m=[]}=E({queryKey:["question-types"],queryFn:()=>g.getQuestionTypes()}),{data:i=[]}=E({queryKey:["question-categories"],queryFn:()=>g.getQuestionCategories()}),u=k({mutationFn:g.createQuestion,onSuccess:()=>{o.invalidateQueries({queryKey:["questions"]}),s({title:"Question created successfully"}),N()},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),v=k({mutationFn:({id:a,...l})=>g.updateQuestion(a,l),onSuccess:()=>{o.invalidateQueries({queryKey:["questions"]}),s({title:"Question updated successfully"}),N()},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),_=k({mutationFn:a=>g.deleteQuestion(a),onSuccess:()=>{o.invalidateQueries({queryKey:["questions"]}),s({title:"Question deleted successfully"})},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),N=()=>{x(null),p({question_text:"",question_type:"star",category:"QualityService",order_index:1,help_text:"",placeholder_text:"",is_required:!1,options:[],scaleConfig:{minValue:1,maxValue:5}})},Q=()=>{if(!t.question_text.trim()){s({title:"Validation Error",description:"Question text is required",variant:"destructive"});return}const a=n.length>0?Math.max(...n.map(d=>d.order_index)):0,l=c?t.order_index:a+1,r={...t,order_index:l};c?v.mutate({id:c,...r}):u.mutate(r)},w=a=>{var l,r;x(a.id),p({question_text:a.question_text,question_type:a.question_type,category:a.category,order_index:a.order_index,help_text:a.help_text||"",placeholder_text:a.placeholder_text||"",is_required:a.is_required||!1,options:((l=a.question_options)==null?void 0:l.map(d=>({text:d.option_text,value:d.option_value})))||[],scaleConfig:(r=a.question_scale_config)!=null&&r[0]?{minValue:a.question_scale_config[0].min_value,maxValue:a.question_scale_config[0].max_value,minLabel:a.question_scale_config[0].min_label||"",maxLabel:a.question_scale_config[0].max_label||"",stepSize:a.question_scale_config[0].step_size}:{minValue:1,maxValue:5}})};return j?e.jsxs(V,{children:[e.jsx(I,{children:e.jsx(T,{children:"Questions Management"})}),e.jsx(O,{children:e.jsx("div",{className:"text-center py-8",children:"Loading questions..."})})]}):e.jsxs(V,{children:[e.jsx(I,{children:e.jsx(T,{children:"Questions Management"})}),e.jsxs(O,{className:"space-y-6",children:[e.jsx(Z,{formData:t,setFormData:p,questionTypes:m,categories:i,editingId:c,onSubmit:Q,onCancel:N,isSubmitting:u.isPending||v.isPending}),e.jsx(D,{questions:n,onEdit:w,onDelete:a=>_.mutate(a),isDeleting:_.isPending})]})]})},te=()=>e.jsx(C,{});export{te as QuestionsTab,te as default};
