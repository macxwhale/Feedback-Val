import{b0 as p,ae as y,ac as q,j as e,C as v,k as R,q as b,b1 as A,l as w,B as C,b2 as P,T as g,i as j,b3 as d,r as B,ao as F}from"./index-BSJSsHZa.js";const T=({organizationId:n}={})=>{const{hasPermission:r,userRole:s,isLoading:t,isAdmin:a}=p(n),{isAdmin:i}=y();return{hasPermission:m=>a||i||s&&["owner","admin"].includes(s)?!0:r(m),hasRole:m=>a||i||s&&["owner","admin"].includes(s)?!0:s===m,userRole:s,isLoading:t,isSystemAdmin:a||i,isOrgAdmin:s&&["owner","admin"].includes(s)}},N=({type:n,requiredRole:r,requiredPermission:s,userRole:t,onRequestAccess:a,isSubmitting:i=!1})=>{const{organization:l}=q(),u=()=>{if(!r||!t)return null;const c=d(r),o=d(t),x=c.icon,h=o.icon;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-4 h-4 text-amber-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["You need ",c.label," level access or higher."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Required role:"}),e.jsxs(j,{variant:c.variant,className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-3 h-3"}),c.label]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Your role:"}),e.jsxs(j,{variant:o.variant,className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),o.label]})]})]})]})},m=()=>{if(!s||!t)return null;const c=d(t).icon;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-4 h-4 text-amber-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["You don't have the required permission: ",s]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Your role:"}),e.jsxs(j,{variant:d(t).variant,className:"flex items-center gap-1",children:[e.jsx(c,{className:"w-3 h-3"}),d(t).label]})]})]})};return e.jsxs(v,{className:"border-red-200",children:[e.jsx(R,{children:e.jsxs(b,{className:"flex items-center text-red-600",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),n==="role"?"Access Restricted":"Permission Required"]})}),e.jsxs(w,{className:"space-y-4",children:[n==="role"?u():m(),l&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Organization:"})," ",l.name]})}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs(C,{onClick:a,size:"sm",className:"w-full",disabled:i,children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),i?"Requesting...":n==="role"?"Request Role Upgrade":"Request Access"]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Contact your organization administrator for assistance."})]})]})]})},k=()=>{const[n,r]=B.useState(!1);return{submitAccessRequest:async t=>{r(!0);try{console.log("Access request submitted:",t),await new Promise(a=>setTimeout(a,1e3)),console.log("Access request submitted successfully")}catch(a){throw console.error("Failed to submit access request:",a),a}finally{r(!1)}},isSubmitting:n}},S=({children:n,permission:r,role:s,organizationId:t,fallback:a,showRequiredRole:i=!1,onRequestAccess:l})=>{const{hasPermission:u,hasRole:m,userRole:c,isLoading:o}=T({organizationId:t}),{submitAccessRequest:x,isSubmitting:h}=k();if(o)return e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Checking permissions..."})]})});if(r&&!u(r)){if(a)return e.jsx(e.Fragment,{children:a});if(!i)return null;const f=async()=>{l?l():await x({requestType:"permission",requestedPermission:r,reason:`Need ${r} permission to access this feature`})};return e.jsx(N,{type:"permission",requiredPermission:r,userRole:c,onRequestAccess:f,isSubmitting:h})}if(s&&!m(s)){if(a)return e.jsx(e.Fragment,{children:a});if(!i)return null;const f=async()=>{l?l():await x({requestType:"role_upgrade",requestedRole:s,reason:`Need ${s} level access for this feature`})};return e.jsx(N,{type:"role",requiredRole:s,userRole:c,onRequestAccess:f,isSubmitting:h})}return e.jsx(e.Fragment,{children:n})};export{S as P,T as u};
