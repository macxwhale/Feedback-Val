import{c as f,r as E,j as e,W as y,X as Y,J as h,C as V,m as O,B as b,Y as $,_ as K,$ as A,a0 as L,a1 as z,a2 as P,a3 as F,a4 as H,a5 as B,a6 as X,u as k,a7 as q,l as I,w as T,a8 as g,a9 as G,aa as J}from"./index-BkiKD_L_.js";import{P as U}from"./PermissionGuard-DDThFtxg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=f("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=f("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),D=({questionType:s,supportsOptions:o,supportsScale:u,options:x=[],scaleConfig:t,helpText:p="",placeholderText:n="",onOptionsChange:j,onScaleChange:m,onHelpTextChange:l,onPlaceholderChange:c})=>{const[v,_]=E.useState(x.length>0?x:N());function N(){return s==="emoji"?[{text:"😊",value:"happy"},{text:"😐",value:"neutral"},{text:"😞",value:"sad"}]:[{text:""},{text:""}]}const Q=()=>{const i=s==="emoji"?{text:"😊",value:""}:{text:""},r=[...v,i];_(r),j(r)},w=i=>{const r=v.filter((d,S)=>S!==i);_(r),j(r)},a=(i,r,d)=>{const S=v.map((M,R)=>R===i?{...M,[r]:d}:M);_(S),j(S)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"help-text",children:"Help Text (optional)"}),e.jsx(Y,{id:"help-text",value:p,onChange:i=>l(i.target.value),placeholder:"Additional guidance for users...",className:"mt-1"})]}),s==="text"&&e.jsxs("div",{children:[e.jsx(y,{htmlFor:"placeholder",children:"Placeholder Text"}),e.jsx(h,{id:"placeholder",value:n,onChange:i=>c(i.target.value),placeholder:"Enter placeholder text...",className:"mt-1"})]}),o&&e.jsx(V,{children:e.jsx(O,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{children:s==="emoji"?"Emoji Options":"Answer Options"}),s==="emoji"&&e.jsx("p",{className:"text-sm text-gray-600",children:"Enter emoji characters (😊, 😐, 😞, etc.) for users to select from"}),v.map((i,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{value:i.text,onChange:d=>a(r,"text",d.target.value),placeholder:s==="emoji"?"😊":`Option ${r+1}`,className:s==="emoji"?"w-16 text-center text-2xl":"flex-1"}),s!=="emoji"&&e.jsx(h,{value:i.value||"",onChange:d=>a(r,"value",d.target.value),placeholder:"Value",className:"w-20"}),s==="emoji"&&e.jsx(h,{value:i.value||"",onChange:d=>a(r,"value",d.target.value),placeholder:"Description",className:"flex-1"}),v.length>(s==="emoji"?1:2)&&e.jsx(b,{type:"button",variant:"outline",size:"sm",onClick:()=>w(r),children:e.jsx($,{className:"w-4 h-4"})})]},r)),e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:Q,className:"w-full",children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),"Add ",s==="emoji"?"Emoji":"Option"]})]})})}),u&&e.jsx(V,{children:e.jsx(O,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{children:"Scale Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"min-value",children:"Min Value"}),e.jsx(h,{id:"min-value",type:"number",value:(t==null?void 0:t.minValue)||1,onChange:i=>m({...t,minValue:parseInt(i.target.value)||1,maxValue:(t==null?void 0:t.maxValue)||5})})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"max-value",children:"Max Value"}),e.jsx(h,{id:"max-value",type:"number",value:(t==null?void 0:t.maxValue)||5,onChange:i=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:parseInt(i.target.value)||5})})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"min-label",children:"Min Label"}),e.jsx(h,{id:"min-label",value:(t==null?void 0:t.minLabel)||"",onChange:i=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:(t==null?void 0:t.maxValue)||5,minLabel:i.target.value}),placeholder:"e.g., Poor"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"max-label",children:"Max Label"}),e.jsx(h,{id:"max-label",value:(t==null?void 0:t.maxLabel)||"",onChange:i=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:(t==null?void 0:t.maxValue)||5,maxLabel:i.target.value}),placeholder:"e.g., Excellent"})]})]})]})})}),e.jsxs("div",{className:"text-sm text-gray-600 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("strong",{children:["Selected Type: ",s]}),e.jsxs("div",{className:"mt-1",children:[o&&e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:"Supports Options"}),u&&e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs mr-2",children:"Supports Scale"}),s==="text"&&e.jsx("span",{className:"inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:"Text Input"}),s==="emoji"&&e.jsx("span",{className:"inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs",children:"Emoji Selection"})]})]})]})},C=s=>({"single-choice":{supportsOptions:!0,supportsScale:!1},"multi-choice":{supportsOptions:!0,supportsScale:!1},star:{supportsOptions:!1,supportsScale:!0},likert:{supportsOptions:!1,supportsScale:!0},nps:{supportsOptions:!1,supportsScale:!0},slider:{supportsOptions:!1,supportsScale:!0},emoji:{supportsOptions:!0,supportsScale:!1},ranking:{supportsOptions:!0,supportsScale:!1},matrix:{supportsOptions:!0,supportsScale:!0},text:{supportsOptions:!1,supportsScale:!1}})[s]||{supportsOptions:!1,supportsScale:!1},ee=({formData:s,setFormData:o,questionTypes:u,categories:x,editingId:t,onSubmit:p,onCancel:n,isSubmitting:j})=>{const m=C(s.question_type);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(h,{placeholder:"Question text",value:s.question_text,onChange:l=>o(c=>({...c,question_text:l.target.value}))}),e.jsxs(A,{value:s.question_type,onValueChange:l=>o(c=>({...c,question_type:l,options:[],scaleConfig:{minValue:1,maxValue:5}})),children:[e.jsx(L,{children:e.jsx(z,{})}),e.jsx(P,{children:u.map(l=>e.jsx(F,{value:l.name,children:l.display_name},l.id))})]}),e.jsxs(A,{value:s.category,onValueChange:l=>o(c=>({...c,category:l})),children:[e.jsx(L,{children:e.jsx(z,{})}),e.jsx(P,{children:x.map(l=>e.jsx(F,{value:l.name,children:l.name},l.id))})]})]}),e.jsx(D,{questionType:s.question_type,supportsOptions:m.supportsOptions,supportsScale:m.supportsScale,options:s.options,scaleConfig:s.scaleConfig,helpText:s.help_text,placeholderText:s.placeholder_text,onOptionsChange:l=>o(c=>({...c,options:l})),onScaleChange:l=>o(c=>({...c,scaleConfig:l})),onHelpTextChange:l=>o(c=>({...c,help_text:l})),onPlaceholderChange:l=>o(c=>({...c,placeholder_text:l}))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:p,disabled:!s.question_text.trim()||j,children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),t?"Update":"Add"," Question"]}),t&&e.jsx(b,{variant:"outline",onClick:n,children:"Cancel"})]})]})},te=({questions:s,onEdit:o,onDelete:u,isDeleting:x})=>{const{toast:t}=H(),p=async n=>{n.response_count>0&&t({title:"Question will be archived",description:"This question has responses and will be archived instead of deleted.",variant:"default"}),u(n.id)};return s.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No questions found. Create your first question above."}):e.jsx("div",{className:"space-y-2",children:s.map(n=>e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg ${n.is_active?"":"bg-gray-50 opacity-75"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:n.question_text}),!n.is_active&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800",children:[e.jsx(W,{className:"w-3 h-3"}),"Archived"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Type: ",n.question_type," | Category: ",n.category," | Order: ",n.order_index,n.help_text&&e.jsxs("span",{children:[" | Help: ",n.help_text]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:"outline",onClick:()=>o(n),disabled:!n.is_active,children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>p(n),disabled:x||!n.is_active,children:e.jsx(B,{className:"w-4 h-4"})})]})]},n.id))})},se=()=>{const{toast:s}=H(),o=X(),[u,x]=E.useState(null),[t,p]=E.useState({question_text:"",question_type:"star",category:"QualityService",order_index:1,help_text:"",placeholder_text:"",is_required:!1,options:[],scaleConfig:{minValue:1,maxValue:5}}),{data:n=[],isLoading:j}=k({queryKey:["questions"],queryFn:()=>g.getQuestions()}),{data:m=[]}=k({queryKey:["question-types"],queryFn:()=>g.getQuestionTypes()}),{data:l=[]}=k({queryKey:["question-categories"],queryFn:()=>g.getQuestionCategories()}),c=q({mutationFn:g.createQuestion,onSuccess:()=>{o.invalidateQueries({queryKey:["questions"]}),s({title:"Question created successfully"}),N()},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),v=q({mutationFn:({id:a,...i})=>g.updateQuestion(a,i),onSuccess:()=>{o.invalidateQueries({queryKey:["questions"]}),s({title:"Question updated successfully"}),N()},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),_=q({mutationFn:a=>g.deleteQuestion(a),onSuccess:()=>{o.invalidateQueries({queryKey:["questions"]}),s({title:"Question deleted successfully"})},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),N=()=>{x(null),p({question_text:"",question_type:"star",category:"QualityService",order_index:1,help_text:"",placeholder_text:"",is_required:!1,options:[],scaleConfig:{minValue:1,maxValue:5}})},Q=()=>{if(!t.question_text.trim()){s({title:"Validation Error",description:"Question text is required",variant:"destructive"});return}const a=n.length>0?Math.max(...n.map(d=>d.order_index)):0,i=u?t.order_index:a+1,r={...t,order_index:i};u?v.mutate({id:u,...r}):c.mutate(r)},w=a=>{var i,r;x(a.id),p({question_text:a.question_text,question_type:a.question_type,category:a.category,order_index:a.order_index,help_text:a.help_text||"",placeholder_text:a.placeholder_text||"",is_required:a.is_required||!1,options:((i=a.question_options)==null?void 0:i.map(d=>({text:d.option_text,value:d.option_value})))||[],scaleConfig:(r=a.question_scale_config)!=null&&r[0]?{minValue:a.question_scale_config[0].min_value,maxValue:a.question_scale_config[0].max_value,minLabel:a.question_scale_config[0].min_label||"",maxLabel:a.question_scale_config[0].max_label||"",stepSize:a.question_scale_config[0].step_size}:{minValue:1,maxValue:5}})};return j?e.jsxs(V,{children:[e.jsx(I,{children:e.jsx(T,{children:"Questions Management"})}),e.jsx(O,{children:e.jsx("div",{className:"text-center py-8",children:"Loading questions..."})})]}):e.jsxs(V,{children:[e.jsx(I,{children:e.jsx(T,{children:"Questions Management"})}),e.jsxs(O,{className:"space-y-6",children:[e.jsx(ee,{formData:t,setFormData:p,questionTypes:m,categories:l,editingId:u,onSubmit:Q,onCancel:N,isSubmitting:c.isPending||v.isPending}),e.jsx(te,{questions:n,onEdit:w,onDelete:a=>_.mutate(a),isDeleting:_.isPending})]})]})},le=()=>{const{isAdmin:s,isOrgAdmin:o}=G(),{organization:u}=J();return s||o?e.jsx(U,{permission:"view_analytics",organizationId:u==null?void 0:u.id,showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need admin-level access or higher to manage questions."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsx(se,{})}):e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need organization admin access to manage questions."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]})};export{le as QuestionsTab,le as default};
