import{c as v,Y as j,r as p,j as e,C as k,k as C,o as N,l as S,I as i,B as _,s as y,N as w,ah as q}from"./index-DSyFPu6e.js";import{a as f,u as F,L as c}from"./label-aXPw7gIn.js";import{T as x}from"./textarea-BtRNzcAa.js";import{S as g,a as T}from"./switch-Cm798MUy.js";import{P}from"./PermissionGuard-7Hg8hmcJ.js";import"./index-851r-13A.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=v("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),A=({organization:a})=>{const{toast:l}=f(),n=j(),[r,o]=p.useState({name:a.name||"",primary_color:a.primary_color||"#007ACE",secondary_color:a.secondary_color||"#073763",feedback_header_title:a.feedback_header_title||"Customer Feedback",feedback_header_subtitle:a.feedback_header_subtitle||"We value your feedback",welcome_screen_title:a.welcome_screen_title||"Welcome",welcome_screen_description:a.welcome_screen_description||"Please share your feedback with us",thank_you_title:a.thank_you_title||"Thank You!",thank_you_message:a.thank_you_message||"Your feedback has been submitted successfully",sms_enabled:a.sms_enabled||!1,sms_sender_id:a.sms_sender_id||"",is_active:a.is_active!==!1}),m=F({mutationFn:async s=>{const{data:h,error:u}=await y.from("organizations").update(s).eq("id",a.id).select().single();if(u)throw u;return h},onSuccess:()=>{l({title:"Settings Updated",description:"Organization settings have been saved successfully."}),n.invalidateQueries({queryKey:["organization"]})},onError:s=>{l({title:"Error",description:"Failed to update organization settings. Please try again.",variant:"destructive"}),console.error("Error updating organization:",s)}}),t=(s,h)=>{o(u=>({...u,[s]:h}))},d=s=>{s.preventDefault(),m.mutate(r)},b=()=>{o({name:a.name||"",primary_color:a.primary_color||"#007ACE",secondary_color:a.secondary_color||"#073763",feedback_header_title:a.feedback_header_title||"Customer Feedback",feedback_header_subtitle:a.feedback_header_subtitle||"We value your feedback",welcome_screen_title:a.welcome_screen_title||"Welcome",welcome_screen_description:a.welcome_screen_description||"Please share your feedback with us",thank_you_title:a.thank_you_title||"Thank You!",thank_you_message:a.thank_you_message||"Your feedback has been submitted successfully",sms_enabled:a.sms_enabled||!1,sms_sender_id:a.sms_sender_id||"",is_active:a.is_active!==!1})};return e.jsx("div",{className:"space-y-6",children:e.jsxs(k,{children:[e.jsx(C,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"Organization Settings"]})}),e.jsx(S,{children:e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"name",children:"Organization Name"}),e.jsx(i,{id:"name",value:r.name,onChange:s=>t("name",s.target.value),placeholder:"Enter organization name"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"slug",children:"Organization Slug"}),e.jsx(i,{id:"slug",value:a.slug,className:"bg-gray-50",readOnly:!0,disabled:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"The slug cannot be changed after creation"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Brand Colors"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"primary_color",children:"Primary Color"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{id:"primary_color",type:"color",value:r.primary_color,onChange:s=>t("primary_color",s.target.value),className:"w-16 h-10 p-1 border rounded"}),e.jsx(i,{value:r.primary_color,onChange:s=>t("primary_color",s.target.value),placeholder:"#007ACE",className:"flex-1"})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"secondary_color",children:"Secondary Color"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{id:"secondary_color",type:"color",value:r.secondary_color,onChange:s=>t("secondary_color",s.target.value),className:"w-16 h-10 p-1 border rounded"}),e.jsx(i,{value:r.secondary_color,onChange:s=>t("secondary_color",s.target.value),placeholder:"#073763",className:"flex-1"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Feedback Form Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"feedback_header_title",children:"Header Title"}),e.jsx(i,{id:"feedback_header_title",value:r.feedback_header_title,onChange:s=>t("feedback_header_title",s.target.value),placeholder:"Customer Feedback"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"feedback_header_subtitle",children:"Header Subtitle"}),e.jsx(i,{id:"feedback_header_subtitle",value:r.feedback_header_subtitle,onChange:s=>t("feedback_header_subtitle",s.target.value),placeholder:"We value your feedback"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Welcome Screen"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"welcome_screen_title",children:"Welcome Title"}),e.jsx(i,{id:"welcome_screen_title",value:r.welcome_screen_title,onChange:s=>t("welcome_screen_title",s.target.value),placeholder:"Welcome"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"thank_you_title",children:"Thank You Title"}),e.jsx(i,{id:"thank_you_title",value:r.thank_you_title,onChange:s=>t("thank_you_title",s.target.value),placeholder:"Thank You!"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"welcome_screen_description",children:"Welcome Description"}),e.jsx(x,{id:"welcome_screen_description",value:r.welcome_screen_description,onChange:s=>t("welcome_screen_description",s.target.value),placeholder:"Please share your feedback with us",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"thank_you_message",children:"Thank You Message"}),e.jsx(x,{id:"thank_you_message",value:r.thank_you_message,onChange:s=>t("thank_you_message",s.target.value),placeholder:"Your feedback has been submitted successfully",rows:3})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"SMS Configuration"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{id:"sms_enabled",checked:r.sms_enabled,onCheckedChange:s=>t("sms_enabled",s)}),e.jsx(c,{htmlFor:"sms_enabled",children:"Enable SMS Feedback Collection"})]}),r.sms_enabled&&e.jsxs("div",{children:[e.jsx(c,{htmlFor:"sms_sender_id",children:"SMS Sender ID"}),e.jsx(i,{id:"sms_sender_id",value:r.sms_sender_id,onChange:s=>t("sms_sender_id",s.target.value),placeholder:"Enter SMS sender ID"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Organization Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{id:"is_active",checked:r.is_active,onCheckedChange:s=>t("is_active",s)}),e.jsx(c,{htmlFor:"is_active",children:"Organization Active"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Inactive organizations cannot collect feedback"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-6 border-t",children:[e.jsx(_,{type:"button",variant:"outline",onClick:b,disabled:m.isPending,children:"Reset Changes"}),e.jsxs(_,{type:"submit",disabled:m.isPending,className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),m.isPending?"Saving...":"Save Settings"]})]})]})})]})})},R=()=>{const[a,l]=p.useState(!1),{user:n}=w(),{organization:r}=q(),{toast:o}=f();return{submitAccessRequest:async t=>{if(!n||!r)return o({title:"Error",description:"User or organization context not available",variant:"destructive"}),!1;l(!0);try{const{error:d}=await y.from("notifications").insert({organization_id:r.id,type:"info",title:"Access Request",message:`${n.email} has requested ${t.requestType==="role_upgrade"?"a role upgrade":"additional permissions"}`,metadata:{user_id:n.id,user_email:n.email,request_type:t.requestType,requested_role:t.requestedRole,requested_permission:t.requestedPermission,reason:t.reason,timestamp:new Date().toISOString()}});return d?(console.error("Error submitting access request:",d),o({title:"Error",description:"Failed to submit access request. Please try again.",variant:"destructive"}),!1):(o({title:"Request Submitted",description:"Your access request has been sent to the organization administrators.",variant:"default"}),!0)}catch(d){return console.error("Unexpected error submitting access request:",d),o({title:"Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"}),!1}finally{l(!1)}},isSubmitting:a}},B=({organization:a})=>{const{submitAccessRequest:l,isSubmitting:n}=R(),r=async()=>{await l({requestType:"permission",requestedPermission:"manage_organization",reason:"Need access to manage organization settings"})};return e.jsx(P,{permission:"manage_organization",organizationId:a.id,showRequiredRole:!0,onRequestAccess:r,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need admin-level access or higher to manage organization settings."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsx(A,{organization:a})})};export{B as SettingsTab,B as default};
