import{c as M,ai as L,aj as ue,ak as X,al as be,am as Ve,an as Ye,ao as Je,r as b,ap as Ze,aq as et,ar as tt,as as he,s as k,Y as re,u as se,j as e,C as E,k as F,o as q,af as Ie,l as D,I,B as y,ae as st,i as ie,at as Ke,au as Le,M as K,E as at,ag as xe,U as ae,N as We,m as ve,ab as nt,x as rt,T as it,ah as ct}from"./index-DSyFPu6e.js";import{u as T,t as j,L as A}from"./label-aXPw7gIn.js";import{T as ot,a as lt,b as ce,c as J,d as dt,e as Q,A as ut,f as mt,g as ht,h as xt,i as gt,j as ft,k as pt,l as yt,m as jt,D as ge,o as fe,p as pe,q as ye,r as wt,s as bt,t as vt}from"./dialog-B8-11T18.js";import{L as Nt,P as St}from"./PermissionGuard-7Hg8hmcJ.js";import{a as Ct,S as kt}from"./switch-Cm798MUy.js";import{C as Re}from"./circle-alert-KjjM8qDc.js";import{T as Mt,a as Ot,b as Ne,c as Se}from"./tabs-DcCN0eho.js";import{T as je}from"./textarea-BtRNzcAa.js";import{T as ze}from"./trash-2-IrkBwtsK.js";import{C as Pt}from"./calendar-DI4EyL9P.js";import{S as Ce,a as ke,b as Me,c as Oe,d as B}from"./select-HbqDsqMm.js";import"./index-851r-13A.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=M("ArrowDownWideNarrow",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=M("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=M("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=M("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=M("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=M("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=M("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=M("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=M("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=M("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=M("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=M("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kt=M("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=M("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=M("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=M("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=M("Webhook",[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]]);function ne(t,s){var u,h,g,c;const a=ue(),n=(s==null?void 0:s.weekStartsOn)??((h=(u=s==null?void 0:s.locale)==null?void 0:u.options)==null?void 0:h.weekStartsOn)??a.weekStartsOn??((c=(g=a.locale)==null?void 0:g.options)==null?void 0:c.weekStartsOn)??0,r=L(t),i=r.getDay(),o=(i<n?7:0)+i-n;return r.setDate(r.getDate()-o),r.setHours(0,0,0,0),r}function le(t){return ne(t,{weekStartsOn:1})}function Be(t){const s=L(t),a=s.getFullYear(),n=X(t,0);n.setFullYear(a+1,0,4),n.setHours(0,0,0,0);const r=le(n),i=X(t,0);i.setFullYear(a,0,4),i.setHours(0,0,0,0);const o=le(i);return s.getTime()>=r.getTime()?a+1:s.getTime()>=o.getTime()?a:a-1}function De(t){const s=L(t);return s.setHours(0,0,0,0),s}function zt(t,s){const a=De(t),n=De(s),r=+a-be(a),i=+n-be(n);return Math.round((r-i)/Ve)}function Bt(t){const s=Be(t),a=X(t,0);return a.setFullYear(s,0,4),a.setHours(0,0,0,0),le(a)}function Qt(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Ht(t){if(!Qt(t)&&typeof t!="number")return!1;const s=L(t);return!isNaN(Number(s))}function Ut(t){const s=L(t),a=X(t,0);return a.setFullYear(s.getFullYear(),0,1),a.setHours(0,0,0,0),a}function $t(t){const s=L(t);return zt(s,Ut(s))+1}function Gt(t){const s=L(t),a=+le(s)-+Bt(s);return Math.round(a/Ye)+1}function Qe(t,s){var c,d,l,N;const a=L(t),n=a.getFullYear(),r=ue(),i=(s==null?void 0:s.firstWeekContainsDate)??((d=(c=s==null?void 0:s.locale)==null?void 0:c.options)==null?void 0:d.firstWeekContainsDate)??r.firstWeekContainsDate??((N=(l=r.locale)==null?void 0:l.options)==null?void 0:N.firstWeekContainsDate)??1,o=X(t,0);o.setFullYear(n+1,0,i),o.setHours(0,0,0,0);const u=ne(o,s),h=X(t,0);h.setFullYear(n,0,i),h.setHours(0,0,0,0);const g=ne(h,s);return a.getTime()>=u.getTime()?n+1:a.getTime()>=g.getTime()?n:n-1}function Xt(t,s){var u,h,g,c;const a=ue(),n=(s==null?void 0:s.firstWeekContainsDate)??((h=(u=s==null?void 0:s.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)??a.firstWeekContainsDate??((c=(g=a.locale)==null?void 0:g.options)==null?void 0:c.firstWeekContainsDate)??1,r=Qe(t,s),i=X(t,0);return i.setFullYear(r,0,n),i.setHours(0,0,0,0),ne(i,s)}function Vt(t,s){const a=L(t),n=+ne(a,s)-+Xt(a,s);return Math.round(n/Ye)+1}function w(t,s){const a=t<0?"-":"",n=Math.abs(t).toString().padStart(s,"0");return a+n}const H={y(t,s){const a=t.getFullYear(),n=a>0?a:1-a;return w(s==="yy"?n%100:n,s.length)},M(t,s){const a=t.getMonth();return s==="M"?String(a+1):w(a+1,2)},d(t,s){return w(t.getDate(),s.length)},a(t,s){const a=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(t,s){return w(t.getHours()%12||12,s.length)},H(t,s){return w(t.getHours(),s.length)},m(t,s){return w(t.getMinutes(),s.length)},s(t,s){return w(t.getSeconds(),s.length)},S(t,s){const a=s.length,n=t.getMilliseconds(),r=Math.trunc(n*Math.pow(10,a-3));return w(r,s.length)}},Z={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Te={G:function(t,s,a){const n=t.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return a.era(n,{width:"abbreviated"});case"GGGGG":return a.era(n,{width:"narrow"});case"GGGG":default:return a.era(n,{width:"wide"})}},y:function(t,s,a){if(s==="yo"){const n=t.getFullYear(),r=n>0?n:1-n;return a.ordinalNumber(r,{unit:"year"})}return H.y(t,s)},Y:function(t,s,a,n){const r=Qe(t,n),i=r>0?r:1-r;if(s==="YY"){const o=i%100;return w(o,2)}return s==="Yo"?a.ordinalNumber(i,{unit:"year"}):w(i,s.length)},R:function(t,s){const a=Be(t);return w(a,s.length)},u:function(t,s){const a=t.getFullYear();return w(a,s.length)},Q:function(t,s,a){const n=Math.ceil((t.getMonth()+1)/3);switch(s){case"Q":return String(n);case"QQ":return w(n,2);case"Qo":return a.ordinalNumber(n,{unit:"quarter"});case"QQQ":return a.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,s,a){const n=Math.ceil((t.getMonth()+1)/3);switch(s){case"q":return String(n);case"qq":return w(n,2);case"qo":return a.ordinalNumber(n,{unit:"quarter"});case"qqq":return a.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,s,a){const n=t.getMonth();switch(s){case"M":case"MM":return H.M(t,s);case"Mo":return a.ordinalNumber(n+1,{unit:"month"});case"MMM":return a.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(n,{width:"wide",context:"formatting"})}},L:function(t,s,a){const n=t.getMonth();switch(s){case"L":return String(n+1);case"LL":return w(n+1,2);case"Lo":return a.ordinalNumber(n+1,{unit:"month"});case"LLL":return a.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(n,{width:"wide",context:"standalone"})}},w:function(t,s,a,n){const r=Vt(t,n);return s==="wo"?a.ordinalNumber(r,{unit:"week"}):w(r,s.length)},I:function(t,s,a){const n=Gt(t);return s==="Io"?a.ordinalNumber(n,{unit:"week"}):w(n,s.length)},d:function(t,s,a){return s==="do"?a.ordinalNumber(t.getDate(),{unit:"date"}):H.d(t,s)},D:function(t,s,a){const n=$t(t);return s==="Do"?a.ordinalNumber(n,{unit:"dayOfYear"}):w(n,s.length)},E:function(t,s,a){const n=t.getDay();switch(s){case"E":case"EE":case"EEE":return a.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(n,{width:"short",context:"formatting"});case"EEEE":default:return a.day(n,{width:"wide",context:"formatting"})}},e:function(t,s,a,n){const r=t.getDay(),i=(r-n.weekStartsOn+8)%7||7;switch(s){case"e":return String(i);case"ee":return w(i,2);case"eo":return a.ordinalNumber(i,{unit:"day"});case"eee":return a.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(r,{width:"short",context:"formatting"});case"eeee":default:return a.day(r,{width:"wide",context:"formatting"})}},c:function(t,s,a,n){const r=t.getDay(),i=(r-n.weekStartsOn+8)%7||7;switch(s){case"c":return String(i);case"cc":return w(i,s.length);case"co":return a.ordinalNumber(i,{unit:"day"});case"ccc":return a.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(r,{width:"narrow",context:"standalone"});case"cccccc":return a.day(r,{width:"short",context:"standalone"});case"cccc":default:return a.day(r,{width:"wide",context:"standalone"})}},i:function(t,s,a){const n=t.getDay(),r=n===0?7:n;switch(s){case"i":return String(r);case"ii":return w(r,s.length);case"io":return a.ordinalNumber(r,{unit:"day"});case"iii":return a.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(n,{width:"short",context:"formatting"});case"iiii":default:return a.day(n,{width:"wide",context:"formatting"})}},a:function(t,s,a){const r=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(t,s,a){const n=t.getHours();let r;switch(n===12?r=Z.noon:n===0?r=Z.midnight:r=n/12>=1?"pm":"am",s){case"b":case"bb":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(t,s,a){const n=t.getHours();let r;switch(n>=17?r=Z.evening:n>=12?r=Z.afternoon:n>=4?r=Z.morning:r=Z.night,s){case"B":case"BB":case"BBB":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(t,s,a){if(s==="ho"){let n=t.getHours()%12;return n===0&&(n=12),a.ordinalNumber(n,{unit:"hour"})}return H.h(t,s)},H:function(t,s,a){return s==="Ho"?a.ordinalNumber(t.getHours(),{unit:"hour"}):H.H(t,s)},K:function(t,s,a){const n=t.getHours()%12;return s==="Ko"?a.ordinalNumber(n,{unit:"hour"}):w(n,s.length)},k:function(t,s,a){let n=t.getHours();return n===0&&(n=24),s==="ko"?a.ordinalNumber(n,{unit:"hour"}):w(n,s.length)},m:function(t,s,a){return s==="mo"?a.ordinalNumber(t.getMinutes(),{unit:"minute"}):H.m(t,s)},s:function(t,s,a){return s==="so"?a.ordinalNumber(t.getSeconds(),{unit:"second"}):H.s(t,s)},S:function(t,s){return H.S(t,s)},X:function(t,s,a){const n=t.getTimezoneOffset();if(n===0)return"Z";switch(s){case"X":return qe(n);case"XXXX":case"XX":return G(n);case"XXXXX":case"XXX":default:return G(n,":")}},x:function(t,s,a){const n=t.getTimezoneOffset();switch(s){case"x":return qe(n);case"xxxx":case"xx":return G(n);case"xxxxx":case"xxx":default:return G(n,":")}},O:function(t,s,a){const n=t.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+Fe(n,":");case"OOOO":default:return"GMT"+G(n,":")}},z:function(t,s,a){const n=t.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+Fe(n,":");case"zzzz":default:return"GMT"+G(n,":")}},t:function(t,s,a){const n=Math.trunc(t.getTime()/1e3);return w(n,s.length)},T:function(t,s,a){const n=t.getTime();return w(n,s.length)}};function Fe(t,s=""){const a=t>0?"-":"+",n=Math.abs(t),r=Math.trunc(n/60),i=n%60;return i===0?a+String(r):a+String(r)+s+w(i,2)}function qe(t,s){return t%60===0?(t>0?"-":"+")+w(Math.abs(t)/60,2):G(t,s)}function G(t,s=""){const a=t>0?"-":"+",n=Math.abs(t),r=w(Math.trunc(n/60),2),i=w(n%60,2);return a+r+s+i}const Ae=(t,s)=>{switch(t){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},He=(t,s)=>{switch(t){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},Jt=(t,s)=>{const a=t.match(/(P+)(p+)?/)||[],n=a[1],r=a[2];if(!r)return Ae(t,s);let i;switch(n){case"P":i=s.dateTime({width:"short"});break;case"PP":i=s.dateTime({width:"medium"});break;case"PPP":i=s.dateTime({width:"long"});break;case"PPPP":default:i=s.dateTime({width:"full"});break}return i.replace("{{date}}",Ae(n,s)).replace("{{time}}",He(r,s))},Zt={p:He,P:Jt},es=/^D+$/,ts=/^Y+$/,ss=["D","DD","YY","YYYY"];function as(t){return es.test(t)}function ns(t){return ts.test(t)}function rs(t,s,a){const n=is(t,s,a);if(console.warn(n),ss.includes(t))throw new RangeError(n)}function is(t,s,a){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${s}\`) for formatting ${n} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const cs=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,os=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ls=/^'([^]*?)'?$/,ds=/''/g,us=/[a-zA-Z]/;function ms(t,s,a){var c,d,l,N;const n=ue(),r=n.locale??Je,i=n.firstWeekContainsDate??((d=(c=n.locale)==null?void 0:c.options)==null?void 0:d.firstWeekContainsDate)??1,o=n.weekStartsOn??((N=(l=n.locale)==null?void 0:l.options)==null?void 0:N.weekStartsOn)??0,u=L(t);if(!Ht(u))throw new RangeError("Invalid time value");let h=s.match(os).map(m=>{const x=m[0];if(x==="p"||x==="P"){const p=Zt[x];return p(m,r.formatLong)}return m}).join("").match(cs).map(m=>{if(m==="''")return{isToken:!1,value:"'"};const x=m[0];if(x==="'")return{isToken:!1,value:hs(m)};if(Te[x])return{isToken:!0,value:m};if(x.match(us))throw new RangeError("Format string contains an unescaped latin alphabet character `"+x+"`");return{isToken:!1,value:m}});r.localize.preprocessor&&(h=r.localize.preprocessor(u,h));const g={firstWeekContainsDate:i,weekStartsOn:o,locale:r};return h.map(m=>{if(!m.isToken)return m.value;const x=m.value;(ns(x)||as(x))&&rs(x,s,String(t));const p=Te[x[0]];return p(u,x,r.localize,g)}).join("")}function hs(t){const s=t.match(ls);return s?s[1].replace(ds,"'"):t}const me=()=>{const[t,s]=b.useState(null),[a,n]=b.useState(!0),[r,i]=b.useState(null),o=Ze(),u=et();return b.useEffect(()=>{(async()=>{const g=u.pathname;console.log("useOrganization - Starting detection for path:",g),n(!0),i(null),s(null);let c=null;const d=o.orgSlug||o.slug,l=["admin","auth","login","create-organization","terms-of-service","privacy-policy"];if(d&&l.includes(d)){console.log(`useOrganization - Path matched special route "${d}", skipping org detection.`),n(!1);return}const m=new URL(window.location.href).hostname;if(m!=="localhost"&&!m.includes("lovable.app")&&!m.includes("lovableproject.com")){console.log("useOrganization - Checking domain:",m);try{c=await tt(m),console.log("useOrganization - Domain result:",c)}catch(p){console.warn("useOrganization - Domain check failed:",p)}}if(!c&&m.includes(".")){const p=m.split(".")[0];if(p!=="www"&&p!=="feedback"&&!p.includes("preview--")){console.log("useOrganization - Checking subdomain:",p);try{c=await he(p),console.log("useOrganization - Subdomain result:",c)}catch(f){console.warn("useOrganization - Subdomain check failed:",f)}}}if(!c&&d){console.log("useOrganization - Checking slug from params:",d);try{c=await he(d),console.log("useOrganization - Slug result:",c)}catch(p){console.error("useOrganization - Slug check failed:",p)}}if(!c&&g==="/"){console.log("useOrganization - No org found, defaulting to police-sacco for root path");try{c=await he("police-sacco"),console.log("useOrganization - Default police-sacco result:",c)}catch(p){console.error("useOrganization - Default police-sacco failed:",p)}}s(c);const x=d&&!l.includes(d);!c&&x&&(console.log("useOrganization - No organization found for slug:",d),i("Organization not found")),n(!1),console.log("useOrganization - Detection finished. Final org:",(c==null?void 0:c.name)||"none")})()},[o.slug,o.orgSlug,u.pathname]),{organization:t,isLoading:a,error:r}},xs=async t=>{const{data:s,error:a}=await k.from("api_keys").select("id, key_name, key_prefix, status, last_used_at, expires_at, created_at").eq("organization_id",t).order("created_at",{ascending:!1});if(a)throw a;return s},gs=async(t,s)=>{const{data:a,error:n}=await k.rpc("create_api_key",{p_organization_id:t,p_key_name:s});if(n)throw n;return a},fs=async(t,s)=>{const{data:a,error:n}=await k.from("api_keys").update({status:s}).eq("id",t).select().single();if(n)throw n;return a},ps=({apiKey:t})=>{const[s,a]=b.useState(!1),n=()=>{navigator.clipboard.writeText(t),a(!0),j({title:"API Key Copied!",description:"The key has been copied to your clipboard."}),setTimeout(()=>a(!1),2e3)};return e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-secondary rounded-md",children:[e.jsx("code",{className:"text-sm font-mono break-all",children:t}),e.jsx(y,{variant:"ghost",size:"icon",onClick:n,children:s?e.jsx(Le,{className:"h-4 w-4 text-green-500"}):e.jsx(oe,{className:"h-4 w-4"})})]})},ys=()=>{const{organization:t}=me(),s=re(),[a,n]=b.useState(""),[r,i]=b.useState(null),o=["apiKeys",t==null?void 0:t.id],{data:u,isLoading:h}=se({queryKey:o,queryFn:()=>xs(t.id),enabled:!!t}),g=T({mutationFn:l=>gs(t.id,l),onSuccess:l=>{j({title:"API Key Created",description:"Make sure to copy your key. You won't see it again."}),i(l),n(""),s.invalidateQueries({queryKey:o})},onError:l=>{j({title:"Error",description:l.message,variant:"destructive"})}}),c=T({mutationFn:({keyId:l,status:N})=>fs(l,N),onSuccess:()=>{j({title:"Status Updated"}),s.invalidateQueries({queryKey:o})},onError:l=>{j({title:"Error",description:l.message,variant:"destructive"})}}),d=l=>{l.preventDefault(),a.trim()&&t&&g.mutate(a.trim())};return e.jsxs(E,{className:"w-full",children:[e.jsxs(F,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(At,{})," API Keys"]}),e.jsx(Ie,{children:"Manage API keys for programmatic access to your organization's data."})]}),e.jsxs(D,{children:[e.jsxs("form",{onSubmit:d,className:"flex items-center gap-2 mb-6",children:[e.jsx(I,{placeholder:"New key name (e.g., 'SMS Integration')",value:a,onChange:l=>n(l.target.value),disabled:g.isPending}),e.jsxs(y,{type:"submit",disabled:!a.trim()||g.isPending,children:[g.isPending?e.jsx(Nt,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Dt,{className:"mr-2 h-4 w-4"}),"Create Key"]})]}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(ot,{children:[e.jsx(lt,{children:e.jsxs(ce,{children:[e.jsx(J,{children:"Name"}),e.jsx(J,{children:"Key Prefix"}),e.jsx(J,{children:"Status"}),e.jsx(J,{children:"Last Used"}),e.jsx(J,{children:"Created"}),e.jsx(J,{className:"text-right",children:"Actions"})]})}),e.jsx(dt,{children:h?Array.from({length:3}).map((l,N)=>e.jsx(ce,{children:e.jsx(Q,{colSpan:6,children:e.jsx(st,{className:"h-8 w-full"})})},N)):u&&u.length>0?u.map(l=>e.jsxs(ce,{children:[e.jsx(Q,{className:"font-medium",children:l.key_name}),e.jsx(Q,{children:e.jsxs("code",{children:[l.key_prefix,"..."]})}),e.jsx(Q,{children:e.jsx(ie,{variant:l.status==="active"?"default":"secondary",children:l.status})}),e.jsx(Q,{children:l.last_used_at?`${Ke(new Date(l.last_used_at))} ago`:"Never"}),e.jsx(Q,{children:ms(new Date(l.created_at),"MMM d, yyyy")}),e.jsx(Q,{className:"text-right",children:e.jsxs(ut,{children:[e.jsx(mt,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"icon",disabled:c.isPending,children:l.status==="active"?e.jsx(Kt,{className:"h-4 w-4"}):e.jsx(Lt,{className:"h-4 w-4"})})}),e.jsxs(ht,{children:[e.jsxs(xt,{children:[e.jsx(gt,{children:"Are you sure?"}),e.jsxs(ft,{children:["This will ",l.status==="active"?"deactivate":"activate"," the API key.",l.status==="active"?" Applications using it will lose access.":" Applications will regain access."]})]}),e.jsxs(pt,{children:[e.jsx(yt,{children:"Cancel"}),e.jsx(jt,{onClick:()=>c.mutate({keyId:l.id,status:l.status==="active"?"inactive":"active"}),children:"Continue"})]})]})]})})]},l.id)):e.jsx(ce,{children:e.jsx(Q,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"No API keys created yet."})})})]})}),e.jsx(ge,{open:!!r,onOpenChange:l=>!l&&i(null),children:e.jsxs(fe,{children:[e.jsxs(pe,{children:[e.jsx(ye,{children:"API Key Created Successfully"}),e.jsx(wt,{children:"Please copy this key and store it securely. You will not be able to see it again."})]}),e.jsx(ps,{apiKey:r||""}),e.jsx(bt,{children:e.jsx(vt,{asChild:!0,children:e.jsx(y,{children:"Close"})})})]})})]})]})},js=({organization:t,currentSettings:s,onSettingsUpdate:a})=>{var h,g;const n=re(),[r,i]=b.useState({username:((h=s==null?void 0:s.sms_settings)==null?void 0:h.username)||"",apiKey:((g=s==null?void 0:s.sms_settings)==null?void 0:g.apiKey)||"",senderId:(s==null?void 0:s.sms_sender_id)||""}),o=T({mutationFn:async c=>{const{data:d,error:l}=await k.functions.invoke("update-sms-settings",{body:{orgId:t.id,enabled:!0,senderId:c.senderId,username:c.username,apiKey:c.apiKey}});if(l)throw l;return d},onSuccess:()=>{j({title:"Success",description:"SMS settings updated successfully"}),n.invalidateQueries({queryKey:["organization-sms-settings"]}),a()},onError:c=>{j({title:"Error",description:c.message||"Failed to update SMS settings",variant:"destructive"})}}),u=c=>{if(c.preventDefault(),!r.username.trim()||!r.apiKey.trim()||!r.senderId.trim()){j({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"});return}o.mutate(r)};return e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Provider Settings"]})}),e.jsx(D,{children:e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"username",children:"Username *"}),e.jsx(I,{id:"username",type:"text",value:r.username,onChange:c=>i(d=>({...d,username:c.target.value})),placeholder:"Enter your SMS provider username",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"apiKey",children:"API Key *"}),e.jsx(I,{id:"apiKey",type:"password",value:r.apiKey,onChange:c=>i(d=>({...d,apiKey:c.target.value})),placeholder:"Enter your SMS provider API key",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"senderId",children:"Sender ID *"}),e.jsx(I,{id:"senderId",type:"text",value:r.senderId,onChange:c=>i(d=>({...d,senderId:c.target.value})),placeholder:"Enter your sender ID (e.g., 12345)",required:!0}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"This is your SMS sender identifier that recipients will see"})]}),e.jsxs(y,{type:"submit",disabled:o.isPending,className:"w-full",children:[e.jsx(Ct,{className:"w-4 h-4 mr-2"}),o.isPending?"Saving...":"Save Settings"]})]})})]})},ws=({enabled:t,onToggle:s,isLoading:a})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"SMS Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow customers to provide feedback via SMS"})]}),e.jsx(kt,{checked:t,onCheckedChange:s,disabled:a})]}),bs=({webhookSecret:t,isVisible:s,isFlaskWrapper:a=!1})=>{const[n,r]=b.useState(!1),u=`${window.location.origin}${a?"/functions/v1/handle-flask-sms-callback":"/functions/v1/handle-sms-webhook"}`,h=g=>{navigator.clipboard.writeText(g),j({title:"Copied to clipboard",description:"Webhook URL has been copied to your clipboard"})};return s?e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Rt,{className:"w-5 h-5"}),a?"Flask Webhook Configuration":"SMS Webhook Configuration"]})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{value:u,readOnly:!0,className:"font-mono text-sm"}),e.jsx(y,{onClick:()=>h(u),variant:"outline",size:"icon",children:e.jsx(oe,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a?"Configure your Flask wrapper to send callbacks to this URL":"Configure this URL in your Africa's Talking SMS callback settings"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Webhook Secret"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:n?"text":"password",value:t,readOnly:!0,className:"font-mono text-sm"}),e.jsx(y,{onClick:()=>r(!n),variant:"outline",size:"icon",type:"button",children:n?e.jsx(Ft,{className:"w-4 h-4"}):e.jsx(at,{className:"w-4 h-4"})}),e.jsx(y,{onClick:()=>h(t),variant:"outline",size:"icon",children:e.jsx(oe,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use this secret to verify webhook authenticity"})]}),a&&e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Tt,{className:"w-5 h-5 text-blue-500 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-sm",children:"Flask Integration Notes:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Your Flask wrapper should forward SMS callbacks to the webhook URL above"}),e.jsx("li",{children:"• Include the webhook secret in your callback validation"}),e.jsxs("li",{children:["• Ensure the callback format matches: ","{linkId, text, to, id, date, from}"]}),e.jsx("li",{children:"• The 'to' field should contain your organization's sender ID"})]})]})]})})]})]}):null},vs=({selectedProvider:t,onProviderSelect:s})=>{const a={id:"sms-provider",name:"SMS Provider (Flask Wrapper)",description:"SMS services via Flask wrapper integration",icon:K,status:"available"};return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"SMS Integration"}),e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${t===a.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>s(t===a.id?null:a.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a.icon,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{variant:"default",children:"Available"}),t===a.id&&e.jsx(Le,{className:"w-4 h-4 text-blue-500"})]})]})})]})},de=(t,s)=>{if(!t||typeof t!="object")return"";const a=t[s];return typeof a=="string"?a:""},Ns=t=>{if(!t||typeof t!="object")return!1;const s=de(t,"username"),a=de(t,"apiKey");return s.length>0&&a.length>0},Ss=()=>e.jsxs(F,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Integrations"]}),e.jsx(Ie,{children:"Enable SMS feedback collection from your customers"})]}),Cs=({title:t="SMS Integrations"})=>e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),t]})}),e.jsx(D,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}),ks=({title:t="SMS Integrations",message:s,onRetry:a})=>e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-red-500"}),t]})}),e.jsx(D,{children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("p",{className:"text-sm text-red-600 mb-2",children:"Organization not found or failed to load"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:s}),a&&e.jsx("button",{onClick:a,className:"text-sm text-blue-600 hover:underline",children:"Try again"})]})})]}),Ms=()=>e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Integrations"]})}),e.jsx(D,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"You need admin access to manage SMS integrations."})})]}),Os=({phoneNumber:t,name:s,onPhoneNumberChange:a,onNameChange:n,onSubmit:r,isLoading:i})=>e.jsx("form",{onSubmit:r,className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"phone-number",children:"Phone Number *"}),e.jsx(I,{id:"phone-number",value:t,onChange:o=>a(o.target.value),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"name",children:"Name (Optional)"}),e.jsx(I,{id:"name",value:s,onChange:o=>n(o.target.value),placeholder:"John Doe"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(y,{type:"submit",disabled:i,className:"w-full",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Add Number"]})})]})}),Ps=({bulkNumbers:t,onBulkNumbersChange:s,onBulkAdd:a,onCancel:n,isLoading:r})=>e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"bulk-numbers",children:"Bulk Add Phone Numbers"}),e.jsx(je,{id:"bulk-numbers",value:t,onChange:i=>s(i.target.value),placeholder:"Enter phone numbers, one per line. Format: +1234567890 or +1234567890,John Doe",rows:6}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Format: One phone number per line. Optionally add name after comma."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:a,disabled:r,children:"Add All Numbers"}),e.jsx(y,{variant:"outline",onClick:n,children:"Cancel"})]})]}),_s=({phoneNumbers:t,onDelete:s,isDeleting:a})=>{const n=r=>r.startsWith("+")?r:`+${r}`;return t.length===0?e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No phone numbers added yet."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers to start sending SMS campaigns."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Registered Phone Numbers"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:n(r.phone_number)}),r.name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ie,{variant:r.status==="active"?"default":"secondary",children:r.status}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Added ",new Date(r.created_at).toLocaleDateString()]})]})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>s(r.id),disabled:a,children:e.jsx(ze,{className:"w-4 h-4"})})]},r.id))})]})},Es=()=>{const{organization:t}=me(),s=re(),[a,n]=b.useState(""),[r,i]=b.useState(""),[o,u]=b.useState(""),[h,g]=b.useState(!1),{data:c,isLoading:d}=se({queryKey:["sms-phone-numbers",t==null?void 0:t.id],queryFn:async()=>{const{data:f,error:v}=await k.from("sms_phone_numbers").select("*").eq("organization_id",t.id).order("created_at",{ascending:!1});if(v)throw v;return f},enabled:!!(t!=null&&t.id)}),l=T({mutationFn:async({phoneNumber:f,name:v})=>{const{data:C,error:P}=await k.from("sms_phone_numbers").insert({organization_id:t.id,phone_number:f.trim(),name:(v==null?void 0:v.trim())||null}).select().single();if(P)throw P;return C},onSuccess:()=>{j({title:"Phone number added successfully"}),n(""),i(""),s.invalidateQueries({queryKey:["sms-phone-numbers",t==null?void 0:t.id]})},onError:f=>{j({title:"Error adding phone number",description:f.message,variant:"destructive"})}}),N=T({mutationFn:async f=>{const{data:v,error:C}=await k.from("sms_phone_numbers").insert(f.map(({phoneNumber:P,name:O})=>({organization_id:t.id,phone_number:P.trim(),name:(O==null?void 0:O.trim())||null})));if(C)throw C;return v},onSuccess:()=>{j({title:"Phone numbers added successfully"}),u(""),g(!1),s.invalidateQueries({queryKey:["sms-phone-numbers",t==null?void 0:t.id]})},onError:f=>{j({title:"Error adding phone numbers",description:f.message,variant:"destructive"})}}),m=T({mutationFn:async f=>{const{error:v}=await k.from("sms_phone_numbers").delete().eq("id",f);if(v)throw v},onSuccess:()=>{j({title:"Phone number removed successfully"}),s.invalidateQueries({queryKey:["sms-phone-numbers",t==null?void 0:t.id]})},onError:f=>{j({title:"Error removing phone number",description:f.message,variant:"destructive"})}}),x=f=>{f.preventDefault(),a.trim()&&l.mutate({phoneNumber:a,name:r})},p=()=>{const v=o.split(`
`).filter(C=>C.trim()).map(C=>{const P=C.split(",").map(O=>O.trim());return{phoneNumber:P[0],name:P[1]||void 0}}).filter(C=>C.phoneNumber);if(v.length===0){j({title:"No valid phone numbers found",description:"Please enter at least one phone number",variant:"destructive"});return}N.mutate(v)};return d?e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Phone Numbers"]})}),e.jsx(D,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]}):e.jsxs(E,{children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"Phone Numbers (",(c==null?void 0:c.length)||0,")"]})}),e.jsxs(D,{className:"space-y-6",children:[e.jsx(Os,{phoneNumber:a,name:r,onPhoneNumberChange:n,onNameChange:i,onSubmit:x,isLoading:l.isPending}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(y,{variant:"outline",onClick:()=>g(!h),children:[e.jsx(Wt,{className:"w-4 h-4 mr-2"}),"Bulk Add"]})}),h&&e.jsx(Ps,{bulkNumbers:o,onBulkNumbersChange:u,onBulkAdd:p,onCancel:()=>g(!1),isLoading:N.isPending}),e.jsx(_s,{phoneNumbers:c||[],onDelete:f=>m.mutate(f),isDeleting:m.isPending})]})]})},Ds=()=>{const{user:t}=We(),{organization:s}=me(),a=re(),{data:n=[],isLoading:r,error:i}=se({queryKey:["sms-campaigns",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return[];const{data:m,error:x}=await k.from("sms_campaigns").select("*").eq("organization_id",s.id).order("created_at",{ascending:!1});if(x)throw x;return m||[]},enabled:!!(s!=null&&s.id)}),{data:o=[],isLoading:u,error:h}=se({queryKey:["sms-phone-numbers",s==null?void 0:s.id],queryFn:async()=>{if(!(s!=null&&s.id))return[];const{data:m,error:x}=await k.from("sms_phone_numbers").select("*").eq("organization_id",s.id).eq("status","active").order("created_at",{ascending:!1});if(x)throw x;return m||[]},enabled:!!(s!=null&&s.id)}),g=T({mutationFn:async({name:m,template:x})=>{if(!(s!=null&&s.id)||!(t!=null&&t.id))throw new Error("Missing organization or user");const{data:p,error:f}=await k.from("sms_campaigns").insert({organization_id:s.id,name:m,message_template:x,created_by_user_id:t.id,status:"draft"}).select().single();if(f)throw f;return p},onSuccess:()=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),j({title:"Success",description:"Campaign created successfully"})},onError:m=>{console.error("Error creating campaign:",m),j({title:"Error",description:"Failed to create campaign",variant:"destructive"})}}),c=T({mutationFn:async({campaignId:m,name:x,template:p})=>{const{data:f,error:v}=await k.from("sms_campaigns").update({name:x,message_template:p,updated_at:new Date().toISOString()}).eq("id",m).select().single();if(v)throw v;return f},onSuccess:()=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),j({title:"Success",description:"Campaign updated successfully"})},onError:m=>{console.error("Error updating campaign:",m),j({title:"Error",description:"Failed to update campaign",variant:"destructive"})}}),d=T({mutationFn:async m=>{const{error:x}=await k.from("sms_campaigns").delete().eq("id",m);if(x)throw x},onSuccess:()=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),j({title:"Success",description:"Campaign deleted successfully"})},onError:m=>{console.error("Error deleting campaign:",m),j({title:"Error",description:"Failed to delete campaign",variant:"destructive"})}}),l=T({mutationFn:async({campaignId:m,isResend:x=!1,isRetry:p=!1})=>{const{data:f,error:v}=await k.functions.invoke("send-sms-flask",{body:{campaignId:m,isResend:x,isRetry:p}});if(v)throw v;return f},onSuccess:m=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),a.invalidateQueries({queryKey:["sms-sends"]}),j({title:"Success",description:`Campaign sent successfully! ${m.sentCount}/${m.sentCount+m.failedCount} messages delivered.`})},onError:m=>{console.error("Error sending campaign:",m),j({title:"Error",description:"Failed to send campaign",variant:"destructive"})}}),N=T({mutationFn:async({campaignId:m,action:x})=>{let p;switch(x){case"pause":p="paused";break;case"resume":p="sending";break;case"cancel":p="cancelled";break;default:throw new Error("Invalid action")}const{error:f}=await k.from("sms_campaigns").update({status:p}).eq("id",m);if(f)throw f},onSuccess:(m,{action:x})=>{a.invalidateQueries({queryKey:["sms-campaigns"]}),j({title:"Success",description:`Campaign ${x}d successfully`})},onError:m=>{console.error("Error controlling campaign:",m),j({title:"Error",description:"Failed to update campaign status",variant:"destructive"})}});return{campaigns:n,campaignsLoading:r,campaignsError:i,phoneNumbers:o,phoneNumbersLoading:u,phoneNumbersError:h,createCampaignMutation:g,updateCampaignMutation:c,deleteCampaignMutation:d,sendCampaignMutation:l,campaignControlMutation:N,organization:s}},Ts=({onSubmit:t,onCancel:s,isLoading:a,phoneNumbersCount:n,organizationName:r})=>{const[i,o]=b.useState(""),[u,h]=b.useState(""),g=`Hi! We'd love your feedback on our service. Please text back 'START' to begin a quick survey. Your input helps us improve. Thank you! - ${r||"Your Company"}`,c=d=>{d.preventDefault(),!(!i.trim()||!u.trim())&&(t(i,u),o(""),h(""))};return e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsx("h4",{className:"font-medium",children:"Create New Campaign"}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"campaign-name",children:"Campaign Name *"}),e.jsx(I,{id:"campaign-name",value:i,onChange:d=>o(d.target.value),placeholder:"Feedback Request Campaign",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"message-template",children:"Message Template *"}),e.jsx(je,{id:"message-template",value:u,onChange:d=>h(d.target.value),placeholder:g,rows:4,required:!0}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Recipients: ",n," active phone numbers"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{type:"submit",disabled:a,children:"Create Campaign"}),e.jsx(y,{type:"button",variant:"outline",onClick:s,children:"Cancel"})]})]})]})},Fs=({campaign:t,onSend:s,onResend:a,onRetry:n,onCancel:r,onPause:i,onResume:o,onDuplicate:u,onSchedule:h,onEdit:g,onDelete:c,isLoading:d})=>{const[l,N]=b.useState(!1),m=W=>{switch(W){case"draft":return"bg-gray-100 text-gray-800";case"sending":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"paused":return"bg-yellow-100 text-yellow-800";case"cancelled":return"bg-gray-100 text-gray-600";default:return"bg-gray-100 text-gray-800"}},x=W=>{switch(W){case"completed":return e.jsx(ve,{className:"w-4 h-4"});case"failed":return e.jsx(Pe,{className:"w-4 h-4"});case"sending":return e.jsx(nt,{className:"w-4 h-4"});default:return null}},p=t.status==="draft",f=t.status==="completed",v=t.status==="failed",C=t.status==="sending",P=t.status==="paused",O=t.status==="sending"||t.status==="paused",ee=t.status==="draft"||t.status==="failed",V=t.status==="draft"||t.status==="cancelled"||t.status==="failed";return e.jsx(E,{className:"w-full hover:shadow-md transition-shadow",children:e.jsxs(D,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.name}),e.jsxs(ie,{className:`${m(t.status)} flex items-center gap-1`,children:[x(t.status),t.status.charAt(0).toUpperCase()+t.status.slice(1)]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-3",children:["Created ",Ke(new Date(t.created_at),{addSuffix:!0})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.total_recipients||0," recipients"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.sent_count||0," sent"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:[t.delivered_count||0," delivered"]})]}),t.failed_count>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-4 h-4 text-red-600"}),e.jsxs("span",{children:[t.failed_count," failed"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[ee&&e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>g(t),disabled:d,children:[e.jsx(It,{className:"w-4 h-4 mr-1"}),"Edit"]}),p&&e.jsxs(y,{onClick:()=>s(t.id),disabled:d,size:"sm",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),"Send"]}),f&&e.jsxs(y,{variant:"outline",onClick:()=>a(t.id),disabled:d,size:"sm",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"Resend"]}),v&&e.jsxs(y,{variant:"outline",onClick:()=>n(t.id),disabled:d,size:"sm",children:[e.jsx(Ee,{className:"w-4 h-4 mr-1"}),"Retry"]}),C&&e.jsxs(y,{variant:"outline",onClick:()=>i(t.id),disabled:d,size:"sm",children:[e.jsx(Yt,{className:"w-4 h-4 mr-1"}),"Pause"]}),P&&e.jsxs(y,{variant:"outline",onClick:()=>o(t.id),disabled:d,size:"sm",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),"Resume"]}),O&&e.jsx(y,{variant:"outline",onClick:()=>r(t.id),disabled:d,size:"sm",children:"Cancel"}),e.jsxs(y,{variant:"outline",onClick:()=>u(t.id),disabled:d,size:"sm",children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Duplicate"]}),e.jsxs(y,{variant:"outline",onClick:()=>h(t.id),disabled:d,size:"sm",children:[e.jsx(Pt,{className:"w-4 h-4 mr-1"}),"Schedule"]}),V&&e.jsxs(y,{variant:"outline",onClick:()=>c(t),disabled:d,size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(ze,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("button",{onClick:()=>N(!l),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:[l?"Hide":"Show"," message preview"]}),l&&e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border",children:e.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:t.message_template})})]}),(t.started_at||t.completed_at)&&e.jsxs("div",{className:"mt-4 text-xs text-gray-500 space-y-1",children:[t.started_at&&e.jsxs("div",{children:["Started: ",new Date(t.started_at).toLocaleString()]}),t.completed_at&&e.jsxs("div",{children:["Completed: ",new Date(t.completed_at).toLocaleString()]})]})]})})},qs=({searchTerm:t,onSearchChange:s,statusFilter:a,onStatusFilterChange:n,sortBy:r,onSortByChange:i,sortOrder:o,onSortOrderChange:u,totalCampaigns:h,filteredCount:g})=>{const c=()=>{s(""),n("all"),i("created_at"),u("desc")},d=t||a!=="all";return e.jsxs("div",{className:"w-full space-y-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Filters"}),d&&e.jsxs(ie,{variant:"secondary",className:"text-xs",children:[g," of ",h]})]}),d&&e.jsx(y,{variant:"ghost",size:"sm",onClick:c,children:"Clear All"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(rt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(I,{placeholder:"Search campaigns...",value:t,onChange:l=>s(l.target.value),className:"pl-10 w-full"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(Ce,{value:a,onValueChange:n,children:[e.jsx(ke,{className:"w-full sm:w-[150px]",children:e.jsx(Me,{placeholder:"Status"})}),e.jsxs(Oe,{children:[e.jsx(B,{value:"all",children:"All Status"}),e.jsx(B,{value:"draft",children:"Draft"}),e.jsx(B,{value:"sending",children:"Sending"}),e.jsx(B,{value:"completed",children:"Completed"}),e.jsx(B,{value:"failed",children:"Failed"})]})]}),e.jsxs(Ce,{value:r,onValueChange:i,children:[e.jsx(ke,{className:"w-full sm:w-[150px]",children:e.jsx(Me,{placeholder:"Sort by"})}),e.jsxs(Oe,{children:[e.jsx(B,{value:"created_at",children:"Created Date"}),e.jsx(B,{value:"name",children:"Name"}),e.jsx(B,{value:"total_recipients",children:"Recipients"}),e.jsx(B,{value:"delivered_count",children:"Delivery Rate"})]})]}),e.jsx(y,{variant:"outline",size:"sm",onClick:()=>u(o==="asc"?"desc":"asc"),className:"w-full sm:w-auto",children:o==="asc"?e.jsx(Et,{className:"w-4 h-4"}):e.jsx(_t,{className:"w-4 h-4"})})]})]})]})},As=({campaign:t,isOpen:s,onClose:a,onSave:n,isLoading:r})=>{const[i,o]=b.useState(""),[u,h]=b.useState("");b.useEffect(()=>{t&&(o(t.name),h(t.message_template))},[t]);const g=()=>{t&&i.trim()&&u.trim()&&n(t.id,i.trim(),u.trim())},c=()=>{o(""),h(""),a()};return t?e.jsx(ge,{open:s,onOpenChange:c,children:e.jsxs(fe,{className:"max-w-md",children:[e.jsx(pe,{children:e.jsx(ye,{children:"Edit Campaign"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"campaign-name",children:"Campaign Name"}),e.jsx(I,{id:"campaign-name",value:i,onChange:d=>o(d.target.value),placeholder:"Enter campaign name",disabled:r})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"message-template",children:"Message Template"}),e.jsx(je,{id:"message-template",value:u,onChange:d=>h(d.target.value),placeholder:"Enter your message template",rows:4,disabled:r})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",onClick:c,disabled:r,children:"Cancel"}),e.jsx(y,{onClick:g,disabled:r||!i.trim()||!u.trim(),children:r?"Saving...":"Save Changes"})]})]})]})}):null},Ys=({campaign:t,isOpen:s,onClose:a,onDelete:n,isLoading:r})=>{const i=()=>{t&&n(t.id)};if(!t)return null;const o=t.status==="draft"||t.status==="cancelled"||t.status==="failed";return e.jsx(ge,{open:s,onOpenChange:a,children:e.jsxs(fe,{className:"max-w-md",children:[e.jsx(pe,{children:e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(it,{className:"w-5 h-5 text-red-600"}),"Delete Campaign"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:['Are you sure you want to delete the campaign "',t.name,'"?']}),!o&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"This campaign cannot be deleted because it has been sent or is currently active. Only draft, cancelled, or failed campaigns can be deleted."})}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(y,{variant:"outline",onClick:a,disabled:r,children:"Cancel"}),e.jsx(y,{variant:"destructive",onClick:i,disabled:r||!o,children:r?"Deleting...":"Delete Campaign"})]})]})]})})},Is=({campaigns:t,onSend:s,onResend:a,onRetry:n,onCancel:r,onPause:i,onResume:o,onDuplicate:u,onSchedule:h,onEdit:g,onDelete:c,onCreateNew:d,isLoading:l,isEditLoading:N=!1,isDeleteLoading:m=!1})=>{const[x,p]=b.useState(""),[f,v]=b.useState("all"),[C,P]=b.useState("created_at"),[O,ee]=b.useState("desc"),[V,W]=b.useState(null),[S,Y]=b.useState(null),R=b.useMemo(()=>{let _=t.filter(U=>{const te=U.name.toLowerCase().includes(x.toLowerCase())||U.message_template.toLowerCase().includes(x.toLowerCase()),z=f==="all"||U.status===f;return te&&z});return _.sort((U,te)=>{let z=U[C],$=te[C];if(C==="created_at"&&(z=new Date(z).getTime(),$=new Date($).getTime()),typeof z=="number"&&typeof $=="number")return O==="asc"?z-$:$-z;if(typeof z=="string"&&typeof $=="string"){const we=z.localeCompare($);return O==="asc"?we:-we}return 0}),_},[t,x,f,C,O]),Ue=_=>{W(_)},$e=(_,U,te)=>{g(_,U,te),W(null)},Ge=_=>{Y(_)},Xe=_=>{c(_),Y(null)};return t.length===0?e.jsxs("div",{className:"w-full text-center p-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200",children:[e.jsx(K,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No campaigns yet"}),e.jsx("p",{className:"text-gray-500 mb-6 max-w-md mx-auto",children:"Create your first SMS campaign to start reaching your audience with targeted messages."}),e.jsxs(y,{onClick:d,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Create Your First Campaign"]})]}):e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Campaign Management"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.length," campaign",t.length!==1?"s":""," total",R.length!==t.length&&` • ${R.length} shown`]})]}),e.jsxs(y,{onClick:d,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"New Campaign"]})]}),e.jsx(qs,{searchTerm:x,onSearchChange:p,statusFilter:f,onStatusFilterChange:v,sortBy:C,onSortByChange:P,sortOrder:O,onSortOrderChange:ee,totalCampaigns:t.length,filteredCount:R.length}),e.jsx("div",{className:"w-full space-y-4",children:R.length===0?e.jsxs("div",{className:"text-center p-8 bg-gray-50 rounded-lg",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No campaigns match your current filters."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Try adjusting your search or filter criteria."})]}):R.map(_=>e.jsx(Fs,{campaign:_,onSend:s,onResend:a,onRetry:n,onCancel:r,onPause:i,onResume:o,onDuplicate:u,onSchedule:h,onEdit:Ue,onDelete:Ge,isLoading:l},_.id))}),e.jsx(As,{campaign:V,isOpen:!!V,onClose:()=>W(null),onSave:$e,isLoading:N}),e.jsx(Ys,{campaign:S,isOpen:!!S,onClose:()=>Y(null),onDelete:Xe,isLoading:m})]})},Ks=()=>e.jsxs("div",{className:"text-center p-8 text-muted-foreground",children:[e.jsx(ae,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No active phone numbers found."}),e.jsx("p",{className:"text-sm",children:"Add phone numbers before creating campaigns."})]}),Ls=()=>{const[t,s]=b.useState(!1),{campaigns:a,campaignsLoading:n,campaignsError:r,phoneNumbers:i,phoneNumbersLoading:o,phoneNumbersError:u,createCampaignMutation:h,updateCampaignMutation:g,deleteCampaignMutation:c,sendCampaignMutation:d,campaignControlMutation:l,organization:N}=Ds(),m=(S,Y)=>{h.mutate({name:S,template:Y},{onSuccess:()=>{s(!1)}})},x=(S,Y,R)=>{g.mutate({campaignId:S,name:Y,template:R})},p=S=>{c.mutate(S)},f=S=>{d.mutate({campaignId:S})},v=S=>{d.mutate({campaignId:S,isResend:!0})},C=S=>{d.mutate({campaignId:S,isRetry:!0})},P=S=>{l.mutate({campaignId:S,action:"cancel"})},O=S=>{l.mutate({campaignId:S,action:"pause"})},ee=S=>{l.mutate({campaignId:S,action:"resume"})},V=S=>{const Y=a.find(R=>R.id===S);Y&&(h.mutate({name:`${Y.name} (Copy)`,template:Y.message_template}),j({title:"Campaign duplicated successfully"}))},W=S=>{j({title:"Scheduling feature coming soon",description:"Campaign scheduling will be available in the next update."})};return n||o?e.jsx("div",{className:"w-full",children:e.jsxs(E,{className:"w-full",children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(D,{children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})})]})}):r||u?e.jsx("div",{className:"w-full",children:e.jsxs(E,{className:"w-full",children:[e.jsx(F,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Campaigns"]})}),e.jsx(D,{children:e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 rounded-lg",children:[e.jsx(Re,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:"Failed to load campaigns or phone numbers"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:(r==null?void 0:r.message)||(u==null?void 0:u.message)||"An unexpected error occurred"})]})]})})]})}):e.jsx("div",{className:"w-full",children:e.jsxs(E,{className:"w-full",children:[e.jsx(F,{children:e.jsx(q,{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"SMS Campaigns"]})})}),e.jsx(D,{className:"space-y-6 p-6",children:i.length===0?e.jsx(Ks,{}):e.jsxs("div",{className:"w-full space-y-6",children:[t&&e.jsx("div",{className:"w-full",children:e.jsx(Ts,{onSubmit:m,onCancel:()=>s(!1),isLoading:h.isPending,phoneNumbersCount:i.length,organizationName:N==null?void 0:N.name})}),e.jsx("div",{className:"w-full",children:e.jsx(Is,{campaigns:a,onSend:f,onResend:v,onRetry:C,onCancel:P,onPause:O,onResume:ee,onDuplicate:V,onSchedule:W,onEdit:x,onDelete:p,onCreateNew:()=>s(!0),isLoading:d.isPending||l.isPending,isEditLoading:g.isPending,isDeleteLoading:c.isPending})})]})})]})})},Ws=()=>e.jsx("div",{className:"w-full mt-6",children:e.jsxs(Mt,{defaultValue:"phone-numbers",className:"w-full",children:[e.jsxs(Ot,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsx(Ne,{value:"phone-numbers",className:"flex-1",children:"Phone Numbers"}),e.jsx(Ne,{value:"campaigns",className:"flex-1",children:"Campaigns"})]}),e.jsx(Se,{value:"phone-numbers",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Es,{})})}),e.jsx(Se,{value:"campaigns",className:"w-full mt-0",children:e.jsx("div",{className:"w-full",children:e.jsx(Ls,{})})})]})}),Rs=()=>{const{organization:t}=me(),s=re(),{data:a,isLoading:n,error:r}=se({queryKey:["organization-sms-settings",t==null?void 0:t.id],queryFn:async()=>{console.log("Fetching SMS settings for organization:",t==null?void 0:t.id);const{data:o,error:u}=await k.from("organizations").select("sms_enabled, sms_sender_id, sms_settings, webhook_secret").eq("id",t.id).single();if(u)throw console.error("Error fetching organization SMS settings:",u),u;return console.log("Organization SMS settings fetched:",o),o},enabled:!!(t!=null&&t.id),retry:3,retryDelay:1e3}),i=T({mutationFn:async o=>{if(!(t!=null&&t.id))throw new Error("Organization not found");console.log("Updating SMS status:",{enabled:o,orgId:t.id});const{data:u,error:h}=await k.functions.invoke("update-sms-settings",{body:{orgId:t.id,enabled:o,senderId:(a==null?void 0:a.sms_sender_id)||"",username:de(a==null?void 0:a.sms_settings,"username"),apiKey:de(a==null?void 0:a.sms_settings,"apiKey")}});if(h)throw console.error("SMS status update error:",h),new Error(h.message||"Failed to update SMS settings");return console.log("SMS status updated successfully:",u),u},onSuccess:()=>{j({title:"SMS status updated successfully"}),s.invalidateQueries({queryKey:["organization-sms-settings",t==null?void 0:t.id]})},onError:o=>{console.error("SMS toggle error:",o),j({title:"Error updating SMS status",description:o.message||"An unexpected error occurred",variant:"destructive"})}});return{orgData:a,isLoading:n,error:r,updateSmsStatus:i,organization:t}},zs=()=>{const{isAdmin:t,isOrgAdmin:s}=We(),[a,n]=b.useState(null),{orgData:r,isLoading:i,error:o,updateSmsStatus:u,organization:h}=Rs(),g=t||s,c=l=>{if(!g){j({title:"Access denied",description:"You need admin access to manage SMS settings",variant:"destructive"});return}if(!(h!=null&&h.id)){j({title:"Error",description:"Organization not found",variant:"destructive"});return}u.mutate(l)};if(!g)return e.jsx(Ms,{});if(i)return e.jsx(Cs,{});if(o){const l=typeof o=="string"?o:"Failed to load SMS settings";return e.jsx(ks,{message:l})}const d=(r==null?void 0:r.sms_enabled)&&Ns(r==null?void 0:r.sms_settings);return e.jsx("div",{className:"w-full",children:e.jsxs(E,{className:"w-full",children:[e.jsx(Ss,{}),e.jsxs(D,{className:"space-y-6 p-6",children:[e.jsx(ws,{enabled:(r==null?void 0:r.sms_enabled)||!1,onToggle:c,isLoading:u.isPending}),(r==null?void 0:r.sms_enabled)&&e.jsx(bs,{webhookSecret:(r==null?void 0:r.webhook_secret)||"",isVisible:!0,isFlaskWrapper:!0}),e.jsx(vs,{selectedProvider:a,onProviderSelect:n}),a==="sms-provider"&&e.jsx(js,{organization:h,currentSettings:r,onSettingsUpdate:()=>{}}),d&&e.jsx("div",{className:"w-full",children:e.jsx(Ws,{})})]})]})})},sa=()=>{const{organization:t}=ct();return t?e.jsx(St,{permission:"manage_integrations",organizationId:t.id,showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need admin-level access or higher to manage integrations."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsxs("div",{className:"w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Integrations"}),e.jsx("p",{className:"text-muted-foreground",children:"Connect your organization to other services and automate your workflows."})]}),e.jsx("div",{className:"w-full",children:e.jsx(zs,{})}),e.jsx("div",{className:"w-full",children:e.jsx(ys,{})})]})}):e.jsx("div",{className:"text-center p-8",children:e.jsx("p",{className:"text-gray-500",children:"Organization not found"})})};export{sa as IntegrationsTab,sa as default};
