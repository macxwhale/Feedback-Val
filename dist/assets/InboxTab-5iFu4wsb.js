import{c as T,s as _,r as b,a as R,j as e,C as E,b as q,d as A,B as F,e as I,f as P,I as V,S as D,g as B,h as H,i as M,k as N,A as z,l as Q,T as L,m as O,n as k,o as u,p as Y,q as j,t as g,E as G,P as J}from"./index-BuHaVz0Z.js";import{S as p}from"./skeleton-zlzKdQ8C.js";import{S as K}from"./search-CcQCx7dG.js";import{F as U,f as W}from"./formatDistanceToNow-D3uDvUoY.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=T("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]),X=async(a,t=1,n=20)=>{const l=(t-1)*n,f=l+n-1,{data:x,error:c,count:i}=await _.from("feedback_responses").select(`
      id,
      created_at,
      response_value,
      question_snapshot
    `,{count:"exact"}).eq("organization_id",a).order("created_at",{ascending:!1}).range(l,f);if(c)throw console.error("Error fetching feedback responses:",c),c;return{data:x,count:i}},Z=({organizationId:a})=>{const[t,n]=b.useState(1),[l,f]=b.useState(""),[x,c]=b.useState("all"),i=15,{data:r,isLoading:o,isError:v,error:w}=R({queryKey:["feedbackResponses",a,t,i,l,x],queryFn:()=>X(a,t,i),placeholderData:s=>s}),d=r==null?void 0:r.data,y=(r==null?void 0:r.count)??0,m=Math.ceil(y/i),C=s=>{console.log("View response:",s)};return e.jsxs(E,{className:"w-full",children:[e.jsxs(q,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"w-6 h-6"}),e.jsx(A,{children:"Feedback Inbox"})]}),e.jsxs(F,{variant:"outline",className:"text-sm",children:[y," Total Responses"]})]}),e.jsx(I,{children:"View and manage individual feedback submissions from your organization."})]}),e.jsxs(P,{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(V,{placeholder:"Search feedback responses...",value:l,onChange:s=>f(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(D,{value:x,onValueChange:c,children:[e.jsxs(B,{className:"w-40",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),e.jsx(H,{})]}),e.jsxs(M,{children:[e.jsx(N,{value:"all",children:"All Responses"}),e.jsx(N,{value:"recent",children:"Recent"}),e.jsx(N,{value:"older",children:"Older"})]})]})})]}),o&&e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((s,h)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx(p,{className:"h-5 w-3/4"}),e.jsx(p,{className:"h-4 w-20"})]}),e.jsx(p,{className:"h-4 w-1/2 mb-2"}),e.jsx(p,{className:"h-8 w-20"})]},h))}),v&&e.jsx(z,{variant:"destructive",children:e.jsxs(Q,{children:["Error loading feedback: ",w instanceof Error?w.message:"An unknown error occurred"]})}),!o&&!v&&d&&d.length>0&&e.jsx("div",{className:"border rounded-lg",children:e.jsxs(L,{children:[e.jsx(O,{children:e.jsxs(k,{children:[e.jsx(u,{children:"Question"}),e.jsx(u,{children:"Response"}),e.jsx(u,{children:"Submitted"}),e.jsx(u,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Y,{children:d.map(s=>{var h;return e.jsxs(k,{className:"hover:bg-muted/50",children:[e.jsx(j,{className:"font-medium",children:e.jsx("div",{className:"max-w-xs truncate",children:((h=s.question_snapshot)==null?void 0:h.question_text)||"Question not available"})}),e.jsx(j,{children:e.jsx("div",{className:"max-w-xs truncate text-muted-foreground",children:JSON.stringify(s.response_value)})}),e.jsx(j,{className:"text-sm text-muted-foreground",children:W(new Date(s.created_at),{addSuffix:!0})}),e.jsx(j,{children:e.jsxs(g,{variant:"ghost",size:"sm",onClick:()=>C(s.id),className:"h-8 w-8 p-0",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"View response"})]})})]},s.id)})})]})}),!o&&(!d||d.length===0)&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"text-lg font-semibold text-muted-foreground mb-2",children:"Your inbox is empty"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"New feedback responses will appear here when customers submit feedback."})]}),m>1&&e.jsxs("div",{className:"flex justify-center items-center space-x-4 pt-4",children:[e.jsx(g,{variant:"outline",onClick:()=>n(s=>Math.max(1,s-1)),disabled:t===1||o,children:"Previous"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",t," of ",m]})}),e.jsx(g,{variant:"outline",onClick:()=>n(s=>Math.min(m,s+1)),disabled:t===m||o,children:"Next"})]})]})]})},te=({organizationId:a})=>e.jsx(J,{permission:"view_analytics",organizationId:a,showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need viewer-level access or higher to view feedback responses."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsx(Z,{organizationId:a})});export{te as InboxTab,te as default};
