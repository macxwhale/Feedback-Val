import{o as v,K as te,r as me,u as ye,j as a,C as D,d as k,p as C,g as N,s as Y}from"./index-wA7prndG.js";import{i as ve,D as xe,f as ge,L as X,a as V,C as be,A as je,b as $,c as Ae,d as H,h as Pe,e as Se,G as Oe,g as ce,j as re,u as _e,E as we,k as De,X as Q,Y as J,l as ke,R as ne,B as Ce,m as ae,T as ie,n as Ne}from"./BarChart-DFw5BT6f.js";import{P as Ee}from"./PermissionGuard-BfW1WyJA.js";var Le=["type","layout","connectNulls","ref"],Te=["key"];function L(e){"@babel/helpers - typeof";return L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(e)}function se(e,t){if(e==null)return{};var n=Re(e,t),r,i;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)r=l[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Re(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function z(){return z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},z.apply(this,arguments)}function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?oe(Object(n),!0).forEach(function(r){j(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function E(e){return Ke(e)||Ie(e)||Fe(e)||Be()}function Be(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fe(e,t){if(e){if(typeof e=="string")return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Z(e,t)}}function Ie(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ke(e){if(Array.isArray(e))return Z(e)}function Z(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function We(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,de(r.key),r)}}function $e(e,t,n){return t&&le(e.prototype,t),n&&le(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ze(e,t,n){return t=G(t),Me(e,ue()?Reflect.construct(t,n||[],G(e).constructor):t.apply(e,n))}function Me(e,t){if(t&&(L(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qe(e)}function qe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ue(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ue=function(){return!!e})()}function G(e){return G=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},G(e)}function Ve(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ee(e,t)}function ee(e,t){return ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,i){return r.__proto__=i,r},ee(e,t)}function j(e,t,n){return t=de(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function de(e){var t=Ge(e,"string");return L(t)=="symbol"?t:t+""}function Ge(e,t){if(L(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(L(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var T=function(e){function t(){var n;We(this,t);for(var r=arguments.length,i=new Array(r),l=0;l<r;l++)i[l]=arguments[l];return n=ze(this,t,[].concat(i)),j(n,"state",{isAnimationFinished:!0,totalLength:0}),j(n,"generateSimpleStrokeDasharray",function(s,c){return"".concat(c,"px ").concat(s-c,"px")}),j(n,"getStrokeDasharray",function(s,c,o){var u=o.reduce(function(A,S){return A+S});if(!u)return n.generateSimpleStrokeDasharray(c,s);for(var d=Math.floor(s/u),h=s%u,f=c-s,m=[],p=0,y=0;p<o.length;y+=o[p],++p)if(y+o[p]>h){m=[].concat(E(o.slice(0,p)),[h-y]);break}var b=m.length%2===0?[0,f]:[f];return[].concat(E(t.repeat(o,d)),E(m),b).map(function(A){return"".concat(A,"px")}).join(", ")}),j(n,"id",_e("recharts-line-")),j(n,"pathRef",function(s){n.mainCurve=s}),j(n,"handleAnimationEnd",function(){n.setState({isAnimationFinished:!0}),n.props.onAnimationEnd&&n.props.onAnimationEnd()}),j(n,"handleAnimationStart",function(){n.setState({isAnimationFinished:!1}),n.props.onAnimationStart&&n.props.onAnimationStart()}),n}return Ve(t,e),$e(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var r=this.getTotalLength();this.setState({totalLength:r})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var r=this.getTotalLength();r!==this.state.totalLength&&this.setState({totalLength:r})}}},{key:"getTotalLength",value:function(){var r=this.mainCurve;try{return r&&r.getTotalLength&&r.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(r,i){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var l=this.props,s=l.points,c=l.xAxis,o=l.yAxis,u=l.layout,d=l.children,h=ge(d,we);if(!h)return null;var f=function(y,b){return{x:y.x,y:y.y,value:y.value,errorVal:ce(y.payload,b)}},m={clipPath:r?"url(#clipPath-".concat(i,")"):null};return v.createElement(X,m,h.map(function(p){return v.cloneElement(p,{key:"bar-".concat(p.props.dataKey),data:s,xAxis:c,yAxis:o,layout:u,dataPointFormatter:f})}))}},{key:"renderDots",value:function(r,i,l){var s=this.props.isAnimationActive;if(s&&!this.state.isAnimationFinished)return null;var c=this.props,o=c.dot,u=c.points,d=c.dataKey,h=V(this.props,!1),f=V(o,!0),m=u.map(function(y,b){var A=g(g(g({key:"dot-".concat(b),r:3},h),f),{},{value:y.value,dataKey:d,cx:y.x,cy:y.y,index:b,payload:y.payload});return t.renderDotItem(o,A)}),p={clipPath:r?"url(#clipPath-".concat(i?"":"dots-").concat(l,")"):null};return v.createElement(X,z({className:"recharts-line-dots",key:"dots"},p),m)}},{key:"renderCurveStatically",value:function(r,i,l,s){var c=this.props,o=c.type,u=c.layout,d=c.connectNulls;c.ref;var h=se(c,Le),f=g(g(g({},V(h,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:i?"url(#clipPath-".concat(l,")"):null,points:r},s),{},{type:o,layout:u,connectNulls:d});return v.createElement(be,z({},f,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(r,i){var l=this,s=this.props,c=s.points,o=s.strokeDasharray,u=s.isAnimationActive,d=s.animationBegin,h=s.animationDuration,f=s.animationEasing,m=s.animationId,p=s.animateNewValues,y=s.width,b=s.height,A=this.state,S=A.prevPoints,R=A.totalLength;return v.createElement(je,{begin:d,duration:h,isActive:u,easing:f,from:{t:0},to:{t:1},key:"line-".concat(m),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(_){var P=_.t;if(S){var B=S.length/c.length,O=c.map(function(x,U){var K=Math.floor(U*B);if(S[K]){var W=S[K],w=$(W.x,x.x),pe=$(W.y,x.y);return g(g({},x),{},{x:w(P),y:pe(P)})}if(p){var he=$(y*2,x.x),fe=$(b/2,x.y);return g(g({},x),{},{x:he(P),y:fe(P)})}return g(g({},x),{},{x:x.x,y:x.y})});return l.renderCurveStatically(O,r,i)}var M=$(0,R),F=M(P),I;if(o){var q="".concat(o).split(/[,\s]+/gim).map(function(x){return parseFloat(x)});I=l.getStrokeDasharray(F,R,q)}else I=l.generateSimpleStrokeDasharray(R,F);return l.renderCurveStatically(c,r,i,{strokeDasharray:I})})}},{key:"renderCurve",value:function(r,i){var l=this.props,s=l.points,c=l.isAnimationActive,o=this.state,u=o.prevPoints,d=o.totalLength;return c&&s&&s.length&&(!u&&d>0||!Ae(u,s))?this.renderCurveWithAnimation(r,i):this.renderCurveStatically(s,r,i)}},{key:"render",value:function(){var r,i=this.props,l=i.hide,s=i.dot,c=i.points,o=i.className,u=i.xAxis,d=i.yAxis,h=i.top,f=i.left,m=i.width,p=i.height,y=i.isAnimationActive,b=i.id;if(l||!c||!c.length)return null;var A=this.state.isAnimationFinished,S=c.length===1,R=te("recharts-line",o),_=u&&u.allowDataOverflow,P=d&&d.allowDataOverflow,B=_||P,O=H(b)?this.id:b,M=(r=V(s,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},F=M.r,I=F===void 0?3:F,q=M.strokeWidth,x=q===void 0?2:q,U=Pe(s)?s:{},K=U.clipDot,W=K===void 0?!0:K,w=I*2+x;return v.createElement(X,{className:R},_||P?v.createElement("defs",null,v.createElement("clipPath",{id:"clipPath-".concat(O)},v.createElement("rect",{x:_?f:f-m/2,y:P?h:h-p/2,width:_?m:m*2,height:P?p:p*2})),!W&&v.createElement("clipPath",{id:"clipPath-dots-".concat(O)},v.createElement("rect",{x:f-w/2,y:h-w/2,width:m+w,height:p+w}))):null,!S&&this.renderCurve(B,O),this.renderErrorBar(B,O),(S||s)&&this.renderDots(B,W,O),(!y||A)&&Se.renderCallByParent(this.props,c))}}],[{key:"getDerivedStateFromProps",value:function(r,i){return r.animationId!==i.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,prevPoints:i.curPoints}:r.points!==i.curPoints?{curPoints:r.points}:null}},{key:"repeat",value:function(r,i){for(var l=r.length%2!==0?[].concat(E(r),[0]):r,s=[],c=0;c<i;++c)s=[].concat(E(s),E(l));return s}},{key:"renderDotItem",value:function(r,i){var l;if(v.isValidElement(r))l=v.cloneElement(r,i);else if(ve(r))l=r(i);else{var s=i.key,c=se(i,Te),o=te("recharts-line-dot",typeof r!="boolean"?r.className:"");l=v.createElement(xe,z({key:s},c,{className:o}))}return l}}])}(me.PureComponent);j(T,"displayName","Line");j(T,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Oe.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});j(T,"getComposedData",function(e){var t=e.props,n=e.xAxis,r=e.yAxis,i=e.xAxisTicks,l=e.yAxisTicks,s=e.dataKey,c=e.bandSize,o=e.displayedData,u=e.offset,d=t.layout,h=o.map(function(f,m){var p=ce(f,s);return d==="horizontal"?{x:re({axis:n,ticks:i,bandSize:c,entry:f,index:m}),y:H(p)?null:r.scale(p),value:p,payload:f}:{x:H(p)?null:n.scale(p),y:re({axis:r,ticks:l,bandSize:c,entry:f,index:m}),value:p,payload:f}});return g({points:h,layout:d},u)});var Ue=De({chartName:"LineChart",GraphicalChild:T,axisComponents:[{axisType:"xAxis",AxisComp:Q},{axisType:"yAxis",AxisComp:J}],formatAxisMap:ke});const Ye=({organizationId:e})=>{const{data:t,isLoading:n}=ye({queryKey:["organization-specific-stats",e],queryFn:async()=>{const[o,u,d]=await Promise.all([Y.from("feedback_responses").select("id, created_at, score").eq("organization_id",e),Y.from("feedback_sessions").select("id, status, created_at, total_score").eq("organization_id",e),Y.from("organization_users").select("id, created_at, status").eq("organization_id",e)]);return{responses:o.data||[],sessions:u.data||[],members:d.data||[]}},enabled:!!e});if(n)return a.jsx("div",{className:"p-8",children:"Loading organization statistics..."});const r=(t==null?void 0:t.sessions.filter(o=>o.status==="active").length)||0,i=(t==null?void 0:t.sessions.filter(o=>o.status==="completed").length)||0,l=(t==null?void 0:t.members.filter(o=>o.status==="active").length)||0,s=(t==null?void 0:t.responses.reduce((o,u)=>{const d=new Date(u.created_at).toLocaleString("default",{month:"short",year:"2-digit"}),h=o.find(f=>f.month===d);return h?h.responses++:o.push({month:d,responses:1}),o},[]))||[],c=(t==null?void 0:t.sessions.reduce((o,u)=>{const d=new Date(u.created_at).toLocaleString("default",{month:"short",year:"2-digit"}),h=o.find(f=>f.month===d);return h?(h.sessions++,u.status==="completed"&&h.completed++):o.push({month:d,sessions:1,completed:u.status==="completed"?1:0}),o},[]))||[];return a.jsxs("div",{className:"space-y-6",children:[a.jsx("h2",{className:"text-2xl font-bold",children:"Organization Analytics"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[a.jsxs(D,{children:[a.jsx(k,{children:a.jsx(C,{className:"text-lg",children:"Total Responses"})}),a.jsxs(N,{children:[a.jsx("div",{className:"text-3xl font-bold",children:(t==null?void 0:t.responses.length)||0}),a.jsx("p",{className:"text-sm text-gray-600",children:"All time"})]})]}),a.jsxs(D,{children:[a.jsx(k,{children:a.jsx(C,{className:"text-lg",children:"Active Sessions"})}),a.jsxs(N,{children:[a.jsx("div",{className:"text-3xl font-bold text-green-600",children:r}),a.jsx("p",{className:"text-sm text-gray-600",children:"Currently active"})]})]}),a.jsxs(D,{children:[a.jsx(k,{children:a.jsx(C,{className:"text-lg",children:"Completed Sessions"})}),a.jsxs(N,{children:[a.jsx("div",{className:"text-3xl font-bold text-blue-600",children:i}),a.jsx("p",{className:"text-sm text-gray-600",children:"Total completed"})]})]}),a.jsxs(D,{children:[a.jsx(k,{children:a.jsx(C,{className:"text-lg",children:"Team Members"})}),a.jsxs(N,{children:[a.jsx("div",{className:"text-3xl font-bold text-purple-600",children:l}),a.jsx("p",{className:"text-sm text-gray-600",children:"Active members"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs(D,{children:[a.jsx(k,{children:a.jsx(C,{children:"Monthly Response Trends"})}),a.jsx(N,{children:a.jsx(ne,{width:"100%",height:300,children:a.jsxs(Ce,{data:s,children:[a.jsx(ae,{strokeDasharray:"3 3"}),a.jsx(Q,{dataKey:"month"}),a.jsx(J,{}),a.jsx(ie,{}),a.jsx(Ne,{dataKey:"responses",fill:"#007ACE"})]})})})]}),a.jsxs(D,{children:[a.jsx(k,{children:a.jsx(C,{children:"Session Completion Trends"})}),a.jsx(N,{children:a.jsx(ne,{width:"100%",height:300,children:a.jsxs(Ue,{data:c,children:[a.jsx(ae,{strokeDasharray:"3 3"}),a.jsx(Q,{dataKey:"month"}),a.jsx(J,{}),a.jsx(ie,{}),a.jsx(T,{type:"monotone",dataKey:"sessions",stroke:"#007ACE",strokeWidth:2,name:"Total Sessions"}),a.jsx(T,{type:"monotone",dataKey:"completed",stroke:"#10b981",strokeWidth:2,name:"Completed"})]})})})]})]})]})},Je=({organizationId:e})=>a.jsx(Ee,{permission:"export_data",organizationId:e,showRequiredRole:!0,fallback:a.jsxs("div",{className:"text-center p-8",children:[a.jsx("p",{className:"text-gray-500",children:"You need analyst-level access or higher to view detailed feedback analytics."}),a.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:a.jsx(Ye,{organizationId:e})});export{Je as FeedbackTab,Je as default};
