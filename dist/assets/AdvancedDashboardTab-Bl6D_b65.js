import{i as k,g as D,s as w,j as e,m as J,C as u,d as g,e as N,a as p,f as C,D as Z,M as q,n as ee,o as S,p as _,q as se,r as A,B,t as te,v as ae,w as R,x as re,y as ne,z as P,A as E,F,G as Q,H as T,I as y,J as $,R as ie,K as f,c as le,T as H,L as V,N as W,O as G,U as X,P as ce,Q as de,V as oe,W as xe,k as K,X as me,Y as he,Z as je,_ as ue,$ as ge,a0 as pe,a1 as ve,a2 as O}from"./index-OpI6SulR.js";import{P as Ne}from"./progress-BzM4cCND.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=k("ChartLine",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=k("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=k("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=k("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=k("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),we=s=>D({queryKey:["organization-stats",s],queryFn:async()=>{const{data:t,error:c}=await w.rpc("get_organization_stats",{org_id:s});if(c)throw c;return t},enabled:!!s,staleTime:3e4,refetchInterval:6e4}),M=({className:s,count:t=1})=>e.jsx(e.Fragment,{children:Array.from({length:t}).map((c,i)=>e.jsx("div",{className:J("animate-pulse rounded-md bg-muted",s)},i))}),_e=()=>e.jsxs("div",{className:"rounded-lg border bg-card p-6 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{className:"h-4 w-24"}),e.jsx(M,{className:"h-8 w-8 rounded-lg"})]}),e.jsx(M,{className:"h-8 w-16"}),e.jsx(M,{className:"h-4 w-20"})]}),Ce=({cards:s,isLoading:t=!1,className:c="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"})=>t?e.jsx("div",{className:c,children:Array.from({length:6}).map((i,o)=>e.jsx(_e,{},o))}):e.jsx("div",{className:c,children:s.map(i=>{const o=i.icon;return e.jsxs(u,{className:"transition-all hover:shadow-md",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium text-gray-600",children:i.title}),e.jsx("div",{className:`p-2 rounded-lg ${i.bgColor}`,children:e.jsx(o,{className:`h-4 w-4 ${i.color}`})})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[i.value,i.suffix||""]}),i.trend&&e.jsxs("div",{className:"mt-2 flex items-center text-sm",children:[e.jsxs(C,{variant:i.trend.isPositive?"default":"secondary",className:"text-xs",children:[i.trend.isPositive?"+":"",i.trend.value,"%"]}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:i.trend.label})]})]})]},i.title)})}),I=({organizationId:s})=>{const{data:t,isLoading:c,error:i,refetch:o}=we(s);if(i)return e.jsx(Z,{onRetry:()=>o()});const a=[{title:"Total Questions",value:(t==null?void 0:t.total_questions)||0,icon:q,color:"text-green-600",bgColor:"bg-green-50",trend:{value:8,label:"new this month",isPositive:!0}},{title:"Total Sessions",value:(t==null?void 0:t.total_sessions)||0,icon:ee,color:"text-purple-600",bgColor:"bg-purple-50",trend:{value:23,label:"vs last month",isPositive:!0}},{title:"Completed Sessions",value:(t==null?void 0:t.completed_sessions)||0,icon:S,color:"text-emerald-600",bgColor:"bg-emerald-50",trend:t&&t.total_sessions>0?{value:Math.round(t.completed_sessions/t.total_sessions*100),label:"completion rate",isPositive:!0}:void 0},{title:"Total Responses",value:(t==null?void 0:t.total_responses)||0,icon:_,color:"text-orange-600",bgColor:"bg-orange-50",trend:{value:34,label:"vs last month",isPositive:!0}}];return e.jsx(se,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{cards:a,isLoading:c}),!c&&t&&t.total_sessions>0&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(C,{variant:"outline",className:"text-sm",children:["Overall completion rate: ",Math.round(t.completed_sessions/t.total_sessions*100),"%"]})})]})})},Te=({questionId:s,questionText:t,questionType:c,responses:i,completionRate:o})=>{const[a,x]=A.useState(!1),{data:l}=D({queryKey:["question-responses",s],queryFn:async()=>{const{data:n}=await w.from("feedback_responses").select("id, response_value, created_at, question_category").eq("question_id",s).order("created_at",{ascending:!1}).limit(10);return n||[]},enabled:a}),m=()=>{if(!l||l.length===0)return[];const n={};return l.forEach(d=>{const j=String(d.response_value||"No Response");n[j]=(n[j]||0)+1}),Object.entries(n).map(([d,j])=>({value:d,count:j,percentage:j/l.length*100}))},r=n=>{switch(n.toLowerCase()){case"star rating":case"nps score":return e.jsx(_,{className:"w-4 h-4 text-green-600"});case"text input":return e.jsx(be,{className:"w-4 h-4 text-gray-600"});default:return e.jsx(_,{className:"w-4 h-4 text-blue-600"})}},v=(n,d)=>{if(n==null)return"No Response";switch(d.toLowerCase()){case"star rating":return`${n} stars`;case"nps score":return`${n}/10`;case"single choice":case"multiple choice":return Array.isArray(n)?n.join(", "):String(n);case"slider":return`${n}`;default:return String(n)}},h=m();return e.jsxs(u,{className:"mb-4",children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(N,{className:"text-lg",children:t}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsx(C,{variant:"outline",children:c}),e.jsxs("span",{className:"text-sm text-gray-600",children:[i.length," responses"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[o,"% completion"]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[r(c),e.jsx("span",{className:"text-sm text-gray-600",children:"Active"})]})]})]}),e.jsx(B,{variant:"ghost",size:"sm",onClick:()=>x(!a),children:a?e.jsx(te,{className:"w-4 h-4"}):e.jsx(ae,{className:"w-4 h-4"})})]})}),a&&e.jsx(p,{children:e.jsxs("div",{className:"space-y-6",children:[h.length>0&&["single choice","multiple choice","star rating","emoji rating"].includes(c.toLowerCase())&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Response Distribution"]}),e.jsxs("div",{className:"space-y-3",children:[h.slice(0,5).map((n,d)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"font-medium truncate",children:n.value}),e.jsxs("span",{children:[n.count," (",Math.round(n.percentage),"%)"]})]}),e.jsx(Ne,{value:n.percentage,className:"h-2"})]},d)),h.length>5&&e.jsxs("p",{className:"text-sm text-gray-500",children:["... and ",h.length-5," more responses"]})]})]}),c.toLowerCase()==="text input"&&l&&l.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Response Analysis"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-blue-900",children:"Total Responses"}),e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l.length})]}),e.jsxs("div",{className:"p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"font-medium text-green-900",children:"Response Rate"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[o,"%"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-3",children:"Recent Responses"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:l&&l.length>0?l.slice(0,5).map((n,d)=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-900",children:v(n.response_value,c)}),e.jsx("span",{className:"text-gray-500 text-xs",children:new Date(n.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"text-gray-600 text-xs mt-1",children:["Category: ",n.question_category]})]},d)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No responses yet"})})]})]})})]})},U=({questions:s,categories:t,summary:c,showDrillDown:i=!1})=>{const[o,a]=A.useState(null);console.log("AnalyticsTable - Rendering with data:",{questionsCount:s==null?void 0:s.length,categoriesCount:t==null?void 0:t.length,summary:c,showDrillDown:i});const x=r=>{switch(r){case"positive":return e.jsx(S,{className:"w-4 h-4 text-green-600"});case"negative":return e.jsx(H,{className:"w-4 h-4 text-red-600"});case"mixed":return e.jsx(_,{className:"w-4 h-4 text-yellow-600"});default:return e.jsx(_,{className:"w-4 h-4 text-gray-600"})}},l=r=>{switch(r){case"positive":return"text-green-600 bg-green-50";case"negative":return"text-red-600 bg-red-50";case"mixed":return"text-yellow-600 bg-yellow-50";default:return"text-gray-600 bg-gray-50"}},m=r=>{switch(r){case"positive":return"Positive";case"negative":return"Needs Attention";case"mixed":return"Mixed Results";default:return"Neutral"}};return!s&&!t?e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"Analytics Dashboard"})]})}),e.jsx(p,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No analytics data available yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Data will appear here once feedback is collected"})]})})]}):e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"Analytics Dashboard"})]})}),e.jsx(p,{children:e.jsxs(re,{defaultValue:"questions",className:"space-y-4",children:[e.jsxs(ne,{children:[e.jsxs(P,{value:"questions",className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsxs("span",{children:["Questions (",(s==null?void 0:s.length)||0,")"]})]}),e.jsxs(P,{value:"categories",children:["Categories (",(t==null?void 0:t.length)||0,")"]})]}),e.jsx(E,{value:"questions",children:e.jsx("div",{className:"space-y-4",children:s&&s.length>0?e.jsxs(F,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(y,{children:"Question"}),e.jsx(y,{children:"Type"}),e.jsx(y,{children:"Category"}),e.jsx(y,{children:"Responses"}),e.jsx(y,{children:"Completion Rate"}),e.jsx(y,{children:"Trend"}),e.jsx(y,{children:"Key Insights"}),i&&e.jsx(y,{children:"Actions"})]})}),e.jsx($,{children:s.map(r=>{var v,h;return e.jsxs(ie.Fragment,{children:[e.jsxs(T,{children:[e.jsx(f,{className:"font-medium max-w-xs truncate",children:r.question_text}),e.jsx(f,{children:e.jsx(C,{variant:"outline",children:r.question_type})}),e.jsx(f,{children:r.category}),e.jsx(f,{children:r.total_responses}),e.jsxs(f,{children:[r.completion_rate,"%"]}),e.jsx(f,{children:e.jsxs("div",{className:`flex items-center space-x-2 px-2 py-1 rounded-md ${l(r.trend)}`,children:[x(r.trend),e.jsx("span",{className:"font-medium",children:m(r.trend)})]})}),e.jsx(f,{className:"max-w-xs",children:e.jsx("div",{className:"text-sm",children:((v=r.insights)==null?void 0:v.slice(0,2).map((n,d)=>e.jsx("div",{className:"truncate",children:n},d)))||e.jsx("span",{className:"text-gray-400",children:"No insights"})})}),i&&e.jsx(f,{children:e.jsx(B,{variant:"ghost",size:"sm",onClick:()=>a(o===r.id?null:r.id),children:e.jsx(le,{className:`w-4 h-4 transition-transform ${o===r.id?"rotate-90":""}`})})})]}),i&&o===r.id&&e.jsx(T,{children:e.jsx(f,{colSpan:8,className:"p-0",children:e.jsxs("div",{className:"p-4 bg-gray-50",children:[e.jsx(Te,{questionId:r.id,questionText:r.question_text,questionType:r.question_type,responses:[],avgScore:0,completionRate:r.completion_rate}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(u,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(N,{className:"text-sm",children:"Response Insights"})}),e.jsx(p,{children:e.jsx("ul",{className:"text-sm space-y-1",children:((h=r.insights)==null?void 0:h.map((n,d)=>e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"•"}),e.jsx("span",{children:n})]},d)))||e.jsx("li",{className:"text-gray-400",children:"No insights available"})})})]}),e.jsxs(u,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(N,{className:"text-sm",children:"Response Distribution"})}),e.jsx(p,{children:e.jsx("div",{className:"text-sm space-y-1",children:r.response_distribution&&Object.entries(r.response_distribution).length>0?Object.entries(r.response_distribution).slice(0,3).map(([n,d],j)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"truncate",children:n}),e.jsx("span",{className:"font-medium",children:d})]},j)):e.jsx("div",{className:"text-gray-400",children:"No responses yet"})})})]})]})]})})})]},r.id)})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No questions found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Questions will appear here once they are created"})]})})}),e.jsx(E,{value:"categories",children:t&&t.length>0?e.jsxs(F,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(y,{children:"Category"}),e.jsx(y,{children:"Questions"}),e.jsx(y,{children:"Total Responses"}),e.jsx(y,{children:"Completion Rate"})]})}),e.jsx($,{children:t.map((r,v)=>e.jsxs(T,{children:[e.jsx(f,{className:"font-medium",children:r.category}),e.jsx(f,{children:r.total_questions}),e.jsx(f,{children:r.total_responses}),e.jsxs(f,{children:[r.completion_rate,"%"]})]},v))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(R,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"No categories found"}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Categories will appear here once questions are categorized"})]})})]})})]})},Re=({stats:s,isLoading:t=!1})=>{var i,o;if(console.log("AnalyticsInsights - Rendering with stats:",s),t)return e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{children:"Analytics Insights"})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-4",children:[1,2,3].map(a=>e.jsx("div",{className:"h-16 bg-gray-100 rounded animate-pulse"},a))})})]});if(!s)return e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{children:"Analytics Insights"})}),e.jsx(p,{children:e.jsxs(V,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(G,{children:"Analytics insights will appear here once data is available."})]})})]});const c=[{title:"Response Rate",value:s.total_sessions>0?`${Math.round(s.completed_sessions/s.total_sessions*100)}%`:"0%",trend:((i=s.growth_metrics)==null?void 0:i.growth_rate)||0,isPositive:(((o=s.growth_metrics)==null?void 0:o.growth_rate)||0)>=0,icon:q,description:"Session completion rate this month"},{title:"User Engagement",value:s.active_members||0,trend:8,isPositive:!0,icon:X,description:"Active members this month"},{title:"Response Quality",value:s.total_questions>0?`${Math.round(s.total_responses/s.total_questions*100)}%`:"0%",trend:5,isPositive:!0,icon:S,description:"Average responses per question"}];return e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{children:"Analytics Insights"})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-4",children:c.map((a,x)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${a.isPositive?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:e.jsx(a.icon,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl font-bold",children:a.value}),e.jsxs(C,{variant:a.isPositive?"default":"destructive",className:"flex items-center space-x-1",children:[a.isPositive?e.jsx(_,{className:"w-3 h-3"}):e.jsx(Y,{className:"w-3 h-3"}),e.jsxs("span",{children:[Math.abs(a.trend),"%"]})]})]})]},x))})})]})},Ae=s=>{const[t,c]=A.useState({activeUsers:0,feedbackSubmissions:0,averageScore:0,responseTime:0}),[i,o]=A.useState(!0),a=async()=>{try{const x=new Date(Date.now()-6e5).toISOString(),{data:l}=await w.from("feedback_sessions").select("id").eq("organization_id",s).gte("started_at",x),{data:m}=await w.from("feedback_responses").select("id, score").eq("organization_id",s).gte("created_at",x),{data:r}=await w.from("feedback_sessions").select("started_at, completed_at").eq("organization_id",s).eq("status","completed").not("completed_at","is",null).order("completed_at",{ascending:!1}).limit(50);let v=0;r&&r.length>0&&(v=r.reduce((d,j)=>{const b=new Date(j.started_at).getTime(),L=new Date(j.completed_at).getTime();return d+(L-b)},0)/r.length/(1e3*60));let h=0;if(m&&m.length>0){const n=m.filter(d=>d.score!==null);n.length>0&&(h=n.reduce((d,j)=>d+j.score,0)/n.length)}c({activeUsers:(l==null?void 0:l.length)||0,feedbackSubmissions:(m==null?void 0:m.length)||0,averageScore:Math.round(h*10)/10,responseTime:Math.round(v*10)/10})}catch(x){console.error("Error fetching real-time analytics:",x)}finally{o(!1)}};return A.useEffect(()=>{if(!s)return;a();const x=setInterval(a,3e4);return()=>clearInterval(x)},[s]),{liveData:t,isLoading:i,refetch:a}},Se=({organizationId:s})=>{const{liveData:t,isLoading:c}=Ae(s);return c?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 animate-pulse",children:[e.jsx("div",{className:"h-32 bg-gray-200 rounded"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{children:"Feedback Submissions (Last 10 min)"})}),e.jsx(p,{children:e.jsx("div",{className:"text-4xl font-bold",children:t.feedbackSubmissions})})]}),e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{children:"Response Time (min)"})}),e.jsx(p,{children:e.jsx("div",{className:"text-4xl font-bold",children:t.responseTime})})]})]})},ke=s=>D({queryKey:["executive-analytics",s],queryFn:async()=>{const t=new Date;t.setDate(1);const c=new Date(t);c.setMonth(c.getMonth()-1);const{data:i}=await w.from("feedback_sessions").select("total_score").eq("organization_id",s).not("total_score","is",null),o=i&&i.length>0?i.reduce((h,n)=>h+n.total_score,0)/i.length/5*5:0,{data:a}=await w.from("feedback_sessions").select("id, status").eq("organization_id",s),x=(a==null?void 0:a.filter(h=>h.status==="completed").length)||0,l=a&&a.length>0?x/a.length*100:0,{data:m}=await w.from("feedback_sessions").select("started_at, completed_at").eq("organization_id",s).eq("status","completed").not("completed_at","is",null);let r=0;m&&m.length>0&&(r=m.reduce((n,d)=>{const j=new Date(d.started_at).getTime(),b=new Date(d.completed_at).getTime();return n+(b-j)},0)/m.length/(1e3*60*60*24));const v=a&&a.length>0?Math.max(.5,2-a.length/100):1;return[{title:"Customer Satisfaction",value:Math.round(o*10)/10,target:4.5,trend:"+5%",isPositive:!0,suffix:"/5"},{title:"Response Rate",value:Math.round(l),target:90,trend:"+12%",isPositive:!0,suffix:"%"},{title:"Issue Resolution Time",value:Math.round(r*10)/10,target:2,trend:"-8%",isPositive:!0,suffix:" days"},{title:"Cost per Feedback",value:Math.round(v*100)/100,target:1,trend:"-15%",isPositive:!0,prefix:"$"}]},enabled:!!s,staleTime:5*60*1e3}),Le=({organizationId:s})=>{const{data:t,isLoading:c,error:i}=ke(s);if(i)return e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(H,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Executive Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Unable to load executive analytics data. Please try again."})]});if(c)return e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[1,2,3].map(a=>e.jsx("div",{className:"h-32 bg-gray-200 rounded animate-pulse"},a))})});const o=(t==null?void 0:t.filter(a=>a.title!=="Cost per Feedback"))||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:o.map((a,x)=>e.jsxs(u,{className:"border-l-4 border-l-blue-500",children:[e.jsx(g,{className:"pb-2",children:e.jsx(N,{className:"text-sm font-medium text-gray-600",children:a.title})}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[a.prefix,a.value,a.suffix]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Target: ",a.prefix,a.target,a.suffix]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs(C,{variant:a.isPositive?"default":"secondary",className:"mb-2",children:[a.isPositive?e.jsx(_,{className:"w-3 h-3 mr-1"}):e.jsx(Y,{className:"w-3 h-3 mr-1"}),a.trend]}),a.title==="Customer Satisfaction"&&e.jsx(ce,{className:"w-5 h-5 text-blue-600"}),a.title==="Response Rate"&&e.jsx(X,{className:"w-5 h-5 text-green-600"}),a.title==="Issue Resolution Time"&&e.jsx(S,{className:"w-5 h-5 text-orange-600"})]})]})})]},x))}),e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{children:"Critical Insights & Alerts"})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900",children:"Performance Above Target"})]}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Customer satisfaction is consistently above 4.0/5 target"})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Positive Trend"})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Response rates have improved by 12% this month"})]})]})})]}),e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(N,{children:"Data-Driven Recommendations"})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 border-l-4 border-l-blue-500 bg-blue-50",children:[e.jsx("h4",{className:"font-medium",children:"Optimize Response Collection"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Consider implementing automated follow-ups to maintain high response rates"})]}),e.jsxs("div",{className:"p-3 border-l-4 border-l-green-500 bg-green-50",children:[e.jsx("h4",{className:"font-medium",children:"Leverage High Satisfaction Areas"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Replicate successful practices from high-performing categories"})]})]})})]})]})},Me=({data:s,isLoading:t})=>t?e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx("div",{className:"h-6 w-1/3 rounded bg-gray-200 animate-pulse mb-2"}),e.jsx("div",{className:"h-4 w-1/2 rounded bg-gray-200 animate-pulse"})]}),e.jsx(p,{children:e.jsx("div",{className:"h-80 rounded bg-gray-200 animate-pulse"})})]}):!s||s.length===0?e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(N,{children:"Trend Analysis"}),e.jsx(K,{children:"Key metrics over the selected period."})]}),e.jsx(p,{children:e.jsxs("div",{className:"h-80 flex flex-col items-center justify-center text-center text-gray-500",children:[e.jsx(fe,{className:"w-12 h-12 mb-4"}),e.jsx("p",{className:"font-semibold",children:"No Trend Data Available"}),e.jsx("p",{className:"text-sm",children:"Try selecting a different date range to see trend analysis."})]})})]}):e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(N,{children:"Trend Analysis"}),e.jsx(K,{children:"Key metrics over the selected period."})]}),e.jsx(p,{children:e.jsx("div",{className:"h-80 -ml-4",children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(he,{data:s,margin:{top:5,right:30,left:0,bottom:5},children:[e.jsx(je,{strokeDasharray:"3 3"}),e.jsx(ue,{dataKey:"date"}),e.jsx(ge,{domain:[0,100],unit:"%"}),e.jsx(pe,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"var(--radius)"}}),e.jsx(ve,{}),e.jsx(O,{type:"monotone",dataKey:"completion_rate",name:"Completion Rate",stroke:"hsl(var(--primary))",strokeWidth:2,dot:{r:4},activeDot:{r:8}}),e.jsx(O,{type:"monotone",dataKey:"avg_score",name:"Average Score",stroke:"hsl(var(--destructive))",strokeWidth:2,dot:{r:4},activeDot:{r:8}})]})})})})]}),De=({organizationId:s,organizationName:t,activeTab:c,stats:i,isLiveActivity:o,setIsLiveActivity:a,handleQuickActions:x})=>{const{data:l,isLoading:m,error:r}=de(s),{data:v,isLoading:h,error:n}=oe(s);if(m&&h)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[1,2,3,4].map(L=>e.jsx("div",{className:"h-32 bg-gray-200 rounded animate-pulse"},L))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded animate-pulse"})]});const j={...(l==null?void 0:l.summary)||{total_questions:0,total_responses:0,overall_completion_rate:0},overall_avg_score:(v==null?void 0:v.avg_session_score)||0},b=r||n?e.jsxs(V,{variant:"destructive",className:"mb-4",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(xe,{children:"Error"}),e.jsxs(G,{children:["Some dashboard data may be unavailable. ",(r==null?void 0:r.message)||(n==null?void 0:n.message)]})]}):null;return c==="overview"?e.jsxs("div",{className:"space-y-6",children:[b,e.jsx(I,{organizationId:s}),e.jsx(Me,{data:(l==null?void 0:l.trendData)||[],isLoading:m}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(U,{questions:(l==null?void 0:l.questions)||[],categories:(l==null?void 0:l.categories)||[],summary:j}),e.jsx(Re,{stats:v,isLoading:h})]})]}):c==="executive"?e.jsxs("div",{className:"space-y-6",children:[b,e.jsx(Le,{organizationId:s})]}):c==="realtime"?e.jsxs("div",{className:"space-y-6",children:[b,e.jsx(Se,{organizationId:s})]}):c==="detailed"?e.jsxs("div",{className:"space-y-6",children:[b,e.jsx(U,{questions:(l==null?void 0:l.questions)||[],categories:(l==null?void 0:l.categories)||[],summary:j,showDrillDown:!0})]}):e.jsxs(e.Fragment,{children:[b,e.jsx(I,{organizationId:s})]})},Fe=({organization:s,stats:t,activeTab:c,setActiveTab:i,isLiveActivity:o,setIsLiveActivity:a,handleQuickActions:x})=>e.jsx(De,{organizationId:s.id,organizationName:s.name,activeTab:c,onTabChange:i,stats:t,isLiveActivity:o,setIsLiveActivity:a,handleQuickActions:x});export{Fe as AdvancedDashboardTab,Fe as default};
