import{b0 as p,ae as y,ac as q,j as e,C as v,k as R,q as b,b1 as A,l as C,B as w,b2 as P,b3 as o,T as g,i as j,r as B,ao as F}from"./index-BGUrTFyn.js";const T=({organizationId:i}={})=>{const{hasPermission:a,userRole:t,isLoading:n,isAdmin:s}=p(i),{isOrgAdmin:l,isAdmin:c}=y();return{hasPermission:r=>s||c||l&&i?!0:a(r),hasRole:r=>s||c||l&&i?!0:t===r,userRole:t,isLoading:n,isSystemAdmin:s||c,isOrgAdmin:l}},N=({type:i,requiredRole:a,requiredPermission:t,userRole:n,onRequestAccess:s,isSubmitting:l=!1})=>{const{organization:c}=q(),d=()=>{if(!a||!n)return null;const r=o(a),m=o(n),x=r.icon,h=m.icon;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-4 h-4 text-amber-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["You need ",r.label," level access or higher."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Required role:"}),e.jsxs(j,{variant:r.variant,className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-3 h-3"}),r.label]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Your role:"}),e.jsxs(j,{variant:m.variant,className:"flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),m.label]})]})]})]})},u=()=>{if(!t||!n)return null;const r=o(n).icon;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{className:"w-4 h-4 text-amber-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["You don't have the required permission: ",t]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Your role:"}),e.jsxs(j,{variant:o(n).variant,className:"flex items-center gap-1",children:[e.jsx(r,{className:"w-3 h-3"}),o(n).label]})]})]})};return e.jsxs(v,{className:"border-red-200",children:[e.jsx(R,{children:e.jsxs(b,{className:"flex items-center text-red-600",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),i==="role"?"Access Restricted":"Permission Required"]})}),e.jsxs(C,{className:"space-y-4",children:[i==="role"?d():u(),c&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Organization:"})," ",c.name]})}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs(w,{onClick:s,size:"sm",className:"w-full",disabled:l,children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),l?"Requesting...":i==="role"?"Request Role Upgrade":"Request Access"]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Contact your organization administrator for assistance."})]})]})]})},k=()=>{const[i,a]=B.useState(!1);return{submitAccessRequest:async n=>{a(!0);try{console.log("Access request submitted:",n),await new Promise(s=>setTimeout(s,1e3)),console.log("Access request submitted successfully")}catch(s){throw console.error("Failed to submit access request:",s),s}finally{a(!1)}},isSubmitting:i}},L=({children:i,permission:a,role:t,organizationId:n,fallback:s,showRequiredRole:l=!1,onRequestAccess:c})=>{const{hasPermission:d,hasRole:u,userRole:r,isLoading:m}=T({organizationId:n}),{submitAccessRequest:x,isSubmitting:h}=k();if(m)return e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Checking permissions..."})]})});if(a&&!d(a)){if(s)return e.jsx(e.Fragment,{children:s});if(!l)return null;const f=async()=>{c?c():await x({requestType:"permission",requestedPermission:a,reason:`Need ${a} permission to access this feature`})};return e.jsx(N,{type:"permission",requiredPermission:a,userRole:r,onRequestAccess:f,isSubmitting:h})}if(t&&!u(t)){if(s)return e.jsx(e.Fragment,{children:s});if(!l)return null;const f=async()=>{c?c():await x({requestType:"role_upgrade",requestedRole:t,reason:`Need ${t} level access for this feature`})};return e.jsx(N,{type:"role",requiredRole:t,userRole:r,onRequestAccess:f,isSubmitting:h})}return e.jsx(e.Fragment,{children:i})};export{L as P,T as u};
