import{r as p,j as e,V as n,F as g,C as t,l,W as y,o as N,X as v,B as f,M as F,A as L,H as b,Y as $,_ as q,$ as E,a0 as U,a1 as z,a2 as V,a3 as m,w as B,x as P,y as o,i as w,z as x,k as i,q as c,G as _,a4 as h,p as G,U as H}from"./index-DWscXvS9.js";import{u as I}from"./useAnalyticsTableData-mp1UDVpU.js";import{D as K,a as O,A as Y}from"./download-rtgrqmYE.js";import{P as W}from"./PermissionGuard-BC_gz8bW.js";const X=({organizationId:d})=>{const{data:s,isLoading:C,error:j,refetch:k}=I(d),[T,R]=p.useState("30d"),[A,S]=p.useState("overview");if(C)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(n,{className:"h-8 w-64 mb-2"}),e.jsx(n,{className:"h-4 w-96"})]}),e.jsx(n,{className:"h-10 w-32"})]}),e.jsx(g,{columns:{xs:1,sm:2,md:2,lg:4},gap:"md",children:Array.from({length:4}).map((a,r)=>e.jsx(t,{children:e.jsxs(l,{className:"p-6",children:[e.jsx(n,{className:"h-4 w-20 mb-2"}),e.jsx(n,{className:"h-8 w-16 mb-2"}),e.jsx(n,{className:"h-3 w-24"})]})},r))})]});if(j)return e.jsxs(y,{variant:"destructive",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsxs(v,{children:["Error loading feedback analytics: ",j.message,e.jsx(f,{variant:"outline",size:"sm",onClick:()=>k(),className:"ml-2",children:"Retry"})]})]});if(!s)return e.jsxs(y,{children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx(v,{children:"No analytics data available for this organization."})]});const D=s.questions.length>0?s.questions.reduce((a,r)=>a+(r.avg_response_time_ms||0),0)/s.questions.length:0,u=Math.round(D/6e4*10)/10,M=[{title:"Total Responses",value:s.summary.total_responses,change:s.summary.growth_rate,trend:s.summary.growth_rate>=0?"up":"down",icon:F,description:"All time feedback responses"},{title:"Active Sessions",value:s.summary.total_sessions,change:Math.abs(s.summary.growth_rate),trend:s.summary.growth_rate>=0?"up":"down",icon:L,description:"Total feedback sessions"},{title:"Completion Rate",value:`${s.summary.overall_completion_rate}%`,change:s.summary.growth_rate,trend:s.summary.growth_rate>=0?"up":"down",icon:b,description:"Session completion percentage"},{title:"Avg. Response Time",value:u>0?`${u}min`:"0min",change:0,trend:"neutral",icon:$,description:"Average time per response"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Feedback Analytics"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Comprehensive insights into your feedback collection performance"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(q,{value:T,onValueChange:R,children:[e.jsxs(E,{className:"w-32",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),e.jsx(z,{})]}),e.jsxs(V,{children:[e.jsx(m,{value:"7d",children:"Last 7 days"}),e.jsx(m,{value:"30d",children:"Last 30 days"}),e.jsx(m,{value:"90d",children:"Last 90 days"}),e.jsx(m,{value:"1y",children:"Last year"})]})]}),e.jsxs(f,{variant:"outline",size:"sm",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Export"]})]})]}),e.jsx(g,{columns:{xs:1,sm:2,md:2,lg:4},gap:"md",children:M.map((a,r)=>e.jsx(t,{className:"hover:shadow-md transition-shadow duration-200",children:e.jsxs(l,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(a.icon,{className:"w-4 h-4 text-blue-600"})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium text-gray-600",children:a.title})})]}),a.change!==0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[a.trend==="up"?e.jsx(O,{className:"w-3 h-3 text-green-500"}):a.trend==="down"?e.jsx(Y,{className:"w-3 h-3 text-red-500"}):null,a.change!==0&&e.jsxs("span",{className:`text-xs font-medium ${a.trend==="up"?"text-green-500":a.trend==="down"?"text-red-500":"text-gray-500"}`,children:[Math.abs(a.change),"%"]})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.value}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a.description})]})]})},r))}),e.jsxs(B,{value:A,onValueChange:S,className:"w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0",children:[e.jsxs(P,{className:"grid w-full max-w-md grid-cols-3",children:[e.jsx(o,{value:"overview",children:"Overview"}),e.jsx(o,{value:"trends",children:"Trends"}),e.jsx(o,{value:"insights",children:"Insights"})]}),e.jsxs(w,{variant:"outline",className:"flex items-center space-x-2 self-start sm:self-auto",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs",children:"Live Data"})]})]}),e.jsx(x,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsxs(i,{children:[e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"w-5 h-5"}),e.jsx("span",{children:"Response Distribution"})]}),e.jsx(h,{children:"Breakdown of responses by category and type"})]}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:s.categories.length>0?s.categories.map((a,r)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:a.category}),e.jsx(w,{variant:"secondary",children:a.total_responses})]},r)):e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No response data available"})})})]}),e.jsxs(t,{children:[e.jsxs(i,{children:[e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"w-5 h-5"}),e.jsx("span",{children:"Performance Summary"})]}),e.jsx(h,{children:"Key performance indicators at a glance"})]}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Response Rate"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-16 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${Math.min(s.summary.response_rate,100)}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:[s.summary.response_rate,"%"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"User Satisfaction"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-16 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-purple-500 rounded-full",style:{width:`${Math.min(s.summary.user_satisfaction_rate,100)}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:[s.summary.user_satisfaction_rate,"%"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Score"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-16 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${s.summary.avg_score/5*100}%`}})}),e.jsxs("span",{className:"text-sm font-medium",children:[s.summary.avg_score,"/5"]})]})]})]})})]})]})}),e.jsx(x,{value:"trends",className:"space-y-6",children:e.jsxs(t,{children:[e.jsxs(i,{children:[e.jsx(c,{children:"Response Trends"}),e.jsx(h,{children:"Historical data showing feedback collection patterns"})]}),e.jsx(l,{children:e.jsx("div",{className:"h-64 flex items-center justify-center border-2 border-dashed border-gray-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"Trend Chart"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Visual trends will appear here"})]})})})]})}),e.jsx(x,{value:"insights",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(i,{children:e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{children:"Key Insights"})]})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-3",children:[s.summary.growth_rate>0&&e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("p",{className:"text-sm font-medium text-green-800",children:["âœ“ Response rate increased by ",s.summary.growth_rate,"% this month"]})}),s.summary.completed_sessions>0?e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm font-medium text-blue-800",children:["â„¹ ",s.summary.completed_sessions," sessions completed successfully"]})}):e.jsx("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsx("p",{className:"text-sm font-medium text-gray-800",children:"â„¹ No completed sessions yet"})}),s.summary.overall_completion_rate<70&&s.summary.total_sessions>0&&e.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("p",{className:"text-sm font-medium text-amber-800",children:["âš  Completion rate needs attention (",s.summary.overall_completion_rate,"%)"]})}),s.summary.total_sessions===0&&e.jsx("div",{className:"p-3 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsx("p",{className:"text-sm font-medium text-gray-800",children:"ðŸ“Š No feedback sessions recorded yet. Start collecting feedback to see insights here."})})]})})]}),e.jsxs(t,{children:[e.jsx(i,{children:e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:"Recommendations"})]})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-3",children:s.summary.total_sessions===0?e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Start Collecting Feedback"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Set up your first feedback form to begin gathering insights"})]}):e.jsxs(e.Fragment,{children:[s.summary.overall_completion_rate<70&&e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Optimize Form Length"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Consider shorter forms to improve completion rates"})]}),s.summary.user_satisfaction_rate<75&&e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Improve User Experience"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Focus on enhancing the feedback collection process"})]}),e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Monitor Performance"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Regular tracking of key metrics for continuous improvement"})]})]})})})]})]})})]})]})},se=({organizationId:d})=>e.jsx(W,{permission:"view_analytics",organizationId:d,showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need viewer-level access or higher to view detailed feedback analytics."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsx(X,{organizationId:d})});export{se as FeedbackTab,se as default};
