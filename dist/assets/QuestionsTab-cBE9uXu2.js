import{c as f,r as E,j as e,a3 as y,a4 as $,J as h,C as V,l as O,B as b,a5 as B,a6 as K,X as L,Y as z,$ as P,a0 as F,a1 as I,a7 as H,a8 as X,a9 as Y,u as k,aa as q,k as A,q as T,ab as g,ac as G}from"./index-BYVkLRsh.js";import{P as J}from"./PermissionGuard-Cp_nxdJY.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=f("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=f("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Z=({questionType:s,supportsOptions:u,supportsScale:d,options:x=[],scaleConfig:t,helpText:p="",placeholderText:n="",onOptionsChange:j,onScaleChange:m,onHelpTextChange:l,onPlaceholderChange:o})=>{const[v,_]=E.useState(x.length>0?x:N());function N(){return s==="emoji"?[{text:"😊",value:"happy"},{text:"😐",value:"neutral"},{text:"😞",value:"sad"}]:[{text:""},{text:""}]}const Q=()=>{const i=s==="emoji"?{text:"😊",value:""}:{text:""},r=[...v,i];_(r),j(r)},w=i=>{const r=v.filter((c,S)=>S!==i);_(r),j(r)},a=(i,r,c)=>{const S=v.map((M,R)=>R===i?{...M,[r]:c}:M);_(S),j(S)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"help-text",children:"Help Text (optional)"}),e.jsx($,{id:"help-text",value:p,onChange:i=>l(i.target.value),placeholder:"Additional guidance for users...",className:"mt-1"})]}),s==="text"&&e.jsxs("div",{children:[e.jsx(y,{htmlFor:"placeholder",children:"Placeholder Text"}),e.jsx(h,{id:"placeholder",value:n,onChange:i=>o(i.target.value),placeholder:"Enter placeholder text...",className:"mt-1"})]}),u&&e.jsx(V,{children:e.jsx(O,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{children:s==="emoji"?"Emoji Options":"Answer Options"}),s==="emoji"&&e.jsx("p",{className:"text-sm text-gray-600",children:"Enter emoji characters (😊, 😐, 😞, etc.) for users to select from"}),v.map((i,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{value:i.text,onChange:c=>a(r,"text",c.target.value),placeholder:s==="emoji"?"😊":`Option ${r+1}`,className:s==="emoji"?"w-16 text-center text-2xl":"flex-1"}),s!=="emoji"&&e.jsx(h,{value:i.value||"",onChange:c=>a(r,"value",c.target.value),placeholder:"Value",className:"w-20"}),s==="emoji"&&e.jsx(h,{value:i.value||"",onChange:c=>a(r,"value",c.target.value),placeholder:"Description",className:"flex-1"}),v.length>(s==="emoji"?1:2)&&e.jsx(b,{type:"button",variant:"outline",size:"sm",onClick:()=>w(r),children:e.jsx(B,{className:"w-4 h-4"})})]},r)),e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:Q,className:"w-full",children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),"Add ",s==="emoji"?"Emoji":"Option"]})]})})}),d&&e.jsx(V,{children:e.jsx(O,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(y,{children:"Scale Configuration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"min-value",children:"Min Value"}),e.jsx(h,{id:"min-value",type:"number",value:(t==null?void 0:t.minValue)||1,onChange:i=>m({...t,minValue:parseInt(i.target.value)||1,maxValue:(t==null?void 0:t.maxValue)||5})})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"max-value",children:"Max Value"}),e.jsx(h,{id:"max-value",type:"number",value:(t==null?void 0:t.maxValue)||5,onChange:i=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:parseInt(i.target.value)||5})})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"min-label",children:"Min Label"}),e.jsx(h,{id:"min-label",value:(t==null?void 0:t.minLabel)||"",onChange:i=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:(t==null?void 0:t.maxValue)||5,minLabel:i.target.value}),placeholder:"e.g., Poor"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"max-label",children:"Max Label"}),e.jsx(h,{id:"max-label",value:(t==null?void 0:t.maxLabel)||"",onChange:i=>m({...t,minValue:(t==null?void 0:t.minValue)||1,maxValue:(t==null?void 0:t.maxValue)||5,maxLabel:i.target.value}),placeholder:"e.g., Excellent"})]})]})]})})}),e.jsxs("div",{className:"text-sm text-gray-600 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("strong",{children:["Selected Type: ",s]}),e.jsxs("div",{className:"mt-1",children:[u&&e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mr-2",children:"Supports Options"}),d&&e.jsx("span",{className:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded text-xs mr-2",children:"Supports Scale"}),s==="text"&&e.jsx("span",{className:"inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:"Text Input"}),s==="emoji"&&e.jsx("span",{className:"inline-block bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs",children:"Emoji Selection"})]})]})]})},D=s=>({"single-choice":{supportsOptions:!0,supportsScale:!1},"multi-choice":{supportsOptions:!0,supportsScale:!1},star:{supportsOptions:!1,supportsScale:!0},likert:{supportsOptions:!1,supportsScale:!0},nps:{supportsOptions:!1,supportsScale:!0},slider:{supportsOptions:!1,supportsScale:!0},emoji:{supportsOptions:!0,supportsScale:!1},ranking:{supportsOptions:!0,supportsScale:!1},matrix:{supportsOptions:!0,supportsScale:!0},text:{supportsOptions:!1,supportsScale:!1}})[s]||{supportsOptions:!1,supportsScale:!1},C=({formData:s,setFormData:u,questionTypes:d,categories:x,editingId:t,onSubmit:p,onCancel:n,isSubmitting:j})=>{const m=D(s.question_type);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(h,{placeholder:"Question text",value:s.question_text,onChange:l=>u(o=>({...o,question_text:l.target.value}))}),e.jsxs(L,{value:s.question_type,onValueChange:l=>u(o=>({...o,question_type:l,options:[],scaleConfig:{minValue:1,maxValue:5}})),children:[e.jsx(z,{children:e.jsx(P,{})}),e.jsx(F,{children:d.map(l=>e.jsx(I,{value:l.name,children:l.display_name},l.id))})]}),e.jsxs(L,{value:s.category,onValueChange:l=>u(o=>({...o,category:l})),children:[e.jsx(z,{children:e.jsx(P,{})}),e.jsx(F,{children:x.map(l=>e.jsx(I,{value:l.name,children:l.name},l.id))})]})]}),e.jsx(Z,{questionType:s.question_type,supportsOptions:m.supportsOptions,supportsScale:m.supportsScale,options:s.options,scaleConfig:s.scaleConfig,helpText:s.help_text,placeholderText:s.placeholder_text,onOptionsChange:l=>u(o=>({...o,options:l})),onScaleChange:l=>u(o=>({...o,scaleConfig:l})),onHelpTextChange:l=>u(o=>({...o,help_text:l})),onPlaceholderChange:l=>u(o=>({...o,placeholder_text:l}))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{onClick:p,disabled:!s.question_text.trim()||j,children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),t?"Update":"Add"," Question"]}),t&&e.jsx(b,{variant:"outline",onClick:n,children:"Cancel"})]})]})},ee=({questions:s,onEdit:u,onDelete:d,isDeleting:x})=>{const{toast:t}=H(),p=async n=>{n.response_count>0&&t({title:"Question will be archived",description:"This question has responses and will be archived instead of deleted.",variant:"default"}),d(n.id)};return s.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No questions found. Create your first question above."}):e.jsx("div",{className:"space-y-2",children:s.map(n=>e.jsxs("div",{className:`flex items-center justify-between p-3 border rounded-lg ${n.is_active?"":"bg-gray-50 opacity-75"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:n.question_text}),!n.is_active&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-800",children:[e.jsx(U,{className:"w-3 h-3"}),"Archived"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["Type: ",n.question_type," | Category: ",n.category," | Order: ",n.order_index,n.help_text&&e.jsxs("span",{children:[" | Help: ",n.help_text]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:"outline",onClick:()=>u(n),disabled:!n.is_active,children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx(b,{size:"sm",variant:"destructive",onClick:()=>p(n),disabled:x||!n.is_active,children:e.jsx(X,{className:"w-4 h-4"})})]})]},n.id))})},te=()=>{const{toast:s}=H(),u=Y(),[d,x]=E.useState(null),[t,p]=E.useState({question_text:"",question_type:"star",category:"QualityService",order_index:1,help_text:"",placeholder_text:"",is_required:!1,options:[],scaleConfig:{minValue:1,maxValue:5}}),{data:n=[],isLoading:j}=k({queryKey:["questions"],queryFn:()=>g.getQuestions()}),{data:m=[]}=k({queryKey:["question-types"],queryFn:()=>g.getQuestionTypes()}),{data:l=[]}=k({queryKey:["question-categories"],queryFn:()=>g.getQuestionCategories()}),o=q({mutationFn:g.createQuestion,onSuccess:()=>{u.invalidateQueries({queryKey:["questions"]}),s({title:"Question created successfully"}),N()},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),v=q({mutationFn:({id:a,...i})=>g.updateQuestion(a,i),onSuccess:()=>{u.invalidateQueries({queryKey:["questions"]}),s({title:"Question updated successfully"}),N()},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),_=q({mutationFn:a=>g.deleteQuestion(a),onSuccess:()=>{u.invalidateQueries({queryKey:["questions"]}),s({title:"Question deleted successfully"})},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),N=()=>{x(null),p({question_text:"",question_type:"star",category:"QualityService",order_index:1,help_text:"",placeholder_text:"",is_required:!1,options:[],scaleConfig:{minValue:1,maxValue:5}})},Q=()=>{if(!t.question_text.trim()){s({title:"Validation Error",description:"Question text is required",variant:"destructive"});return}const a=n.length>0?Math.max(...n.map(c=>c.order_index)):0,i=d?t.order_index:a+1,r={...t,order_index:i};d?v.mutate({id:d,...r}):o.mutate(r)},w=a=>{var i,r;x(a.id),p({question_text:a.question_text,question_type:a.question_type,category:a.category,order_index:a.order_index,help_text:a.help_text||"",placeholder_text:a.placeholder_text||"",is_required:a.is_required||!1,options:((i=a.question_options)==null?void 0:i.map(c=>({text:c.option_text,value:c.option_value})))||[],scaleConfig:(r=a.question_scale_config)!=null&&r[0]?{minValue:a.question_scale_config[0].min_value,maxValue:a.question_scale_config[0].max_value,minLabel:a.question_scale_config[0].min_label||"",maxLabel:a.question_scale_config[0].max_label||"",stepSize:a.question_scale_config[0].step_size}:{minValue:1,maxValue:5}})};return j?e.jsxs(V,{children:[e.jsx(A,{children:e.jsx(T,{children:"Questions Management"})}),e.jsx(O,{children:e.jsx("div",{className:"text-center py-8",children:"Loading questions..."})})]}):e.jsxs(V,{children:[e.jsx(A,{children:e.jsx(T,{children:"Questions Management"})}),e.jsxs(O,{className:"space-y-6",children:[e.jsx(C,{formData:t,setFormData:p,questionTypes:m,categories:l,editingId:d,onSubmit:Q,onCancel:N,isSubmitting:o.isPending||v.isPending}),e.jsx(ee,{questions:n,onEdit:w,onDelete:a=>_.mutate(a),isDeleting:_.isPending})]})]})},ie=()=>{const{organization:s}=G();return s?e.jsx(J,{permission:"manage_questions",organizationId:s.id,showRequiredRole:!0,fallback:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("p",{className:"text-gray-500",children:"You need analyst-level access or higher to manage questions."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Contact your organization administrator for access."})]}),children:e.jsx(te,{})}):e.jsx("div",{className:"text-center p-8",children:e.jsx("p",{className:"text-gray-500",children:"Organization not found"})})};export{ie as QuestionsTab,ie as default};
