import{u as k,s as N,j as e,B as _,U as q,C as h,a as g,b as T,c as B,d as G,e as M,f as S,E as H,g as A,z as n,R as I,r as y,h as K,i as O,k as L,T as Q}from"./index-uRd6IZfR.js";const V=()=>k({mutationFn:async s=>{const{data:t,error:a}=await N.rpc("log_admin_action",{p_action:s.action,p_resource_type:s.resourceType,p_resource_id:s.resourceId||null,p_organization_id:s.organizationId||null,p_old_values:s.oldValues||null,p_new_values:s.newValues||null,p_severity:s.severity||"info",p_metadata:s.metadata||{}});if(a)throw a;return t}}),J=({organizationName:s,onInviteUser:t})=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Enhanced User Management"}),e.jsxs("p",{className:"text-gray-600",children:["Manage members for ",s]})]}),e.jsxs(_,{onClick:t,children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Invite User"]})]}),Y=({totalCount:s,users:t})=>{const a=t.filter(d=>d.status==="active").length;return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(h,{children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:s}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Users"})]})]})})}),e.jsx(h,{children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",children:a}),e.jsx("p",{className:"text-sm text-gray-600",children:"Active Users"})]})]})})})]})},$=({currentPage:s,totalPages:t,hasMore:a,onPageChange:d,isLoading:i=!1})=>{const m=s>0,l=a;return e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>d(s-1),disabled:!m||i,children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Previous"]}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>d(s+1),disabled:!l||i,children:["Next",e.jsx(G,{className:"w-4 h-4 ml-1"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",s+1," ",t>0&&`of ${t}`]})]})},W=({users:s,totalCount:t,isLoading:a,searchTerm:d,roleFilter:i,currentPage:m,totalPages:l,hasMore:b,onPageChange:j})=>e.jsxs(h,{children:[e.jsx(M,{children:e.jsxs(S,{children:["Users (",t,")"]})}),e.jsxs(g,{children:[a?e.jsx(H,{text:"Loading users..."}):s.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:d||i?"No users match your filters":"No users found"}):e.jsx("div",{className:"space-y-3",children:s.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:c.email}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Joined ",new Date(c.created_at).toLocaleDateString()]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{variant:c.role==="admin"?"default":"secondary",children:c.role}),e.jsx(A,{variant:c.status==="active"?"default":"secondary",children:c.status})]})]},c.id))}),s.length>0&&e.jsx($,{currentPage:m,totalPages:l,hasMore:b,onPageChange:j,isLoading:a})]})]}),X=s=>s.trim(),Z=n.object({users:n.array(n.object({id:n.string().uuid(),email:n.string().email(),role:n.string(),status:n.string(),created_at:n.string().datetime()})),total_count:n.number(),page_size:n.number(),page_offset:n.number(),has_more:n.boolean()});async function D(s){const{data:t,error:a}=await N.rpc("is_current_user_org_admin",{org_id:s});return a?!1:!!t}const ee=I.memo(({organizationId:s,organizationName:t})=>{const[a,d]=y.useState(0),[i,m]=y.useState(""),[l,b]=y.useState("all"),{toast:j}=K();O();const c=V(),x=20,w=a*x,{data:u,isLoading:E}=L({queryKey:["is-org-admin",s],queryFn:()=>D(s),enabled:!!s,staleTime:10*60*1e3}),{data:o,isLoading:f,error:p}=L({queryKey:["paginated-users",s,x,w,i,l],queryFn:async()=>{const{data:r,error:U}=await N.rpc("get_paginated_organization_users",{org_id:s,page_size:x,page_offset:w,search_term:i?X(i):null,role_filter:l==="all"?null:l});if(U)throw U;return Z.parse(r)},enabled:!!s&&u,staleTime:3e4}),C=((o==null?void 0:o.users)??[]).filter(r=>!!r&&typeof r.id=="string"&&typeof r.email=="string"&&typeof r.role=="string"&&typeof r.status=="string"&&typeof r.created_at=="string"),v=(o==null?void 0:o.total_count)||0,F=(o==null?void 0:o.has_more)||!1,R=Math.ceil(v/x),z=r=>{d(r),c.mutate({action:"navigate_user_page",resourceType:"user_management",organizationId:s,metadata:{page:r,searchTerm:i,roleFilter:l}})},P=()=>{j({title:"Feature coming soon",description:"Invite user functionality will be implemented soon."})};return p||!f&&!u?e.jsxs(h,{children:[e.jsx(M,{children:e.jsxs(S,{className:"flex items-center text-red-600",children:[e.jsx(Q,{className:"w-5 h-5 mr-2"}),u===!1?"Access Denied":"Error Loading Users"]})}),e.jsxs(g,{children:[e.jsx("p",{className:"text-gray-600",children:u===!1?"You do not have permission to view this organization's users.":"Failed to load user data. Please try again."}),p&&e.jsxs("p",{className:"text-sm text-red-600 mt-2",children:["Error: ",p.message]})]})]}):E||f?e.jsx("div",{className:"py-10 text-center text-gray-400",children:"Loading..."}):e.jsxs("div",{className:"space-y-6 mt-8",children:[e.jsx(J,{organizationName:t,onInviteUser:P}),e.jsx(Y,{totalCount:v,users:C}),e.jsx(W,{users:C,totalCount:v,isLoading:f,searchTerm:i,roleFilter:l,currentPage:a,totalPages:R,hasMore:F,onPageChange:z})]})}),te=({organization:s})=>e.jsx(ee,{organizationId:s.id,organizationName:s.name});export{te as default};
